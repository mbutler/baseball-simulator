function uM(q){let z=/<!--([\s\S]*?)-->/g,J=[],Q;while((Q=z.exec(q))!==null)J.push(Q[1]);return J}function fM(q,z){let J=new DOMParser;for(let Q of q)if(Q.includes(`id="${z}"`))return J.parseFromString(Q,"text/html").querySelector(`table#${z}`);return null}function OM(q){let z=document.createElement("div");z.style.display="none",document.body.appendChild(z),z.innerHTML=q;let J=z.querySelector("table#players_standard_batting"),Q=z.querySelector("table#players_standard_pitching"),X=uM(q),Y=fM(X,"players_standard_fielding");return z.remove(),{batting:J,pitching:Q,fielding:Y}}function CM(q){if(!q||!q.href)return null;let z=q.href.match(/\/players\/.\/([^/.]+)\.shtml/);return z?z[1]:null}function dM(q){return q.toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,12)}function VM(q){if(!q)return[];let z=Array.from(q.querySelectorAll("tbody > tr")).filter((X)=>!X.classList.contains("thead")),J=Array.from(q.querySelectorAll("thead tr th")).map((X)=>(X.textContent??"").trim()),Q=[];for(let X of z){let Y=[X.querySelector("th"),...X.querySelectorAll("td")];if(Y.length!==J.length)continue;let $={};for(let Z=0;Z<J.length;Z++){let N=J[Z],V=Y[Z];if(Z===0){let E=V?.textContent?.trim()||"",H=V?.querySelector?.("a"),W=CM(H);if(/^\d+$/.test(E)){let C=X.querySelector("td");E=C?.textContent?.trim()||"(unknown)",H=C?.querySelector?.("a"),W=CM(H)||W}$.name=E,$.player_id=W||dM(E)}else{let E=V?.textContent?.trim()||"",H=Number(E.replace(/,/g,""));$[N]=isNaN(H)?E:H}}Q.push($)}return Q}function _M(q){return q.map((z)=>{let J=Number(z.PA)||0,Q=Number(z.AB)||0,X=Number(z.H)||0,Y=Number(z.HR)||0,$=Number(z.BB)||0,Z=Number(z.SO)||0,N=Number(z.SF)||0,V=Number(z.HBP)||0,E=Number(z["2B"])||0,H=Number(z["3B"])||0,W=X-E-H-Y,C=Q-Z-Y+N,O=C>0?(X-Y)/C:null,y=J>0?Z/J:null,T=J>0?$/J:null,_=J>0?Y/J:null;return{name:z.name,player_id:z.player_id,PA:J,stats:{H:X,HR:Y,BB:$,SO:Z,SF:N,HBP:V,singles:W,doubles:E,triples:H},rates:{kRate:y,bbRate:T,hrRate:_,BABIP:O}}})}function IM(q){return q.map((z)=>{let J=Number(z.IP)||0,Q=Number(z.TBF)||0,X=Number(z.H)||0,Y=Number(z.HR)||0,$=Number(z.BB)||0,Z=Number(z.SO)||0,N=Number(z.HBP)||0,V=Q>0?Z/Q:null,E=Q>0?$/Q:null,H=Q>0?Y/Q:null,W=Q-Z-Y-$-N,C=W>0?(X-Y)/W:null;return{name:z.name,player_id:z.player_id,TBF:Q,stats:{IP:J,H:X,HR:Y,BB:$,SO:Z,HBP:N},rates:{kRate:V,bbRate:E,hrRate:H,BABIP:C}}})}function m(q,z,J,Q){let X=q.map((Z)=>{let N=J.find((V)=>V.player_id===Z);if(!N)throw new Error(`Lineup player not found: ${Z}`);return N}),Y=Q.find((Z)=>Z.player_id===z);if(!Y)throw new Error(`Starting pitcher not found: ${z}`);let $=new Set;for(let Z of X){if($.has(Z.player_id))throw new Error(`Duplicate player in lineup: ${Z.player_id}`);$.add(Z.player_id)}if($.has(z))throw new Error(`Pitcher also appears in lineup: ${z}`);return{lineup:X,pitcher:Y}}function lM(q,z){return(q+z)/2}function n(q,z){return q==null||isNaN(q)||q===0?z:q}var zM=0.22,JM=0.08,QM=0.03;function vM(q,z){let J=q.rates||{},Q=z.rates||{},X=q.stats||{},Y=U(n(J.kRate,zM),"batter.kRate"),$=U(n(Q.kRate,zM),"pitcher.kRate"),Z=U(n(J.bbRate,JM),"batter.bbRate"),N=U(n(Q.bbRate,JM),"pitcher.bbRate"),V=U(n(J.hrRate,QM),"batter.hrRate"),E=U(n(Q.hrRate,QM),"pitcher.hrRate"),H=U(J.BABIP??0.29,"batter.BABIP"),W=U(Q.BABIP??0.29,"pitcher.BABIP"),C=Math.max(0,q.PA||0),O=Math.max(0,X.HBP??0),y=Math.max(0,X.singles??0),T=Math.max(0,X.doubles??0),_=Math.max(0,X.triples??0),j=U(zM>0?Y*$/zM:0,"K"),I=U(JM>0?Z*N/JM:0,"BB"),f=U(QM>0?V*E/QM:0,"HR"),S=U(lM(H,W),"BABIP"),c=U(C>0?O/C:0,"HBP"),L=j+I+c+f,K=Math.max(0,1-L),D=S*K,P=K-D,k=y+T+_,d=k>0?y/k:0.7,$M=k>0?T/k:0.2,hM=k>0?_/k:0.1;return{K:U(j,"K"),BB:U(I,"BB"),HBP:U(c,"HBP"),HR:U(f,"HR"),"1B":U(D*d,"1B"),"2B":U(D*$M,"2B"),"3B":U(D*hM,"3B"),Out:U(P,"Out")}}function U(q,z){if(typeof q!=="number"||isNaN(q))return 0;if(q<0){if(z)console.warn(`[probabilityModel] Clamped negative value for ${z}: ${q} → 0`);return 0}if(q>1){if(z)console.warn(`[probabilityModel] Clamped value >1 for ${z}: ${q} → 1`);return 1}return q}function i(q){let{lineup:z,pitcher:J}=q;return z.map((Q)=>{let X=vM(Q,J);return{batter_id:Q.player_id,pitcher_id:J.player_id,probabilities:X}})}function s(q){let z=Object.values(q).reduce((Q,X)=>Q+X,0),J=Math.random()*z;for(let[Q,X]of Object.entries(q))if((J-=X)<=0)return Q;return Object.keys(q).pop()||""}var pM={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},cM={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function GM(q){if(q==="Out"){let z=s(pM),J=s(cM[z]);return`${z} to ${J}`}return q}function kM(){return{inning:1,top:!0,outs:0,bases:[0,0,0],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function NM(q){let z=[];if(q[0])z.push(0);if(q[1]&&q[0])z.push(1);if(q[2]&&q[1]&&q[0])z.push(2);return z}function EM(q,z){let J=0,Q=[0,0,0];for(let Y=2;Y>=0;Y--){if(!q[Y])continue;let $=Y+(z==="1B"?1:z==="2B"?2:z==="3B"?3:4);if($>=3)J++;else Q[$]=1}let X={"1B":0,"2B":1,"3B":2}[z];if(X!==void 0)Q[X]=1;if(z==="HR")J++;return[Q,J]}function FM(q,z,J,Q,X,Y,$){let Z=Y||s,N=$||GM,V=J.top?0:1,E=V===0?q:z,H=V===0?X:Q,W=Array.isArray(H)?H:[],C=J.lineupIndices[V],O=E[C%E.length],y=O.probabilities;if(J.pitcherFatigue&&J.pitcherFatigue[1-V]){J.pitcherFatigue[1-V].battersFaced++;let L=J.pitcherFatigue[1-V].battersFaced;if(L>18){let D=Math.min((L-18)*0.005,0.05);y={...y};let P=y.Out;if(y.BB)y.BB+=D;if(y["1B"])y["1B"]+=D;if(y.Out){if(y.Out-=D,y.Out<0.5*P)y.Out=0.5*P}let k=Object.values(y).reduce((d,$M)=>d+$M,0);Object.keys(y).forEach((d)=>y[d]=Math.max(0,y[d]/k))}}let T=Z(y),_=N(T);J.lineupIndices[V]++;let j=void 0,I="",f=!1,S=!1,c=!1;if(T==="Out"){let L=_.match(/to ([A-Z0-9]+)/);if(L){if(I=L[1],j=W.find((K)=>K.position===I),j&&j.stats){let K=Number(j.stats.E)||0,D=Number(j.stats.PO)||0,P=Number(j.stats.A)||0,k=D+P+K,d=k>0?K/k:0.01;if(Math.random()<d)f=!0}else if(Math.random()<0.01)f=!0}}if(f){let[L,K]=EM(J.bases,"1B");return J.bases=L,J.score[V]+=K,{batter_id:O.batter_id,outcome:`Error on ${I}`,fielder:j,fielderPosition:I}}if(T==="Out"&&/^Groundout to [A-Z0-9]+$/.test(_)&&J.outs===0){let L=NM(J.bases);if(L.length>=2){if(Math.random()<0.01){c=!0;let K=L.slice().sort((D,P)=>P-D);for(let D=0;D<2&&D<K.length;D++)J.bases[K[D]]=0;return J.outs=3,{batter_id:O.batter_id,outcome:"Grounded into triple play",...j?{fielder:j,fielderPosition:I}:{}}}}}if(T==="Out"&&/^Groundout to [A-Z0-9]+$/.test(_)&&J.outs<2){let L=NM(J.bases);if(L.length>=1){if(Math.random()<0.25){S=!0;let K=Math.max(...L);return J.bases[K]=0,J.outs=Math.min(J.outs+2,3),{batter_id:O.batter_id,outcome:"Grounded into double play",...j?{fielder:j,fielderPosition:I}:{}}}}}if(T==="Out"&&/^Groundout to [A-Z0-9]+$/.test(_)){J.outs++;let L=NM(J.bases);for(let K of L.slice().sort((D,P)=>P-D))if(J.bases[K])if(K===2)J.bases[K]=0,J.score[V]+=1;else J.bases[K+1]=1,J.bases[K]=0,console.log("Advancing forced runner from",K,"to",K+1,"Bases:",J.bases);return{batter_id:O.batter_id,outcome:_,...j?{fielder:j,fielderPosition:I}:{}}}if(T==="Out"||T==="K")J.outs++;else if(T==="BB"||T==="HBP"){let[L,K]=EM(J.bases,"1B");J.bases=L,J.score[V]+=K}else{let[L,K]=EM(J.bases,T);J.bases=L,J.score[V]+=K}return{batter_id:O.batter_id,outcome:_,...j?{fielder:j,fielderPosition:I}:{}}}function XM(q,z,J,Q,X,Y,$){let Z=$||Math.random;if(!z.bases[Y-1])return{success:!1,out:!1,description:`No runner on base ${Y} to steal from.`};let N=q===2?0.6:q===3?0.3:0.1;if(J?.stats&&X?.stats){let E=Number(J.stats.SPD||J.stats.SB||50),H=Number(X.stats.ARM||X.stats["CS%"]||50);if(N=0.5+(E-H)/200,q===3)N-=0.2;if(q===4)N-=0.4;N=Math.max(0.05,Math.min(0.95,N))}if(Z(1)<N){if(z.bases[Y-1]=0,q<=3)z.bases[q-1]=1;else z.score[z.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${q===4?"Home":q}`}}else return z.bases[Y-1]=0,z.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${q===4?"Home":q}`}}function YM(q,z,J,Q,X,Y){let $=Y||Math.random;if(!z.bases[q-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${q} to pick off.`};let Z=0.05,N=0.1;if(Q?.stats&&J?.stats){let E=Number(Q.stats.PK||50),H=Number(J.stats.SPD||50);Z=0.03+(E-H)/1000,Z=Math.max(0.01,Math.min(0.15,Z))}if(X?.stats)N=0.05+Number(X.stats.E||0)/1000,N=Math.max(0.01,Math.min(0.2,N));let V=$(1);if(V<Z)return z.bases[q-1]=0,z.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${q}`};else if(V<Z+N){if(z.bases[q-1]=0,q<3)z.bases[q]=1;else z.score[z.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${q}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${q} unsuccessful`}}function xM(q,z){let{inning:J,top:Q,outs:X,score:Y}=q,[$,Z]=Y;if(J<9)return!1;if(Q&&X===3){if(Z>$)return z("Home",Y,J,!0),!0;return!1}if(!Q&&X===3)if($>Z)return z("Away",Y,J,!1),!0;else if(Z>$)return z("Home",Y,J,!1),!0;else return!1;if(!Q&&X<3&&Z>$)return z("Home",Y,J,!1),!0;return!1}var B=document.getElementById("home-team-select"),h=document.getElementById("away-team-select"),KM=document.getElementById("load-teams-btn"),F=document.getElementById("status"),ZM=document.getElementById("lineups-container"),o=document.getElementById("game-state-container"),v=document.getElementById("next-atbat-btn"),G=document.getElementById("atbat-result-container"),yM=document.getElementById("customize-home-lineup-btn"),HM=document.getElementById("customize-away-lineup-btn"),p=document.getElementById("custom-lineup-modal"),LM=document.getElementById("close-lineup-modal"),UM=document.getElementById("lineup-modal-title"),jM=document.getElementById("custom-lineup-form"),b=document.getElementById("batting-order-list"),g=document.getElementById("pitcher-select"),x=document.getElementById("lineup-error"),r=document.getElementById("steal-2b-btn"),a=document.getElementById("steal-3b-btn"),t=document.getElementById("steal-home-btn"),e=document.getElementById("pickoff-1b-btn"),MM=document.getElementById("pickoff-2b-btn"),qM=document.getElementById("pickoff-3b-btn"),TM=document.getElementById("simulate-full-game-btn");function DM(q,z){if(!ZM)return;ZM.innerHTML="";let J=(Q,X)=>{if(!Q)return`<div><strong>${X}:</strong> Not loaded</div>`;let Y=Q.lineup||Q.batters||[],$=Q.pitcher||Q.pitchers&&Q.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${X} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>PA</th></tr></thead>
          <tbody>
            ${(Y||[]).slice(0,9).map((Z,N)=>`<tr><td>${N+1}</td><td>${Z.name||""}</td><td>${Z.PA||""}</td></tr>`).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${$.name}</div>
      </div>
    `};ZM.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${J(q,"Home")}</div>
      <div style="flex:1;min-width:250px;">${J(z,"Away")}</div>
    </div>
  `}function w(q,z,J,Q,X,Y,$){if(!o)return;if(!q||!z||!J){if(o.innerHTML="<em>Game not started.</em>",v)v.style.display="none";return}let Z=q,{inning:N,top:V,outs:E,bases:H,score:W,lineupIndices:C}=Z,O=V?0:1,y=O===0?X:Q,T=O===0?J:z;if(!T){if(o.innerHTML="<em>Roster not loaded.</em>",v)v.style.display="none";return}let _=C[O]%T.lineup.length,j=T.lineup[_],I=(O===0?z:J).pitcher,f=["1B","2B","3B"].map((S,c)=>Z.bases[c]?S:"").filter(Boolean).join(", ")||"Empty";if(o.innerHTML=`
    <div><strong>Inning:</strong> ${N} (${V?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${E}</div>
    <div><strong>Bases:</strong> ${f}</div>
    <div><strong>Score:</strong> Away ${W[0]} &ndash; Home ${W[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${j.name} (vs ${I.name})</div>
  `,v)v.style.display=""}function l(q,z,J){if(!G)return;if(!q)return;z.push(q),J()}function A(q){if(!G)return;G.innerHTML="";let z=null,J=null;for(let Q of q){if(Q.inning!==z||Q.top!==J){let $=document.createElement("div");$.style.marginTop="1em",$.style.fontWeight="bold",$.textContent=`Inning ${Q.inning} - ${Q.top?"Top":"Bottom"}`,G.appendChild($),z=Q.inning,J=Q.top}let X=["1B","2B","3B"].map(($,Z)=>Q.bases[Z]?$:"").filter(Boolean).join(", ")||"Empty",Y=document.createElement("div");Y.innerHTML=`<strong>${Q.batterName}:</strong> ${Q.outcome} <span style="color:#888">(Outs: ${Q.outs}, Score: Away ${Q.score[0]} – Home ${Q.score[1]}, Bases: ${X})</span>`,G.appendChild(Y)}}function R(q,z){q(),z()}var M={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};async function nM(){return["ARI-2025.html","ATL-2025.html","BAL-2025.html","BOS-2025.html","CHC-2025.html","CHW-2025.html","CIN-2025.html","CLE-2025.html","COL-2025.html","DET-2025.html","HOU-2025.html","KCR-2025.html","LAA-2025.html","LAD-2025.html","MIA-2025.html","MIL-2025.html","MIN-2025.html","NYM-2025.html","NYY-2025.html","OAK-2025.html","PHI-2025.html","PIT-2025.html","SDP-2025.html","SEA-2025.html","SFG-2025.html","STL-2025.html","TBR-2025.html","TEX-2025.html","TOR-2025.html","WSN-2025.html"]}async function wM(q){let J=await(await fetch(`./data/${q}`)).text(),{batting:Q,pitching:X}=OM(J),Y=Q?VM(Q):[],$=X?VM(X):[],Z=_M(Y),N=IM($);return{batters:Z,pitchers:N}}function bM(q,z,J,Q){let X=document.querySelector(".sticky-action-bar");if(X)X.querySelectorAll("button").forEach(($)=>{$.disabled=!0,$.classList.add("disabled-greyed")});if(F)F.textContent=`Game Over: ${q} wins! Final Score: Away ${z[0]} – Home ${z[1]} (${J}${Q?" Top":" Bottom"})`;if(G){let Y=document.createElement("div");Y.style.marginTop="1em",Y.style.fontWeight="bold",Y.style.color="#b00",Y.textContent=`Game Over: ${q} wins! Final Score: Away ${z[0]} – Home ${z[1]} (${J}${Q?" Top":" Bottom"})`,G.appendChild(Y)}}function PM(){if(!M.homeRoster||!M.awayRoster)return;M.homeMatchups=i(M.homeRoster),M.awayMatchups=i(M.awayRoster),M.gameState=kM(),M.atBatLog=[],A(M.atBatLog),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)}function AM(){if(!M.gameState||!M.homeMatchups||!M.awayMatchups)return;let q=M.gameState,z=q.top?0:1,J=z===0?M.awayRoster:M.homeRoster;if(!J)return;let Q=q.lineupIndices[z]%J.lineup.length,X=J.lineup[Q],Y=FM(M.awayMatchups,M.homeMatchups,q,[],[]);if(l({batterName:X.name,outcome:Y.outcome,outs:q.outs,score:[...q.score],bases:[...q.bases],inning:q.inning,top:q.top},M.atBatLog,()=>A(M.atBatLog)),xM({inning:q.inning,top:q.top,score:q.score,outs:q.outs},bM)){R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u);return}let Z="",N=!1;if(q.outs>=3){if(q.bases=[0,0,0],q.outs=0,q.top)q.top=!1,Z="End of top half. Switching to bottom of inning.";else q.top=!0,q.inning++,Z="End of inning. Advancing to next inning.";N=!0}if(N){if(G){let V=document.createElement("div");V.innerHTML=`<em>${Z}</em>`,G.appendChild(V),M.lastRenderedInning=q.inning,M.lastRenderedTop=q.top;let E=document.createElement("div");E.style.marginTop="1em",E.style.fontWeight="bold",E.textContent=`Inning ${q.inning} - ${q.top?"Top":"Bottom"}`,G.appendChild(E)}}R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)}function gM(){if(!M.gameState||!M.homeMatchups||!M.awayMatchups)PM();while(M.gameState&&v&&!v.disabled)AM()}async function WM(){if(!B||!h||!F)return;let q=B.value,z=h.value;if(!q||!z)return;F.textContent="Loading lineups...";try{let[J,Q]=await Promise.all([wM(q),wM(z)]);M.loadedHome=J,M.loadedAway=Q,M.homeRoster=J&&J.batters&&J.pitchers?m(M.customHomeLineup&&M.customHomeLineup.length===9?M.customHomeLineup:J.batters.slice(0,9).map((X)=>X.player_id),M.customHomePitcher||J.pitchers[0].player_id,J.batters,J.pitchers):null,M.awayRoster=Q&&Q.batters&&Q.pitchers?m(M.customAwayLineup&&M.customAwayLineup.length===9?M.customAwayLineup:Q.batters.slice(0,9).map((X)=>X.player_id),M.customAwayPitcher||Q.pitchers[0].player_id,Q.batters,Q.pitchers):null,DM(M.homeRoster,M.awayRoster),M.atBatLog=[],A(M.atBatLog),F.textContent="Lineups loaded. Ready to simulate!",console.log("--- Home Roster (normalized, ready for engine) ---"),console.log(JSON.stringify(M.homeRoster,null,2)),console.log("--- Away Roster (normalized, ready for engine) ---"),console.log(JSON.stringify(M.awayRoster,null,2)),PM()}catch(J){F.textContent="Failed to load lineups."}}async function RM(){if(!F)return;F.textContent="Loading teams...";let q=await nM();if(!q.length){F.textContent="No teams found in data folder.";return}for(let z of[B,h]){if(!z)continue;z.innerHTML="";for(let J of q){let Q=document.createElement("option");Q.value=J,Q.textContent=J.replace(".html",""),z.appendChild(Q)}}if(B)B.value="CHC-2025.html";if(h)h.value="MIL-2025.html";if(F.textContent="Select home and away teams.",B&&h)WM()}function SM(){if(!M.loadedHome||!M.loadedAway)return;if(M.homeRoster=M.loadedHome&&M.loadedHome.batters&&M.loadedHome.pitchers?m(M.customHomeLineup&&M.customHomeLineup.length===9?M.customHomeLineup:M.loadedHome.batters.slice(0,9).map((q)=>q.player_id),M.customHomePitcher||M.loadedHome.pitchers[0].player_id,M.loadedHome.batters,M.loadedHome.pitchers):null,M.awayRoster=M.loadedAway&&M.loadedAway.batters&&M.loadedAway.pitchers?m(M.customAwayLineup&&M.customAwayLineup.length===9?M.customAwayLineup:M.loadedAway.batters.slice(0,9).map((q)=>q.player_id),M.customAwayPitcher||M.loadedAway.pitchers[0].player_id,M.loadedAway.batters,M.loadedAway.pitchers):null,M.homeRoster&&M.awayRoster)M.homeMatchups=i({lineup:M.homeRoster.lineup,pitcher:M.awayRoster.pitcher}),M.awayMatchups=i({lineup:M.awayRoster.lineup,pitcher:M.homeRoster.pitcher});DM(M.homeRoster,M.awayRoster),w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop)}function BM(q,z,J,Q,X){if(M.editingTeam=q,!p||!UM||!b||!g)return;if(UM.textContent=`Customize ${q==="home"?"Home":"Away"} Lineup`,x)x.textContent="";p.style.display="flex";let Y=Q,$=X;if(q==="home"&&M.homeRoster)Y=M.homeRoster.lineup?M.homeRoster.lineup.map((Z)=>Z.player_id):Q,$=M.homeRoster.pitcher?M.homeRoster.pitcher.player_id:X;else if(q==="away"&&M.awayRoster)Y=M.awayRoster.lineup?M.awayRoster.lineup.map((Z)=>Z.player_id):Q,$=M.awayRoster.pitcher?M.awayRoster.pitcher.player_id:X;b.innerHTML="";for(let Z=0;Z<9;Z++){let N=document.createElement("li"),V=document.createElement("select");if(V.name=`batter${Z}`,V.required=!0,V.innerHTML='<option value="">-- Select --</option>'+z.map((E)=>`<option value="${E.player_id}">${E.name} (${E.PA} PA)</option>`).join(""),Y&&Y[Z])V.value=Y[Z];N.appendChild(V),b.appendChild(N)}if(g.innerHTML='<option value="">-- Select --</option>'+J.map((Z)=>`<option value="${Z.player_id}">${Z.name} (${Z.stats&&Z.stats.IP?Z.stats.IP:""} IP)</option>`).join(""),$)g.value=$}function u(){if(!M.gameState)return;if(r)r.disabled=!M.gameState.bases[0];if(a)a.disabled=!M.gameState.bases[1];if(t)t.disabled=!M.gameState.bases[2];if(e)e.disabled=!M.gameState.bases[0];if(MM)MM.disabled=!M.gameState.bases[1];if(qM)qM.disabled=!M.gameState.bases[2]}if(KM)KM.addEventListener("click",RM);if(B)B.addEventListener("change",WM);if(h)h.addEventListener("change",WM);if(v)v.addEventListener("click",AM);if(yM)yM.addEventListener("click",()=>{if(!M.loadedHome)return;BM("home",M.loadedHome.batters,M.loadedHome.pitchers,M.customHomeLineup,M.customHomePitcher)});if(HM)HM.addEventListener("click",()=>{if(!M.loadedAway)return;BM("away",M.loadedAway.batters,M.loadedAway.pitchers,M.customAwayLineup,M.customAwayPitcher)});if(LM)LM.addEventListener("click",()=>{if(p)p.style.display="none"});if(jM)jM.addEventListener("submit",(q)=>{if(q.preventDefault(),!b||!g)return;let z=[],J=b.querySelectorAll("select");for(let X of J){if(!X.value){if(x)x.textContent="Please select a player for every lineup slot.";return}z.push(X.value)}if(new Set(z).size!==z.length){if(x)x.textContent="No duplicate players allowed in the lineup.";return}let Q=g.value;if(!Q){if(x)x.textContent="Please select a starting pitcher.";return}if(z.includes(Q)){if(x)x.textContent="Pitcher cannot also be in the batting lineup.";return}if(M.editingTeam==="home")M.customHomeLineup=z,M.customHomePitcher=Q;else M.customAwayLineup=z,M.customAwayPitcher=Q;if(p)p.style.display="none";SM()});window.addEventListener("DOMContentLoaded",()=>{RM()});if(r)r.addEventListener("click",()=>{if(!M.gameState||!M.homeRoster||!M.awayRoster)return;let q=M.gameState.top?0:1,J=(q===0?M.awayRoster:M.homeRoster).lineup.find(($)=>!0)||{},Q=(q===0?M.homeRoster:M.awayRoster).pitcher,X=(q===0?M.homeRoster:M.awayRoster).lineup[0]||{},Y=XM(2,M.gameState,J,Q,X,1);l({batterName:"Runner",outcome:Y.description,outs:M.gameState.outs,score:[...M.gameState.score],bases:[...M.gameState.bases],inning:M.gameState.inning,top:M.gameState.top},M.atBatLog,()=>A(M.atBatLog)),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)});if(a)a.addEventListener("click",()=>{if(!M.gameState||!M.homeRoster||!M.awayRoster)return;let q=M.gameState.top?0:1,J=(q===0?M.awayRoster:M.homeRoster).lineup.find(($)=>!0)||{},Q=(q===0?M.homeRoster:M.awayRoster).pitcher,X=(q===0?M.homeRoster:M.awayRoster).lineup[0]||{},Y=XM(3,M.gameState,J,Q,X,2);l({batterName:"Runner",outcome:Y.description,outs:M.gameState.outs,score:[...M.gameState.score],bases:[...M.gameState.bases],inning:M.gameState.inning,top:M.gameState.top},M.atBatLog,()=>A(M.atBatLog)),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)});if(t)t.addEventListener("click",()=>{if(!M.gameState||!M.homeRoster||!M.awayRoster)return;let q=M.gameState.top?0:1,J=(q===0?M.awayRoster:M.homeRoster).lineup.find(($)=>!0)||{},Q=(q===0?M.homeRoster:M.awayRoster).pitcher,X=(q===0?M.homeRoster:M.awayRoster).lineup[0]||{},Y=XM(4,M.gameState,J,Q,X,3);l({batterName:"Runner",outcome:Y.description,outs:M.gameState.outs,score:[...M.gameState.score],bases:[...M.gameState.bases],inning:M.gameState.inning,top:M.gameState.top},M.atBatLog,()=>A(M.atBatLog)),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)});if(e)e.addEventListener("click",()=>{if(!M.gameState||!M.homeRoster||!M.awayRoster)return;let q=M.gameState.top?0:1,J=(q===0?M.awayRoster:M.homeRoster).lineup.find(($)=>!0)||{},Q=(q===0?M.homeRoster:M.awayRoster).pitcher,X=(q===0?M.homeRoster:M.awayRoster).lineup[0]||{},Y=YM(1,M.gameState,J,Q,X);l({batterName:"Runner",outcome:Y.description,outs:M.gameState.outs,score:[...M.gameState.score],bases:[...M.gameState.bases],inning:M.gameState.inning,top:M.gameState.top},M.atBatLog,()=>A(M.atBatLog)),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)});if(MM)MM.addEventListener("click",()=>{if(!M.gameState||!M.homeRoster||!M.awayRoster)return;let q=M.gameState.top?0:1,J=(q===0?M.awayRoster:M.homeRoster).lineup.find(($)=>!0)||{},Q=(q===0?M.homeRoster:M.awayRoster).pitcher,X=(q===0?M.homeRoster:M.awayRoster).lineup[0]||{},Y=YM(2,M.gameState,J,Q,X);l({batterName:"Runner",outcome:Y.description,outs:M.gameState.outs,score:[...M.gameState.score],bases:[...M.gameState.bases],inning:M.gameState.inning,top:M.gameState.top},M.atBatLog,()=>A(M.atBatLog)),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)});if(qM)qM.addEventListener("click",()=>{if(!M.gameState||!M.homeRoster||!M.awayRoster)return;let q=M.gameState.top?0:1,J=(q===0?M.awayRoster:M.homeRoster).lineup.find(($)=>!0)||{},Q=(q===0?M.homeRoster:M.awayRoster).pitcher,X=(q===0?M.homeRoster:M.awayRoster).lineup[0]||{},Y=YM(3,M.gameState,J,Q,X);l({batterName:"Runner",outcome:Y.description,outs:M.gameState.outs,score:[...M.gameState.score],bases:[...M.gameState.bases],inning:M.gameState.inning,top:M.gameState.top},M.atBatLog,()=>A(M.atBatLog)),R(()=>w(M.gameState,M.homeRoster,M.awayRoster,M.homeMatchups,M.awayMatchups,M.lastRenderedInning,M.lastRenderedTop),u)});if(TM)TM.addEventListener("click",gM);
