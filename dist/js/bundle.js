var $0=Object.create;var{getPrototypeOf:V0,defineProperty:j1,getOwnPropertyNames:Z0}=Object;var N0=Object.prototype.hasOwnProperty;var U0=(T,z,H)=>{H=T!=null?$0(V0(T)):{};let q=z||!T||!T.__esModule?j1(H,"default",{value:T,enumerable:!0}):H;for(let L of Z0(T))if(!N0.call(q,L))j1(q,L,{get:()=>T[L],enumerable:!0});return q};var v0=(T,z)=>{for(var H in z)j1(T,H,{get:z[H],enumerable:!0,configurable:!0,set:(q)=>z[H]=()=>q})};var K0=(T,z)=>()=>(T&&(z=T(T=0)),z);var j0=((T)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(T,{get:(z,H)=>(typeof require!=="undefined"?require:z)[H]}):T)(function(T){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+T+'" is not supported')});var m1={};v0(m1,{sep:()=>p1,resolve:()=>V1,relative:()=>B1,posix:()=>S1,parse:()=>g1,normalize:()=>C1,join:()=>u1,isAbsolute:()=>l1,format:()=>b1,extname:()=>d1,dirname:()=>n1,delimiter:()=>i1,default:()=>_0,basename:()=>c1,_makeLong:()=>h1});function u(T){if(typeof T!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(T))}function f1(T,z){var H="",q=0,L=-1,Q=0,M;for(var J=0;J<=T.length;++J){if(J<T.length)M=T.charCodeAt(J);else if(M===47)break;else M=47;if(M===47){if(L===J-1||Q===1);else if(L!==J-1&&Q===2){if(H.length<2||q!==2||H.charCodeAt(H.length-1)!==46||H.charCodeAt(H.length-2)!==46){if(H.length>2){var X=H.lastIndexOf("/");if(X!==H.length-1){if(X===-1)H="",q=0;else H=H.slice(0,X),q=H.length-1-H.lastIndexOf("/");L=J,Q=0;continue}}else if(H.length===2||H.length===1){H="",q=0,L=J,Q=0;continue}}if(z){if(H.length>0)H+="/..";else H="..";q=2}}else{if(H.length>0)H+="/"+T.slice(L+1,J);else H=T.slice(L+1,J);q=J-L-1}L=J,Q=0}else if(M===46&&Q!==-1)++Q;else Q=-1}return H}function C0(T,z){var H=z.dir||z.root,q=z.base||(z.name||"")+(z.ext||"");if(!H)return q;if(H===z.root)return H+q;return H+T+q}function V1(){var T="",z=!1,H;for(var q=arguments.length-1;q>=-1&&!z;q--){var L;if(q>=0)L=arguments[q];else{if(H===void 0)H=process.cwd();L=H}if(u(L),L.length===0)continue;T=L+"/"+T,z=L.charCodeAt(0)===47}if(T=f1(T,!z),z)if(T.length>0)return"/"+T;else return"/";else if(T.length>0)return T;else return"."}function C1(T){if(u(T),T.length===0)return".";var z=T.charCodeAt(0)===47,H=T.charCodeAt(T.length-1)===47;if(T=f1(T,!z),T.length===0&&!z)T=".";if(T.length>0&&H)T+="/";if(z)return"/"+T;return T}function l1(T){return u(T),T.length>0&&T.charCodeAt(0)===47}function u1(){if(arguments.length===0)return".";var T;for(var z=0;z<arguments.length;++z){var H=arguments[z];if(u(H),H.length>0)if(T===void 0)T=H;else T+="/"+H}if(T===void 0)return".";return C1(T)}function B1(T,z){if(u(T),u(z),T===z)return"";if(T=V1(T),z=V1(z),T===z)return"";var H=1;for(;H<T.length;++H)if(T.charCodeAt(H)!==47)break;var q=T.length,L=q-H,Q=1;for(;Q<z.length;++Q)if(z.charCodeAt(Q)!==47)break;var M=z.length,J=M-Q,X=L<J?L:J,$=-1,Y=0;for(;Y<=X;++Y){if(Y===X){if(J>X){if(z.charCodeAt(Q+Y)===47)return z.slice(Q+Y+1);else if(Y===0)return z.slice(Q+Y)}else if(L>X){if(T.charCodeAt(H+Y)===47)$=Y;else if(Y===0)$=0}break}var U=T.charCodeAt(H+Y),F=z.charCodeAt(Q+Y);if(U!==F)break;else if(U===47)$=Y}var k="";for(Y=H+$+1;Y<=q;++Y)if(Y===q||T.charCodeAt(Y)===47)if(k.length===0)k+="..";else k+="/..";if(k.length>0)return k+z.slice(Q+$);else{if(Q+=$,z.charCodeAt(Q)===47)++Q;return z.slice(Q)}}function h1(T){return T}function n1(T){if(u(T),T.length===0)return".";var z=T.charCodeAt(0),H=z===47,q=-1,L=!0;for(var Q=T.length-1;Q>=1;--Q)if(z=T.charCodeAt(Q),z===47){if(!L){q=Q;break}}else L=!1;if(q===-1)return H?"/":".";if(H&&q===1)return"//";return T.slice(0,q)}function c1(T,z){if(z!==void 0&&typeof z!=="string")throw new TypeError('"ext" argument must be a string');u(T);var H=0,q=-1,L=!0,Q;if(z!==void 0&&z.length>0&&z.length<=T.length){if(z.length===T.length&&z===T)return"";var M=z.length-1,J=-1;for(Q=T.length-1;Q>=0;--Q){var X=T.charCodeAt(Q);if(X===47){if(!L){H=Q+1;break}}else{if(J===-1)L=!1,J=Q+1;if(M>=0)if(X===z.charCodeAt(M)){if(--M===-1)q=Q}else M=-1,q=J}}if(H===q)q=J;else if(q===-1)q=T.length;return T.slice(H,q)}else{for(Q=T.length-1;Q>=0;--Q)if(T.charCodeAt(Q)===47){if(!L){H=Q+1;break}}else if(q===-1)L=!1,q=Q+1;if(q===-1)return"";return T.slice(H,q)}}function d1(T){u(T);var z=-1,H=0,q=-1,L=!0,Q=0;for(var M=T.length-1;M>=0;--M){var J=T.charCodeAt(M);if(J===47){if(!L){H=M+1;break}continue}if(q===-1)L=!1,q=M+1;if(J===46){if(z===-1)z=M;else if(Q!==1)Q=1}else if(z!==-1)Q=-1}if(z===-1||q===-1||Q===0||Q===1&&z===q-1&&z===H+1)return"";return T.slice(z,q)}function b1(T){if(T===null||typeof T!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof T);return C0("/",T)}function g1(T){u(T);var z={root:"",dir:"",base:"",ext:"",name:""};if(T.length===0)return z;var H=T.charCodeAt(0),q=H===47,L;if(q)z.root="/",L=1;else L=0;var Q=-1,M=0,J=-1,X=!0,$=T.length-1,Y=0;for(;$>=L;--$){if(H=T.charCodeAt($),H===47){if(!X){M=$+1;break}continue}if(J===-1)X=!1,J=$+1;if(H===46){if(Q===-1)Q=$;else if(Y!==1)Y=1}else if(Q!==-1)Y=-1}if(Q===-1||J===-1||Y===0||Y===1&&Q===J-1&&Q===M+1){if(J!==-1)if(M===0&&q)z.base=z.name=T.slice(1,J);else z.base=z.name=T.slice(M,J)}else{if(M===0&&q)z.name=T.slice(1,Q),z.base=T.slice(1,J);else z.name=T.slice(M,Q),z.base=T.slice(M,J);z.ext=T.slice(Q,J)}if(M>0)z.dir=T.slice(0,M-1);else if(q)z.dir="/";return z}var p1="/",i1=":",S1,_0;var s1=K0(()=>{S1=((T)=>(T.posix=T,T))({resolve:V1,normalize:C1,isAbsolute:l1,join:u1,relative:B1,_makeLong:h1,dirname:n1,basename:c1,extname:d1,format:b1,parse:g1,sep:p1,delimiter:i1,win32:null,posix:null}),_0=S1});var Z1=null;async function o1(){if(Z1)return Z1;try{if(typeof window!=="undefined"&&typeof fetch!=="undefined"){let T=await fetch("./complete-dataset-2025.json");if(!T.ok)throw new Error(`Failed to load dataset: ${T.status} ${T.statusText}`);let z=await T.json();return Z1=z,z}else{let T=await import("fs"),H=(await Promise.resolve().then(() => (s1(),m1))).join(process.cwd(),"dist","complete-dataset-2025.json"),q=T.readFileSync(H,"utf8"),L=JSON.parse(q);return Z1=L,L}}catch(T){throw console.error("Error loading dataset:",T),new Error("Failed to load baseball dataset. Please ensure complete-dataset-2025.json is available.")}}async function r1(){return(await o1()).teams.map((z)=>`${z.team}-${z.year}.html`)}async function _1(T){let z=await o1(),H=T.replace(".html","").split("-")[0],q=z.teams.find((J)=>J.team===H);if(!q)throw new Error(`Team ${H} not found in dataset`);let L=[],Q=[],M=[];return q.players.forEach((J)=>{let X={name:J.name,player_id:J.player_id,team:J.team,year:J.year};if(J.batting)L.push({...X,PA:J.batting.PA,stats:J.batting.stats,rates:J.batting.rates,baserunning:J.batting.baserunning});if(J.pitching)Q.push({...X,TBF:J.pitching.TBF,stats:J.pitching.stats,rates:J.pitching.rates});if(J.fielding)M.push({...X,position:J.fielding.position,stats:J.fielding.stats})}),{batters:L,pitchers:Q,fielders:M}}function e(T,z,H,q){let L=T.map((J)=>{let X=H.find(($)=>$.player_id===J);if(!X)throw new Error(`Lineup player not found: ${J}`);return X}),Q=q.find((J)=>J.player_id===z);if(!Q)throw new Error(`Starting pitcher not found: ${z}`);let M=new Set;for(let J of L){if(M.has(J.player_id))throw new Error(`Duplicate player in lineup: ${J.player_id}`);M.add(J.player_id)}if(M.has(z))throw new Error(`Pitcher also appears in lineup: ${z}`);return{lineup:L,pitcher:Q}}function N1(T,z){return(T+z)/2}function s(T,z){return T==null||isNaN(T)||T===0?z:T}var a1=0.22,t1=0.08,e1=0.03;function E0(T,z){let H=T.rates||{},q=z.rates||{},L=T.stats||{},Q=D(s(H.kRate,a1),"batter.kRate"),M=D(s(q.kRate,a1),"pitcher.kRate"),J=D(s(H.bbRate,t1),"batter.bbRate"),X=D(s(q.bbRate,t1),"pitcher.bbRate"),$=D(s(H.hrRate,e1),"batter.hrRate"),Y=D(s(q.hrRate,e1),"pitcher.hrRate"),U=D(H.BABIP??0.29,"batter.BABIP"),F=D(q.BABIP??0.29,"pitcher.BABIP"),k=Math.max(0,T.PA||0),h=Math.max(0,L.HBP??0),X1=Math.max(0,L.singles??0),p=Math.max(0,L.doubles??0),l=Math.max(0,L.triples??0),w=N1(Q,M),v=N1(J,X),C=k>0?h/k:0.01,O=N1($,Y),Z=w+v+C+O,A=Math.max(0,1-Z),S=Math.max(0.27,Math.min(0.33,N1(U,F)))*A,$1=A-S,N=0.75,V=0.2,_=0.05,K=S*N,j=S*V,W=S*_,g=w+v+C+O+K+j+W,m=0.58;if(g>1-m){let I=(1-m)/g;w*=I,v*=I,C*=I,O*=I,K*=I,j*=I,W*=I,$1=1-(w+v+C+O+K+j+W)}let t={K:D(w,"K"),BB:D(v,"BB"),HBP:D(C,"HBP"),HR:D(O,"HR"),"1B":D(K,"1B"),"2B":D(j,"2B"),"3B":D(W,"3B"),Out:D($1,"Out")},P1=Object.values(t).reduce((I,Y0)=>I+Y0,0);if(P1>0)Object.keys(t).forEach((I)=>{t[I]=t[I]/P1});return t}function D(T,z){if(typeof T!=="number"||isNaN(T))return 0;if(T<0){if(z)console.warn(`[probabilityModel] Clamped negative value for ${z}: ${T} → 0`);return 0}if(T>1){if(z)console.warn(`[probabilityModel] Clamped value >1 for ${z}: ${T} → 1`);return 1}return T}function E1(T){let{lineup:z,pitcher:H}=T;return z.map((q)=>{let L=E0(q,H);return{batter_id:q.player_id,pitcher_id:H.player_id,probabilities:L}})}function T1(T){let z=Object.values(T).reduce((q,L)=>q+L,0),H=Math.random()*z;for(let[q,L]of Object.entries(T))if((H-=L)<=0)return q;return Object.keys(T).pop()||""}var D0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},k0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function T0(T){if(T==="Out"){let z=T1(D0),H=T1(k0[z]);return`${z} to ${H}`}return T}function z0(T){if(!T||typeof T!=="string")return"";let z=T.replace(/\*/g,"").split(/[/,]/)[0],H={"1":"P","2":"C","3":"1B","4":"2B","5":"3B","6":"SS","7":"LF","8":"CF","9":"RF",D:"DH",H:"PH"};if(H[z])return H[z];let q=z.charAt(0);if(H[q])return H[q];return z}function H0(){return{inning:1,top:!0,outs:0,bases:[null,null,null],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function D1(T){let z=[];if(T[0])z.push(0);if(T[1]&&T[0])z.push(1);if(T[2]&&T[1]&&T[0])z.push(2);return z}function k1(T,z,H){let q=0,L=[null,null,null];for(let M=2;M>=0;M--){if(!T[M])continue;let J=T[M],X=J.baserunning?.speed||50,$=J.baserunning?.runsBaserunning||0,Y=M+(z==="1B"?1:z==="2B"?2:z==="3B"?3:4);if(z==="1B"){if(X>70&&Math.random()<0.15)Y=Math.min(Y+1,3)}else if(z==="2B"){if(M===0&&$>2&&Math.random()<0.25)Y=3}if(Y>=3)q++;else L[Y]=J}let Q={"1B":0,"2B":1,"3B":2}[z];if(Q!==void 0)L[Q]=H;if(z==="HR")q++;return[L,q]}function q0(T,z,H,q,L,Q,M,J,X){let $=J||T1,Y=X||T0,U=H.top?0:1,F=U===0?T:z,k=U===0?Q:M,h=U===0?L:q,X1=Array.isArray(h)?h:[],p=H.lineupIndices[U],l=F[p%F.length],w=k.lineup[p%k.lineup.length],v=l.probabilities;if(H.pitcherFatigue&&H.pitcherFatigue[1-U]){H.pitcherFatigue[1-U].battersFaced++;let N=H.pitcherFatigue[1-U].battersFaced;if(N>18){let _=Math.min((N-18)*0.005,0.05);v={...v};let K=v.Out;if(v.BB)v.BB+=_;if(v["1B"])v["1B"]+=_;if(v.Out){if(v.Out-=_,v.Out<0.5*K)v.Out=0.5*K}let j=Object.values(v).reduce((W,g)=>W+g,0);Object.keys(v).forEach((W)=>v[W]=Math.max(0,v[W]/j))}}let C=$(v),O=Y(C);H.lineupIndices[U]++;let Z=void 0,A="",Y1=!1,S=!1,$1=!1;if(C==="Out"){let N=O.match(/to ([A-Z0-9]+)/);if(N){if(A=N[1],Z=X1.find((V)=>V.position===A),Z&&Z.stats){let V=Number(Z.stats.E)||0,_=Number(Z.stats.PO)||0,K=Number(Z.stats.A)||0,j=_+K+V,W=j>0?V/j:0.01;if(Math.random()<W)Y1=!0}else if(Math.random()<0.01)Y1=!0}}if(Y1){let[N,V]=k1(H.bases,"1B",w);return H.bases=N,H.score[U]+=V,{batter_id:l.batter_id,outcome:`Error on ${A}`,fielder:Z,fielderPosition:A}}if(C==="Out"&&/^Groundout to [A-Z0-9]+$/.test(O)&&H.outs===0){let N=D1(H.bases);if(N.length>=2){let V=0.01;if(Z&&Z.stats){let _=Number(Z.stats.RF)||0,K=Number(Z.stats.TZ)||0,j=Number(Z.stats.FP)||0.985,W=Math.max(0,(_-4.5)*0.005),g=Math.max(0,K*0.002),m=j>0.995?0.01:0;V=Math.min(0.05,V+W+g+m)}if(Math.random()<V){$1=!0;let _=N.slice().sort((K,j)=>j-K);for(let K=0;K<2&&K<_.length;K++)H.bases[_[K]]=null;return H.outs=3,{batter_id:l.batter_id,outcome:"Grounded into triple play",...Z?{fielder:Z,fielderPosition:A}:{}}}}}if(C==="Out"&&/^Groundout to [A-Z0-9]+$/.test(O)&&H.outs<2){let N=D1(H.bases);if(N.length>=1){let V=0.25;if(Z&&Z.stats){let _=Number(Z.stats.RF)||0,K=Number(Z.stats.TZ)||0,j=Number(Z.stats.FP)||0.985,W=Math.max(0,(_-4.5)*0.05),g=Math.max(0,K*0.02),m=j>0.995?0.1:0;V=Math.min(0.6,V+W+g+m)}if(Math.random()<V){S=!0;let _=Math.max(...N);return H.bases[_]=null,H.outs=Math.min(H.outs+2,3),{batter_id:l.batter_id,outcome:"Grounded into double play",...Z?{fielder:Z,fielderPosition:A}:{}}}}}if(C==="Out"&&/^Groundout to [A-Z0-9]+$/.test(O)){H.outs++;let N=D1(H.bases);for(let V of N.slice().sort((_,K)=>K-_))if(H.bases[V])if(V===2)H.bases[V]=null,H.score[U]+=1;else H.bases[V+1]=H.bases[V],H.bases[V]=null;return{batter_id:l.batter_id,outcome:O,...Z?{fielder:Z,fielderPosition:A}:{}}}if(C==="Out"||C==="K")H.outs++;else if(C==="BB"||C==="HBP"){let[N,V]=k1(H.bases,"1B",w);H.bases=N,H.score[U]+=V}else{let[N,V]=k1(H.bases,C,w);H.bases=N,H.score[U]+=V}if(C==="K"||C==="BB"){let N=X1.find((V)=>V.position==="C");if(N&&N.stats){let V=Number(N.stats.FP)||0.985,_=Number(N.stats.PB)||0,K=V>0.995?0.001:0.005;if(Math.random()<K){for(let j=2;j>=0;j--)if(H.bases[j])if(j===2)H.bases[j]=null,H.score[U]++;else H.bases[j+1]=H.bases[j],H.bases[j]=null;return{batter_id:l.batter_id,outcome:"Strikeout, but passed ball allows runner to advance",fielder:N,fielderPosition:"C"}}}}return{batter_id:l.batter_id,outcome:O,...Z?{fielder:Z,fielderPosition:A}:{}}}function U1(T,z,H,q,L,Q,M){let J=M||Math.random;if(!z.bases[Q-1])return{success:!1,out:!1,description:`No runner on base ${Q} to steal from.`};let X=T===2?0.6:T===3?0.3:0.1;if(H?.baserunning&&L?.stats){let Y=H.baserunning.speed||50,U=L.stats.armStrength||50,F=H.name||H.player_id||"Unknown Runner",k=L.name||L.player_id||"Unknown Catcher";if(console.log(`[STEAL ATTEMPT] Runner: ${F} (speed: ${Y}), Catcher: ${k} (arm: ${U})`),X=0.5+(Y-U)/200,T===3)X-=0.2;if(T===4)X-=0.4;X=Math.max(0.05,Math.min(0.95,X))}if(J(1)<X){let Y=z.bases[Q-1];if(z.bases[Q-1]=null,T<=3)z.bases[T-1]=Y;else z.score[z.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${T===4?"Home":T}`}}else return z.bases[Q-1]=null,z.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${T===4?"Home":T}`}}function v1(T,z,H,q,L,Q){let M=Q||Math.random;if(!z.bases[T-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${T} to pick off.`};let J=0.05,X=0.1;if(q?.stats&&H?.baserunning){let Y=q.stats.pickoffs||0,U=H.baserunning.speed||50;J=0.03+Y*0.02-(U-50)/1000,J=Math.max(0.01,Math.min(0.15,J))}if(L?.stats)X=0.05+(1-(L.stats.FP||0.985))*2,X=Math.max(0.01,Math.min(0.2,X));let $=M(1);if($<J)return z.bases[T-1]=null,z.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${T}`};else if($<J+X){let Y=z.bases[T-1];if(z.bases[T-1]=null,T<3)z.bases[T]=Y;else z.score[z.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${T}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${T} unsuccessful`}}function W1(T,z){let{inning:H,top:q,outs:L,score:Q}=T,[M,J]=Q;if(H<9)return!1;if(q&&L===3){if(J>M)return z("Home",Q,H,!0),!0;return!1}if(!q&&L===3)if(M>J)return z("Away",Q,H,!1),!0;else if(J>M)return z("Home",Q,H,!1),!0;else return!1;if(!q&&L<3&&J>M)return z("Home",Q,H,!1),!0;return!1}var n=document.getElementById("home-team-select"),c=document.getElementById("away-team-select"),O1=document.getElementById("load-teams-btn"),y=document.getElementById("status"),K1=document.getElementById("lineups-container"),z1=document.getElementById("game-state-container"),G=document.getElementById("next-atbat-btn"),d=document.getElementById("atbat-result-container"),I1=document.getElementById("customize-home-lineup-btn"),G1=document.getElementById("customize-away-lineup-btn"),i=document.getElementById("custom-lineup-modal"),x1=document.getElementById("close-lineup-modal"),F1=document.getElementById("lineup-modal-title"),w1=document.getElementById("custom-lineup-form"),o=document.getElementById("batting-order-list"),r=document.getElementById("pitcher-select"),R=document.getElementById("lineup-error"),H1=document.getElementById("steal-2b-btn"),q1=document.getElementById("steal-3b-btn"),J1=document.getElementById("steal-home-btn"),L1=document.getElementById("pickoff-1b-btn"),M1=document.getElementById("pickoff-2b-btn"),Q1=document.getElementById("pickoff-3b-btn"),A1=document.getElementById("simulate-full-game-btn");function y1(T,z){if(!K1)return;K1.innerHTML="";let H=(q,L)=>{if(!q)return`<div><strong>${L}:</strong> Not loaded</div>`;let Q=q.lineup||q.batters||[],M=q.pitcher||q.pitchers&&q.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${L} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>BABIP</th></tr></thead>
          <tbody>
            ${(Q||[]).slice(0,9).map((J,X)=>{let $=J.position?z0(J.position):"",Y=J.rates?.BABIP?Number(J.rates.BABIP).toFixed(3):"";return`<tr><td>${X+1}</td><td>${J.name||""}${$?` <span class='pos-label'>(${$})</span>`:""}</td><td>${Y}</td></tr>`}).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${M.name}</div>
      </div>
    `};K1.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${H(T,"Home")}</div>
      <div style="flex:1;min-width:250px;">${H(z,"Away")}</div>
    </div>
  `}function x(T,z,H,q,L,Q,M){if(!z1)return;if(!T||!z||!H){if(z1.innerHTML="<em>Game not started.</em>",G)G.style.display="none";return}if(G)G.style.display="";let J=T,{inning:X,top:$,outs:Y,bases:U,score:F,lineupIndices:k}=J,h=$?0:1,X1=h===0?L:q,p=h===0?H:z;if(!p){if(z1.innerHTML="<em>Roster not loaded.</em>",G)G.style.display="none";return}let l=k[h]%p.lineup.length,w=p.lineup[l],v=(h===0?z:H).pitcher,C=["1B","2B","3B"].map((O,Z)=>J.bases[Z]?O:"").filter(Boolean).join(", ")||"Empty";z1.innerHTML=`
    <div><strong>Inning:</strong> ${X} (${$?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${Y}</div>
    <div><strong>Bases:</strong> ${C}</div>
    <div><strong>Score:</strong> Away ${F[0]} &ndash; Home ${F[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${w.name} (vs ${v.name})</div>
  `}function b(T,z,H){if(!d)return;if(!T)return;z.push(T),H()}function P(T){if(!d)return;d.innerHTML="";let z=null,H=null;for(let q of T){if(q.inning!==z||q.top!==H){let M=document.createElement("div");M.style.marginTop="1em",M.style.fontWeight="bold",M.textContent=`Inning ${q.inning} - ${q.top?"Top":"Bottom"}`,d.appendChild(M),z=q.inning,H=q.top}let L=["1B","2B","3B"].map((M,J)=>q.bases[J]?M:"").filter(Boolean).join(", ")||"Empty",Q=document.createElement("div");Q.innerHTML=`<strong>${q.batterName}:</strong> ${q.outcome} <span style="color:#888">(Outs: ${q.outs}, Score: Away ${q.score[0]} – Home ${q.score[1]}, Bases: ${L})</span>`,d.appendChild(Q)}}function f(T,z){T(),z()}var E={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeFielders:null,awayFielders:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};async function W0(){try{return await r1()}catch(T){return console.error("Error fetching available teams:",T),[]}}function a(T,z){let H=T.find((L)=>L.position===z);if(H)return H;let q=T.find((L)=>L.positions&&L.positions.includes(z));if(q)return q;return T.find((L)=>L.stats)||{stats:{armStrength:50,FP:0.985}}}function J0(T,z,H,q){let L=document.querySelector(".sticky-action-bar");if(L)L.querySelectorAll("button").forEach((M)=>{M.disabled=!0,M.classList.add("disabled-greyed")});if(y)y.textContent=`Game Over: ${T} wins! Final Score: Away ${z[0]} – Home ${z[1]} (${H}${q?" Top":" Bottom"})`;if(d){let Q=document.createElement("div");Q.style.marginTop="1em",Q.style.fontWeight="bold",Q.style.color="#b00",Q.textContent=`Game Over: ${T} wins! Final Score: Away ${z[0]} – Home ${z[1]} (${H}${q?" Top":" Bottom"})`,d.appendChild(Q)}}function L0(){if(!E.homeRoster||!E.awayRoster)return;E.homeMatchups=E1(E.homeRoster),E.awayMatchups=E1(E.awayRoster),E.gameState=H0(),E.atBatLog=[],P(E.atBatLog),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)}function M0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups||!E.homeRoster||!E.awayRoster)return;let T=E.gameState,z=T.top?0:1,H=z===0?E.awayRoster:E.homeRoster,q=T.lineupIndices[z]%H.lineup.length,L=H.lineup[q],Q=q0(E.awayMatchups,E.homeMatchups,T,E.awayFielders||[],E.homeFielders||[],E.awayRoster,E.homeRoster);if(b({batterName:L.name,outcome:Q.outcome,outs:T.outs,score:[...T.score],bases:T.bases.map(($)=>$?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>P(E.atBatLog)),W1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},J0)){f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B);return}let J="",X=!1;if(T.outs>=3){if(T.top)J="End of top half. Switching to bottom of inning.";else J="End of inning. Advancing to next inning.";if(b({batterName:"::",outcome:J,outs:T.outs,score:[...T.score],bases:T.bases.map(($)=>$?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>P(E.atBatLog)),T.bases=[null,null,null],T.outs=0,T.top)T.top=!1;else T.top=!0,T.inning++;X=!0}if(X){if(W1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},J0)){f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B);return}}f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)}function O0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups)L0();while(E.gameState&&G&&!G.disabled)M0()}async function R1(){if(!n||!c||!y)return;let T=n.value,z=c.value;if(!T||!z)return;y.textContent="Loading lineups...";try{let[H,q]=await Promise.all([_1(T),_1(z)]);E.loadedHome=H,E.loadedAway=q,E.homeFielders=H.fielders,E.awayFielders=q.fielders;let L=H.batters.map((M)=>{let J=H.fielders.find((X)=>X.player_id===M.player_id);if(J)return{...M,...J,stats:{...M.stats,...J.stats},position:J.position};return M}),Q=q.batters.map((M)=>{let J=q.fielders.find((X)=>X.player_id===M.player_id);if(J)return{...M,...J,stats:{...M.stats,...J.stats},position:J.position};return M});E.homeRoster=H&&H.batters&&H.pitchers?e(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:L.slice(0,9).map((M)=>M.player_id),E.customHomePitcher||H.pitchers.find((M)=>M.name&&M.name!=="Player")?.player_id||H.pitchers[0].player_id,L,H.pitchers):null,E.awayRoster=q&&q.batters&&q.pitchers?e(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:Q.slice(0,9).map((M)=>M.player_id),E.customAwayPitcher||q.pitchers.find((M)=>M.name&&M.name!=="Player")?.player_id||q.pitchers[0].player_id,Q,q.pitchers):null,y1(E.homeRoster,E.awayRoster),E.atBatLog=[],P(E.atBatLog),y.textContent="Lineups loaded. Ready to simulate!",L0()}catch(H){y.textContent="Failed to load lineups."}}async function Q0(){if(!y)return;y.textContent="Loading teams...";let T=await W0();if(!T.length){y.textContent="No teams found in data folder.";return}for(let z of[n,c]){if(!z)continue;z.innerHTML="";for(let H of T){let q=document.createElement("option");q.value=H,q.textContent=H.replace(".html",""),z.appendChild(q)}}if(n)n.value="CHC-2025.html";if(c)c.value="MIL-2025.html";if(y.textContent="Select home and away teams.",n&&c)R1()}function I0(){if(!E.loadedHome||!E.loadedAway)return;let T=E.homeRoster?.pitcher?.player_id,z=E.awayRoster?.pitcher?.player_id,H=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.fielders?E.loadedHome.batters.map((M)=>{let J=E.loadedHome.fielders.find((X)=>X.player_id===M.player_id);if(J)return{...M,...J,stats:{...M.stats,...J.stats},position:J.position};return M}):[],q=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.fielders?E.loadedAway.batters.map((M)=>{let J=E.loadedAway.fielders.find((X)=>X.player_id===M.player_id);if(J)return{...M,...J,stats:{...M.stats,...J.stats},position:J.position};return M}):[];E.homeRoster=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.pitchers?e(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:H.slice(0,9).map((M)=>M.player_id),E.customHomePitcher||E.loadedHome.pitchers.find((M)=>M.name&&M.name!=="Player")?.player_id||E.loadedHome.pitchers[0].player_id,H,E.loadedHome.pitchers):null,E.awayRoster=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.pitchers?e(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:q.slice(0,9).map((M)=>M.player_id),E.customAwayPitcher||E.loadedAway.pitchers.find((M)=>M.name&&M.name!=="Player")?.player_id||E.loadedAway.pitchers[0].player_id,q,E.loadedAway.pitchers):null;let L=E.homeRoster?.pitcher?.player_id,Q=E.awayRoster?.pitcher?.player_id;if(E.gameState&&E.gameState.pitcherFatigue){if(T&&L&&T!==L)E.gameState.pitcherFatigue[1]={battersFaced:0},console.log(`\uD83D\uDD04 Home pitcher changed from ${T} to ${L} - fatigue reset`);if(z&&Q&&z!==Q)E.gameState.pitcherFatigue[0]={battersFaced:0},console.log(`\uD83D\uDD04 Away pitcher changed from ${z} to ${Q} - fatigue reset`)}if(E.homeRoster&&E.awayRoster)E.homeMatchups=E1({lineup:E.homeRoster.lineup,pitcher:E.awayRoster.pitcher}),E.awayMatchups=E1({lineup:E.awayRoster.lineup,pitcher:E.homeRoster.pitcher});y1(E.homeRoster,E.awayRoster),x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop)}function X0(T,z,H,q,L){if(E.editingTeam=T,!i||!F1||!o||!r)return;if(F1.textContent=`Customize ${T==="home"?"Home":"Away"} Lineup`,R)R.textContent="";i.style.display="flex";let Q=q,M=L;if(T==="home"&&E.homeRoster)Q=E.homeRoster.lineup?E.homeRoster.lineup.map((J)=>J.player_id):q,M=E.homeRoster.pitcher?E.homeRoster.pitcher.player_id:L;else if(T==="away"&&E.awayRoster)Q=E.awayRoster.lineup?E.awayRoster.lineup.map((J)=>J.player_id):q,M=E.awayRoster.pitcher?E.awayRoster.pitcher.player_id:L;o.innerHTML="";for(let J=0;J<9;J++){let X=document.createElement("li"),$=document.createElement("select");if($.name=`batter${J}`,$.required=!0,$.innerHTML='<option value="">-- Select --</option>'+z.map((Y)=>`<option value="${Y.player_id}">${Y.name} (${Y.PA} PA)</option>`).join(""),Q&&Q[J])$.value=Q[J];X.appendChild($),o.appendChild(X)}if(r.innerHTML='<option value="">-- Select --</option>'+H.filter((J)=>J.name&&J.name!=="Player"&&J.name!=="Pitcher").map((J)=>`<option value="${J.player_id}">${J.name} (${J.stats&&J.stats.IP?J.stats.IP:""} IP)</option>`).join(""),M)r.value=M}function B(){if(!E.gameState)return;if(H1)H1.disabled=!E.gameState.bases[0];if(q1)q1.disabled=!E.gameState.bases[1];if(J1)J1.disabled=!E.gameState.bases[2];if(L1)L1.disabled=!E.gameState.bases[0];if(M1)M1.disabled=!E.gameState.bases[1];if(Q1)Q1.disabled=!E.gameState.bases[2]}if(O1)O1.addEventListener("click",Q0);if(n)n.addEventListener("change",R1);if(c)c.addEventListener("change",R1);if(G)G.addEventListener("click",M0);if(I1)I1.addEventListener("click",()=>{if(!E.loadedHome)return;X0("home",E.loadedHome.batters,E.loadedHome.pitchers,E.customHomeLineup,E.customHomePitcher)});if(G1)G1.addEventListener("click",()=>{if(!E.loadedAway)return;X0("away",E.loadedAway.batters,E.loadedAway.pitchers,E.customAwayLineup,E.customAwayPitcher)});if(x1)x1.addEventListener("click",()=>{if(i)i.style.display="none"});if(w1)w1.addEventListener("submit",(T)=>{if(T.preventDefault(),!o||!r)return;let z=[],H=o.querySelectorAll("select");for(let L of H){if(!L.value){if(R)R.textContent="Please select a player for every lineup slot.";return}z.push(L.value)}if(new Set(z).size!==z.length){if(R)R.textContent="No duplicate players allowed in the lineup.";return}let q=r.value;if(!q){if(R)R.textContent="Please select a starting pitcher.";return}if(z.includes(q)){if(R)R.textContent="Pitcher cannot also be in the batting lineup.";return}if(E.editingTeam==="home")E.customHomeLineup=z,E.customHomePitcher=q;else E.customAwayLineup=z,E.customAwayPitcher=q;if(i)i.style.display="none";I0()});window.addEventListener("DOMContentLoaded",()=>{Q0()});if(H1)H1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,z=T===0?E.awayRoster:E.homeRoster,H=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[0];if(!L)return;let Q=q?a(q,"C"):{stats:{armStrength:50}},M=H.pitcher,J=U1(2,E.gameState,L,M,Q,1);b({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>P(E.atBatLog)),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)});if(q1)q1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,z=T===0?E.awayRoster:E.homeRoster,H=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[1];if(!L)return;let Q=q?a(q,"C"):{stats:{armStrength:50}},M=H.pitcher,J=U1(3,E.gameState,L,M,Q,2);b({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>P(E.atBatLog)),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)});if(J1)J1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,z=T===0?E.awayRoster:E.homeRoster,H=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[2];if(!L)return;let Q=q?a(q,"C"):{stats:{armStrength:50}},M=H.pitcher,J=U1(4,E.gameState,L,M,Q,3);b({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>P(E.atBatLog)),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)});if(L1)L1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,z=T===0?E.awayRoster:E.homeRoster,H=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[0];if(!L)return;let Q=q?a(q,"1B"):{stats:{FP:0.985}},M=H.pitcher,J=v1(1,E.gameState,L,M,Q);b({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>P(E.atBatLog)),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)});if(M1)M1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,z=T===0?E.awayRoster:E.homeRoster,H=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[1];if(!L)return;let Q=q?a(q,"2B"):{stats:{FP:0.985}},M=H.pitcher,J=v1(2,E.gameState,L,M,Q);b({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>P(E.atBatLog)),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)});if(Q1)Q1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,z=T===0?E.awayRoster:E.homeRoster,H=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[2];if(!L)return;let Q=q?a(q,"3B"):{stats:{FP:0.985}},M=H.pitcher,J=v1(3,E.gameState,L,M,Q);b({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>P(E.atBatLog)),f(()=>x(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),B)});if(A1)A1.addEventListener("click",O0);
