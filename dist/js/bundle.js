var J0=Object.create;var{getPrototypeOf:T0,defineProperty:L1,getOwnPropertyNames:Q0}=Object;var X0=Object.prototype.hasOwnProperty;var Y0=(H,q,M)=>{M=H!=null?J0(T0(H)):{};let J=q||!H||!H.__esModule?L1(M,"default",{value:H,enumerable:!0}):M;for(let Q of Q0(H))if(!X0.call(J,Q))L1(J,Q,{get:()=>H[Q],enumerable:!0});return J};var Z0=(H,q)=>{for(var M in q)L1(H,M,{get:q[M],enumerable:!0,configurable:!0,set:(J)=>q[M]=()=>J})};var $0=(H,q)=>()=>(H&&(q=H(H=0)),q);var C0=((H)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(H,{get:(q,M)=>(typeof require!=="undefined"?require:q)[M]}):H)(function(H){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+H+'" is not supported')});var i1={};Z0(i1,{sep:()=>d1,resolve:()=>X1,relative:()=>R1,posix:()=>g1,parse:()=>c1,normalize:()=>K1,join:()=>f1,isAbsolute:()=>A1,format:()=>n1,extname:()=>h1,dirname:()=>l1,delimiter:()=>b1,default:()=>E0,basename:()=>B1,_makeLong:()=>u1});function A(H){if(typeof H!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(H))}function P1(H,q){var M="",J=0,Q=-1,X=0,Y;for(var T=0;T<=H.length;++T){if(T<H.length)Y=H.charCodeAt(T);else if(Y===47)break;else Y=47;if(Y===47){if(Q===T-1||X===1);else if(Q!==T-1&&X===2){if(M.length<2||J!==2||M.charCodeAt(M.length-1)!==46||M.charCodeAt(M.length-2)!==46){if(M.length>2){var Z=M.lastIndexOf("/");if(Z!==M.length-1){if(Z===-1)M="",J=0;else M=M.slice(0,Z),J=M.length-1-M.lastIndexOf("/");Q=T,X=0;continue}}else if(M.length===2||M.length===1){M="",J=0,Q=T,X=0;continue}}if(q){if(M.length>0)M+="/..";else M="..";J=2}}else{if(M.length>0)M+="/"+H.slice(Q+1,T);else M=H.slice(Q+1,T);J=T-Q-1}Q=T,X=0}else if(Y===46&&X!==-1)++X;else X=-1}return M}function V0(H,q){var M=q.dir||q.root,J=q.base||(q.name||"")+(q.ext||"");if(!M)return J;if(M===q.root)return M+J;return M+H+J}function X1(){var H="",q=!1,M;for(var J=arguments.length-1;J>=-1&&!q;J--){var Q;if(J>=0)Q=arguments[J];else{if(M===void 0)M=process.cwd();Q=M}if(A(Q),Q.length===0)continue;H=Q+"/"+H,q=Q.charCodeAt(0)===47}if(H=P1(H,!q),q)if(H.length>0)return"/"+H;else return"/";else if(H.length>0)return H;else return"."}function K1(H){if(A(H),H.length===0)return".";var q=H.charCodeAt(0)===47,M=H.charCodeAt(H.length-1)===47;if(H=P1(H,!q),H.length===0&&!q)H=".";if(H.length>0&&M)H+="/";if(q)return"/"+H;return H}function A1(H){return A(H),H.length>0&&H.charCodeAt(0)===47}function f1(){if(arguments.length===0)return".";var H;for(var q=0;q<arguments.length;++q){var M=arguments[q];if(A(M),M.length>0)if(H===void 0)H=M;else H+="/"+M}if(H===void 0)return".";return K1(H)}function R1(H,q){if(A(H),A(q),H===q)return"";if(H=X1(H),q=X1(q),H===q)return"";var M=1;for(;M<H.length;++M)if(H.charCodeAt(M)!==47)break;var J=H.length,Q=J-M,X=1;for(;X<q.length;++X)if(q.charCodeAt(X)!==47)break;var Y=q.length,T=Y-X,Z=Q<T?Q:T,C=-1,$=0;for(;$<=Z;++$){if($===Z){if(T>Z){if(q.charCodeAt(X+$)===47)return q.slice(X+$+1);else if($===0)return q.slice(X+$)}else if(Q>Z){if(H.charCodeAt(M+$)===47)C=$;else if($===0)C=0}break}var v=H.charCodeAt(M+$),W=q.charCodeAt(X+$);if(v!==W)break;else if(v===47)C=$}var U="";for($=M+C+1;$<=J;++$)if($===J||H.charCodeAt($)===47)if(U.length===0)U+="..";else U+="/..";if(U.length>0)return U+q.slice(X+C);else{if(X+=C,q.charCodeAt(X)===47)++X;return q.slice(X)}}function u1(H){return H}function l1(H){if(A(H),H.length===0)return".";var q=H.charCodeAt(0),M=q===47,J=-1,Q=!0;for(var X=H.length-1;X>=1;--X)if(q=H.charCodeAt(X),q===47){if(!Q){J=X;break}}else Q=!1;if(J===-1)return M?"/":".";if(M&&J===1)return"//";return H.slice(0,J)}function B1(H,q){if(q!==void 0&&typeof q!=="string")throw new TypeError('"ext" argument must be a string');A(H);var M=0,J=-1,Q=!0,X;if(q!==void 0&&q.length>0&&q.length<=H.length){if(q.length===H.length&&q===H)return"";var Y=q.length-1,T=-1;for(X=H.length-1;X>=0;--X){var Z=H.charCodeAt(X);if(Z===47){if(!Q){M=X+1;break}}else{if(T===-1)Q=!1,T=X+1;if(Y>=0)if(Z===q.charCodeAt(Y)){if(--Y===-1)J=X}else Y=-1,J=T}}if(M===J)J=T;else if(J===-1)J=H.length;return H.slice(M,J)}else{for(X=H.length-1;X>=0;--X)if(H.charCodeAt(X)===47){if(!Q){M=X+1;break}}else if(J===-1)Q=!1,J=X+1;if(J===-1)return"";return H.slice(M,J)}}function h1(H){A(H);var q=-1,M=0,J=-1,Q=!0,X=0;for(var Y=H.length-1;Y>=0;--Y){var T=H.charCodeAt(Y);if(T===47){if(!Q){M=Y+1;break}continue}if(J===-1)Q=!1,J=Y+1;if(T===46){if(q===-1)q=Y;else if(X!==1)X=1}else if(q!==-1)X=-1}if(q===-1||J===-1||X===0||X===1&&q===J-1&&q===M+1)return"";return H.slice(q,J)}function n1(H){if(H===null||typeof H!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof H);return V0("/",H)}function c1(H){A(H);var q={root:"",dir:"",base:"",ext:"",name:""};if(H.length===0)return q;var M=H.charCodeAt(0),J=M===47,Q;if(J)q.root="/",Q=1;else Q=0;var X=-1,Y=0,T=-1,Z=!0,C=H.length-1,$=0;for(;C>=Q;--C){if(M=H.charCodeAt(C),M===47){if(!Z){Y=C+1;break}continue}if(T===-1)Z=!1,T=C+1;if(M===46){if(X===-1)X=C;else if($!==1)$=1}else if(X!==-1)$=-1}if(X===-1||T===-1||$===0||$===1&&X===T-1&&X===Y+1){if(T!==-1)if(Y===0&&J)q.base=q.name=H.slice(1,T);else q.base=q.name=H.slice(Y,T)}else{if(Y===0&&J)q.name=H.slice(1,X),q.base=H.slice(1,T);else q.name=H.slice(Y,X),q.base=H.slice(Y,T);q.ext=H.slice(X,T)}if(Y>0)q.dir=H.slice(0,Y-1);else if(J)q.dir="/";return q}var d1="/",b1=":",g1,E0;var p1=$0(()=>{g1=((H)=>(H.posix=H,H))({resolve:X1,normalize:K1,isAbsolute:A1,join:f1,relative:R1,_makeLong:u1,dirname:l1,basename:B1,extname:h1,format:n1,parse:c1,sep:d1,delimiter:b1,win32:null,posix:null}),E0=g1});var Y1=null;async function S1(){if(Y1)return Y1;try{if(typeof window!=="undefined"&&typeof fetch!=="undefined"){let H=await fetch("./complete-dataset-2025.json");if(!H.ok)throw new Error(`Failed to load dataset: ${H.status} ${H.statusText}`);let q=await H.json();return Y1=q,q}else{let H=await import("fs"),M=(await Promise.resolve().then(() => (p1(),i1))).join(process.cwd(),"dist","complete-dataset-2025.json"),J=H.readFileSync(M,"utf8"),Q=JSON.parse(J);return Y1=Q,Q}}catch(H){throw console.error("Error loading dataset:",H),new Error("Failed to load baseball dataset. Please ensure complete-dataset-2025.json is available.")}}async function m1(){return(await S1()).teams.map((q)=>`${q.team}-${q.year}.html`)}async function j1(H){let q=await S1(),M=H.replace(".html","").split("-")[0],J=q.teams.find((T)=>T.team===M);if(!J)throw new Error(`Team ${M} not found in dataset`);let Q=[],X=[],Y=[];return J.players.forEach((T)=>{let Z={name:T.name,player_id:T.player_id,team:T.team,year:T.year};if(T.batting)Q.push({...Z,PA:T.batting.PA,stats:T.batting.stats,rates:T.batting.rates,baserunning:T.batting.baserunning});if(T.pitching)X.push({...Z,TBF:T.pitching.TBF,stats:T.pitching.stats,rates:T.pitching.rates});if(T.fielding)Y.push({...Z,position:T.fielding.position,stats:T.fielding.stats})}),{batters:Q,pitchers:X,fielders:Y}}function a(H,q,M,J){let Q=H.map((T)=>{let Z=M.find((C)=>C.player_id===T);if(!Z)throw new Error(`Lineup player not found: ${T}`);return Z}),X=J.find((T)=>T.player_id===q);if(!X)throw new Error(`Starting pitcher not found: ${q}`);let Y=new Set;for(let T of Q){if(Y.has(T.player_id))throw new Error(`Duplicate player in lineup: ${T.player_id}`);Y.add(T.player_id)}if(Y.has(q))throw new Error(`Pitcher also appears in lineup: ${q}`);return{lineup:Q,pitcher:X}}function v0(H,q){return(H+q)/2}function p(H,q){return H==null||isNaN(H)||H===0?q:H}var Z1=0.22,$1=0.08,C1=0.03;function s1(H,q){let M=H.rates||{},J=q.rates||{},Q=H.stats||{},X=L(p(M.kRate,Z1),"batter.kRate"),Y=L(p(J.kRate,Z1),"pitcher.kRate"),T=L(p(M.bbRate,$1),"batter.bbRate"),Z=L(p(J.bbRate,$1),"pitcher.bbRate"),C=L(p(M.hrRate,C1),"batter.hrRate"),$=L(p(J.hrRate,C1),"pitcher.hrRate"),v=L(M.BABIP??0.29,"batter.BABIP"),W=L(J.BABIP??0.29,"pitcher.BABIP"),U=Math.max(0,H.PA||0),R=Math.max(0,Q.HBP??0),o=Math.max(0,Q.singles??0),u=Math.max(0,Q.doubles??0),_=Math.max(0,Q.triples??0),c=L(Z1>0?X*Y/Z1:0,"K"),N=L($1>0?T*Z/$1:0,"BB"),k=L(C1>0?C*$/C1:0,"HR"),x=L(v0(v,W),"BABIP"),K=L(U>0?R/U:0,"HBP"),G=c+N+K+k,b=Math.max(0,1-G),g=x*b,N1=b-g,V=o+u+_,E=V>0?o/V:0.7,j=V>0?u/V:0.2,P=V>0?_/V:0.1;return{K:L(c,"K"),BB:L(N,"BB"),HBP:L(K,"HBP"),HR:L(k,"HR"),"1B":L(g*E,"1B"),"2B":L(g*j,"2B"),"3B":L(g*P,"3B"),Out:L(N1,"Out")}}function L(H,q){if(typeof H!=="number"||isNaN(H))return 0;if(H<0){if(q)console.warn(`[probabilityModel] Clamped negative value for ${q}: ${H} → 0`);return 0}if(H>1){if(q)console.warn(`[probabilityModel] Clamped value >1 for ${q}: ${H} → 1`);return 1}return H}function t(H){let{lineup:q,pitcher:M}=H;return q.map((J)=>{let Q=s1(J,M);return{batter_id:J.player_id,pitcher_id:M.player_id,probabilities:Q}})}function e(H){let q=Object.values(H).reduce((J,Q)=>J+Q,0),M=Math.random()*q;for(let[J,Q]of Object.entries(H))if((M-=Q)<=0)return J;return Object.keys(H).pop()||""}var N0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},L0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function o1(H){if(H==="Out"){let q=e(N0),M=e(L0[q]);return`${q} to ${M}`}return H}function r1(){return{inning:1,top:!0,outs:0,bases:[null,null,null],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function U1(H){let q=[];if(H[0])q.push(0);if(H[1]&&H[0])q.push(1);if(H[2]&&H[1]&&H[0])q.push(2);return q}function k1(H,q,M){let J=0,Q=[null,null,null];for(let Y=2;Y>=0;Y--){if(!H[Y])continue;let T=Y+(q==="1B"?1:q==="2B"?2:q==="3B"?3:4);if(T>=3)J++;else Q[T]=H[Y]}let X={"1B":0,"2B":1,"3B":2}[q];if(X!==void 0)Q[X]=M;if(q==="HR")J++;return[Q,J]}function a1(H,q,M,J,Q,X,Y,T,Z){let C=T||e,$=Z||o1,v=M.top?0:1,W=v===0?H:q,U=v===0?X:Y,R=v===0?Q:J,o=Array.isArray(R)?R:[],u=M.lineupIndices[v],_=W[u%W.length],c=U.lineup[u%U.lineup.length],N=_.probabilities;if(M.pitcherFatigue&&M.pitcherFatigue[1-v]){M.pitcherFatigue[1-v].battersFaced++;let V=M.pitcherFatigue[1-v].battersFaced;if(V>18){let j=Math.min((V-18)*0.005,0.05);N={...N};let P=N.Out;if(N.BB)N.BB+=j;if(N["1B"])N["1B"]+=j;if(N.Out){if(N.Out-=j,N.Out<0.5*P)N.Out=0.5*P}let r=Object.values(N).reduce((i,q0)=>i+q0,0);Object.keys(N).forEach((i)=>N[i]=Math.max(0,N[i]/r))}}let k=C(N),x=$(k);M.lineupIndices[v]++;let K=void 0,G="",b=!1,g=!1,N1=!1;if(k==="Out"){let V=x.match(/to ([A-Z0-9]+)/);if(V){if(G=V[1],K=o.find((E)=>E.position===G),K&&K.stats){let E=Number(K.stats.E)||0,j=Number(K.stats.PO)||0,P=Number(K.stats.A)||0,r=j+P+E,i=r>0?E/r:0.01;if(Math.random()<i)b=!0}else if(Math.random()<0.01)b=!0}}if(b){let[V,E]=k1(M.bases,"1B",c);return M.bases=V,M.score[v]+=E,{batter_id:_.batter_id,outcome:`Error on ${G}`,fielder:K,fielderPosition:G}}if(k==="Out"&&/^Groundout to [A-Z0-9]+$/.test(x)&&M.outs===0){let V=U1(M.bases);if(V.length>=2){if(Math.random()<0.01){N1=!0;let E=V.slice().sort((j,P)=>P-j);for(let j=0;j<2&&j<E.length;j++)M.bases[E[j]]=null;return M.outs=3,{batter_id:_.batter_id,outcome:"Grounded into triple play",...K?{fielder:K,fielderPosition:G}:{}}}}}if(k==="Out"&&/^Groundout to [A-Z0-9]+$/.test(x)&&M.outs<2){let V=U1(M.bases);if(V.length>=1){if(Math.random()<0.25){g=!0;let E=Math.max(...V);return M.bases[E]=null,M.outs=Math.min(M.outs+2,3),{batter_id:_.batter_id,outcome:"Grounded into double play",...K?{fielder:K,fielderPosition:G}:{}}}}}if(k==="Out"&&/^Groundout to [A-Z0-9]+$/.test(x)){M.outs++;let V=U1(M.bases);for(let E of V.slice().sort((j,P)=>P-j))if(M.bases[E])if(E===2)M.bases[E]=null,M.score[v]+=1;else M.bases[E+1]=M.bases[E],M.bases[E]=null;return{batter_id:_.batter_id,outcome:x,...K?{fielder:K,fielderPosition:G}:{}}}if(k==="Out"||k==="K")M.outs++;else if(k==="BB"||k==="HBP"){let[V,E]=k1(M.bases,"1B",c);M.bases=V,M.score[v]+=E}else{let[V,E]=k1(M.bases,k,c);M.bases=V,M.score[v]+=E}return{batter_id:_.batter_id,outcome:x,...K?{fielder:K,fielderPosition:G}:{}}}function V1(H,q,M,J,Q,X,Y){let T=Y||Math.random;if(!q.bases[X-1])return{success:!1,out:!1,description:`No runner on base ${X} to steal from.`};let Z=H===2?0.6:H===3?0.3:0.1;if(M?.baserunning&&Q?.stats){let $=M.baserunning.speed||50,v=Q.stats.armStrength||50,W=M.name||M.player_id||"Unknown Runner",U=Q.name||Q.player_id||"Unknown Catcher";if(console.log(`[STEAL ATTEMPT] Runner: ${W} (speed: ${$}), Catcher: ${U} (arm: ${v})`),Z=0.5+($-v)/200,H===3)Z-=0.2;if(H===4)Z-=0.4;Z=Math.max(0.05,Math.min(0.95,Z))}if(T(1)<Z){let $=q.bases[X-1];if(q.bases[X-1]=null,H<=3)q.bases[H-1]=$;else q.score[q.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${H===4?"Home":H}`}}else return q.bases[X-1]=null,q.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${H===4?"Home":H}`}}function E1(H,q,M,J,Q,X){let Y=X||Math.random;if(!q.bases[H-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${H} to pick off.`};let T=0.05,Z=0.1;if(J?.stats&&M?.baserunning){let $=J.stats.pickoffs||0,v=M.baserunning.speed||50;T=0.03+$*0.02-(v-50)/1000,T=Math.max(0.01,Math.min(0.15,T))}if(Q?.stats)Z=0.05+(1-(Q.stats.FP||0.985))*2,Z=Math.max(0.01,Math.min(0.2,Z));let C=Y(1);if(C<T)return q.bases[H-1]=null,q.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${H}`};else if(C<T+Z){let $=q.bases[H-1];if(q.bases[H-1]=null,H<3)q.bases[H]=$;else q.score[q.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${H}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${H} unsuccessful`}}function D1(H,q){let{inning:M,top:J,outs:Q,score:X}=H,[Y,T]=X;if(M<9)return!1;if(J&&Q===3){if(T>Y)return q("Home",X,M,!0),!0;return!1}if(!J&&Q===3)if(Y>T)return q("Away",X,M,!1),!0;else if(T>Y)return q("Home",X,M,!1),!0;else return!1;if(!J&&Q<3&&T>Y)return q("Home",X,M,!1),!0;return!1}var l=document.getElementById("home-team-select"),B=document.getElementById("away-team-select"),O1=document.getElementById("load-teams-btn"),I=document.getElementById("status"),v1=document.getElementById("lineups-container"),z1=document.getElementById("game-state-container"),D=document.getElementById("next-atbat-btn"),h=document.getElementById("atbat-result-container"),W1=document.getElementById("customize-home-lineup-btn"),_1=document.getElementById("customize-away-lineup-btn"),d=document.getElementById("custom-lineup-modal"),I1=document.getElementById("close-lineup-modal"),w1=document.getElementById("lineup-modal-title"),F1=document.getElementById("custom-lineup-form"),S=document.getElementById("batting-order-list"),m=document.getElementById("pitcher-select"),w=document.getElementById("lineup-error"),H1=document.getElementById("steal-2b-btn"),M1=document.getElementById("steal-3b-btn"),q1=document.getElementById("steal-home-btn"),J1=document.getElementById("pickoff-1b-btn"),T1=document.getElementById("pickoff-2b-btn"),Q1=document.getElementById("pickoff-3b-btn"),y1=document.getElementById("simulate-full-game-btn");function x1(H,q){if(!v1)return;v1.innerHTML="";let M=(J,Q)=>{if(!J)return`<div><strong>${Q}:</strong> Not loaded</div>`;let X=J.lineup||J.batters||[],Y=J.pitcher||J.pitchers&&J.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${Q} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>PA</th></tr></thead>
          <tbody>
            ${(X||[]).slice(0,9).map((T,Z)=>`<tr><td>${Z+1}</td><td>${T.name||""}${T.position?` <span class='pos-label'>(${T.position})</span>`:""}</td><td>${T.PA||""}</td></tr>`).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${Y.name}</div>
      </div>
    `};v1.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${M(H,"Home")}</div>
      <div style="flex:1;min-width:250px;">${M(q,"Away")}</div>
    </div>
  `}function O(H,q,M,J,Q,X,Y){if(!z1)return;if(!H||!q||!M){if(z1.innerHTML="<em>Game not started.</em>",D)D.style.display="none";return}if(D)D.style.display="";let T=H,{inning:Z,top:C,outs:$,bases:v,score:W,lineupIndices:U}=T,R=C?0:1,o=R===0?Q:J,u=R===0?M:q;if(!u){if(z1.innerHTML="<em>Roster not loaded.</em>",D)D.style.display="none";return}let _=U[R]%u.lineup.length,c=u.lineup[_],N=(R===0?q:M).pitcher,k=["1B","2B","3B"].map((x,K)=>T.bases[K]?x:"").filter(Boolean).join(", ")||"Empty";z1.innerHTML=`
    <div><strong>Inning:</strong> ${Z} (${C?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${$}</div>
    <div><strong>Bases:</strong> ${k}</div>
    <div><strong>Score:</strong> Away ${W[0]} &ndash; Home ${W[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${c.name} (vs ${N.name})</div>
  `}function n(H,q,M){if(!h)return;if(!H)return;q.push(H),M()}function F(H){if(!h)return;h.innerHTML="";let q=null,M=null;for(let J of H){if(J.inning!==q||J.top!==M){let Y=document.createElement("div");Y.style.marginTop="1em",Y.style.fontWeight="bold",Y.textContent=`Inning ${J.inning} - ${J.top?"Top":"Bottom"}`,h.appendChild(Y),q=J.inning,M=J.top}let Q=["1B","2B","3B"].map((Y,T)=>J.bases[T]?Y:"").filter(Boolean).join(", ")||"Empty",X=document.createElement("div");X.innerHTML=`<strong>${J.batterName}:</strong> ${J.outcome} <span style="color:#888">(Outs: ${J.outs}, Score: Away ${J.score[0]} – Home ${J.score[1]}, Bases: ${Q})</span>`,h.appendChild(X)}}function y(H,q){H(),q()}var z={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeFielders:null,awayFielders:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};async function K0(){try{return await m1()}catch(H){return console.error("Error fetching available teams:",H),[]}}function s(H,q){let M=H.find((Q)=>Q.position===q);if(M)return M;let J=H.find((Q)=>Q.positions&&Q.positions.includes(q));if(J)return J;return H.find((Q)=>Q.stats)||{stats:{armStrength:50,FP:0.985}}}function t1(H,q,M,J){let Q=document.querySelector(".sticky-action-bar");if(Q)Q.querySelectorAll("button").forEach((Y)=>{Y.disabled=!0,Y.classList.add("disabled-greyed")});if(I)I.textContent=`Game Over: ${H} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${M}${J?" Top":" Bottom"})`;if(h){let X=document.createElement("div");X.style.marginTop="1em",X.style.fontWeight="bold",X.style.color="#b00",X.textContent=`Game Over: ${H} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${M}${J?" Top":" Bottom"})`,h.appendChild(X)}}function e1(){if(!z.homeRoster||!z.awayRoster)return;z.homeMatchups=t(z.homeRoster),z.awayMatchups=t(z.awayRoster),z.gameState=r1(),z.atBatLog=[],F(z.atBatLog),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)}function z0(){if(!z.gameState||!z.homeMatchups||!z.awayMatchups||!z.homeRoster||!z.awayRoster)return;let H=z.gameState,q=H.top?0:1,M=q===0?z.awayRoster:z.homeRoster,J=H.lineupIndices[q]%M.lineup.length,Q=M.lineup[J],X=a1(z.awayMatchups,z.homeMatchups,H,[],[],z.awayRoster,z.homeRoster);if(n({batterName:Q.name,outcome:X.outcome,outs:H.outs,score:[...H.score],bases:H.bases.map((C)=>C?1:0),inning:H.inning,top:H.top},z.atBatLog,()=>F(z.atBatLog)),D1({inning:H.inning,top:H.top,score:H.score,outs:H.outs},t1)){y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f);return}let T="",Z=!1;if(H.outs>=3){if(H.top)T="End of top half. Switching to bottom of inning.";else T="End of inning. Advancing to next inning.";if(n({batterName:"::",outcome:T,outs:H.outs,score:[...H.score],bases:H.bases.map((C)=>C?1:0),inning:H.inning,top:H.top},z.atBatLog,()=>F(z.atBatLog)),H.bases=[null,null,null],H.outs=0,H.top)H.top=!1;else H.top=!0,H.inning++;Z=!0}if(Z){if(D1({inning:H.inning,top:H.top,score:H.score,outs:H.outs},t1)){y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f);return}}y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)}function j0(){if(!z.gameState||!z.homeMatchups||!z.awayMatchups)e1();while(z.gameState&&D&&!D.disabled)z0()}async function G1(){if(!l||!B||!I)return;let H=l.value,q=B.value;if(!H||!q)return;I.textContent="Loading lineups...";try{let[M,J]=await Promise.all([j1(H),j1(q)]);z.loadedHome=M,z.loadedAway=J,z.homeFielders=M.fielders,z.awayFielders=J.fielders;let Q=M.batters.map((Y)=>{let T=M.fielders.find((Z)=>Z.player_id===Y.player_id);if(T)return{...Y,...T,stats:{...Y.stats,...T.stats},position:T.position};return Y}),X=J.batters.map((Y)=>{let T=J.fielders.find((Z)=>Z.player_id===Y.player_id);if(T)return{...Y,...T,stats:{...Y.stats,...T.stats},position:T.position};return Y});z.homeRoster=M&&M.batters&&M.pitchers?a(z.customHomeLineup&&z.customHomeLineup.length===9?z.customHomeLineup:Q.slice(0,9).map((Y)=>Y.player_id),z.customHomePitcher||M.pitchers.find((Y)=>Y.name&&Y.name!=="Player")?.player_id||M.pitchers[0].player_id,Q,M.pitchers):null,z.awayRoster=J&&J.batters&&J.pitchers?a(z.customAwayLineup&&z.customAwayLineup.length===9?z.customAwayLineup:X.slice(0,9).map((Y)=>Y.player_id),z.customAwayPitcher||J.pitchers.find((Y)=>Y.name&&Y.name!=="Player")?.player_id||J.pitchers[0].player_id,X,J.pitchers):null,x1(z.homeRoster,z.awayRoster),z.atBatLog=[],F(z.atBatLog),I.textContent="Lineups loaded. Ready to simulate!",e1()}catch(M){I.textContent="Failed to load lineups."}}async function H0(){if(!I)return;I.textContent="Loading teams...";let H=await K0();if(!H.length){I.textContent="No teams found in data folder.";return}for(let q of[l,B]){if(!q)continue;q.innerHTML="";for(let M of H){let J=document.createElement("option");J.value=M,J.textContent=M.replace(".html",""),q.appendChild(J)}}if(l)l.value="CHC-2025.html";if(B)B.value="MIL-2025.html";if(I.textContent="Select home and away teams.",l&&B)G1()}function U0(){if(!z.loadedHome||!z.loadedAway)return;let H=z.loadedHome&&z.loadedHome.batters&&z.loadedHome.fielders?z.loadedHome.batters.map((M)=>{let J=z.loadedHome.fielders.find((Q)=>Q.player_id===M.player_id);if(J)return{...M,...J,stats:{...M.stats,...J.stats},position:J.position};return M}):[],q=z.loadedAway&&z.loadedAway.batters&&z.loadedAway.fielders?z.loadedAway.batters.map((M)=>{let J=z.loadedAway.fielders.find((Q)=>Q.player_id===M.player_id);if(J)return{...M,...J,stats:{...M.stats,...J.stats},position:J.position};return M}):[];if(z.homeRoster=z.loadedHome&&z.loadedHome.batters&&z.loadedHome.pitchers?a(z.customHomeLineup&&z.customHomeLineup.length===9?z.customHomeLineup:H.slice(0,9).map((M)=>M.player_id),z.customHomePitcher||z.loadedHome.pitchers.find((M)=>M.name&&M.name!=="Player")?.player_id||z.loadedHome.pitchers[0].player_id,H,z.loadedHome.pitchers):null,z.awayRoster=z.loadedAway&&z.loadedAway.batters&&z.loadedAway.pitchers?a(z.customAwayLineup&&z.customAwayLineup.length===9?z.customAwayLineup:q.slice(0,9).map((M)=>M.player_id),z.customAwayPitcher||z.loadedAway.pitchers.find((M)=>M.name&&M.name!=="Player")?.player_id||z.loadedAway.pitchers[0].player_id,q,z.loadedAway.pitchers):null,z.homeRoster&&z.awayRoster)z.homeMatchups=t({lineup:z.homeRoster.lineup,pitcher:z.awayRoster.pitcher}),z.awayMatchups=t({lineup:z.awayRoster.lineup,pitcher:z.homeRoster.pitcher});x1(z.homeRoster,z.awayRoster),O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop)}function M0(H,q,M,J,Q){if(z.editingTeam=H,!d||!w1||!S||!m)return;if(w1.textContent=`Customize ${H==="home"?"Home":"Away"} Lineup`,w)w.textContent="";d.style.display="flex";let X=J,Y=Q;if(H==="home"&&z.homeRoster)X=z.homeRoster.lineup?z.homeRoster.lineup.map((T)=>T.player_id):J,Y=z.homeRoster.pitcher?z.homeRoster.pitcher.player_id:Q;else if(H==="away"&&z.awayRoster)X=z.awayRoster.lineup?z.awayRoster.lineup.map((T)=>T.player_id):J,Y=z.awayRoster.pitcher?z.awayRoster.pitcher.player_id:Q;S.innerHTML="";for(let T=0;T<9;T++){let Z=document.createElement("li"),C=document.createElement("select");if(C.name=`batter${T}`,C.required=!0,C.innerHTML='<option value="">-- Select --</option>'+q.map(($)=>`<option value="${$.player_id}">${$.name} (${$.PA} PA)</option>`).join(""),X&&X[T])C.value=X[T];Z.appendChild(C),S.appendChild(Z)}if(m.innerHTML='<option value="">-- Select --</option>'+M.filter((T)=>T.name&&T.name!=="Player"&&T.name!=="Pitcher").map((T)=>`<option value="${T.player_id}">${T.name} (${T.stats&&T.stats.IP?T.stats.IP:""} IP)</option>`).join(""),Y)m.value=Y}function f(){if(!z.gameState)return;if(H1)H1.disabled=!z.gameState.bases[0];if(M1)M1.disabled=!z.gameState.bases[1];if(q1)q1.disabled=!z.gameState.bases[2];if(J1)J1.disabled=!z.gameState.bases[0];if(T1)T1.disabled=!z.gameState.bases[1];if(Q1)Q1.disabled=!z.gameState.bases[2]}if(O1)O1.addEventListener("click",H0);if(l)l.addEventListener("change",G1);if(B)B.addEventListener("change",G1);if(D)D.addEventListener("click",z0);if(W1)W1.addEventListener("click",()=>{if(!z.loadedHome)return;M0("home",z.loadedHome.batters,z.loadedHome.pitchers,z.customHomeLineup,z.customHomePitcher)});if(_1)_1.addEventListener("click",()=>{if(!z.loadedAway)return;M0("away",z.loadedAway.batters,z.loadedAway.pitchers,z.customAwayLineup,z.customAwayPitcher)});if(I1)I1.addEventListener("click",()=>{if(d)d.style.display="none"});if(F1)F1.addEventListener("submit",(H)=>{if(H.preventDefault(),!S||!m)return;let q=[],M=S.querySelectorAll("select");for(let Q of M){if(!Q.value){if(w)w.textContent="Please select a player for every lineup slot.";return}q.push(Q.value)}if(new Set(q).size!==q.length){if(w)w.textContent="No duplicate players allowed in the lineup.";return}let J=m.value;if(!J){if(w)w.textContent="Please select a starting pitcher.";return}if(q.includes(J)){if(w)w.textContent="Pitcher cannot also be in the batting lineup.";return}if(z.editingTeam==="home")z.customHomeLineup=q,z.customHomePitcher=J;else z.customAwayLineup=q,z.customAwayPitcher=J;if(d)d.style.display="none";U0()});window.addEventListener("DOMContentLoaded",()=>{H0()});if(H1)H1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let H=z.gameState.top?0:1,q=H===0?z.awayRoster:z.homeRoster,M=H===0?z.homeRoster:z.awayRoster,J=H===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[0];if(!Q)return;let X=J?s(J,"C"):{stats:{armStrength:50}},Y=M.pitcher,T=V1(2,z.gameState,Q,Y,X,1);n({batterName:Q.name,outcome:T.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>F(z.atBatLog)),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)});if(M1)M1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let H=z.gameState.top?0:1,q=H===0?z.awayRoster:z.homeRoster,M=H===0?z.homeRoster:z.awayRoster,J=H===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[1];if(!Q)return;let X=J?s(J,"C"):{stats:{armStrength:50}},Y=M.pitcher,T=V1(3,z.gameState,Q,Y,X,2);n({batterName:Q.name,outcome:T.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>F(z.atBatLog)),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)});if(q1)q1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let H=z.gameState.top?0:1,q=H===0?z.awayRoster:z.homeRoster,M=H===0?z.homeRoster:z.awayRoster,J=H===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[2];if(!Q)return;let X=J?s(J,"C"):{stats:{armStrength:50}},Y=M.pitcher,T=V1(4,z.gameState,Q,Y,X,3);n({batterName:Q.name,outcome:T.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>F(z.atBatLog)),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)});if(J1)J1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let H=z.gameState.top?0:1,q=H===0?z.awayRoster:z.homeRoster,M=H===0?z.homeRoster:z.awayRoster,J=H===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[0];if(!Q)return;let X=J?s(J,"1B"):{stats:{FP:0.985}},Y=M.pitcher,T=E1(1,z.gameState,Q,Y,X);n({batterName:Q.name,outcome:T.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>F(z.atBatLog)),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)});if(T1)T1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let H=z.gameState.top?0:1,q=H===0?z.awayRoster:z.homeRoster,M=H===0?z.homeRoster:z.awayRoster,J=H===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[1];if(!Q)return;let X=J?s(J,"2B"):{stats:{FP:0.985}},Y=M.pitcher,T=E1(2,z.gameState,Q,Y,X);n({batterName:Q.name,outcome:T.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>F(z.atBatLog)),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)});if(Q1)Q1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let H=z.gameState.top?0:1,q=H===0?z.awayRoster:z.homeRoster,M=H===0?z.homeRoster:z.awayRoster,J=H===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[2];if(!Q)return;let X=J?s(J,"3B"):{stats:{FP:0.985}},Y=M.pitcher,T=E1(3,z.gameState,Q,Y,X);n({batterName:Q.name,outcome:T.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>F(z.atBatLog)),y(()=>O(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),f)});if(y1)y1.addEventListener("click",j0);
