function n0(q){let Q=/<!--([\s\S]*?)-->/g,J=[],X;while((X=Q.exec(q))!==null)J.push(X[1]);return J}function i0(q,Q){let J=new DOMParser;for(let X of q)if(X.includes(`id="${Q}"`))return J.parseFromString(X,"text/html").querySelector(`table#${Q}`);return null}function E0(q){let Q=document.createElement("div");Q.style.display="none",document.body.appendChild(Q),Q.innerHTML=q;let J=Q.querySelector("table#players_standard_batting"),X=Q.querySelector("table#players_standard_pitching"),Y=n0(q),$=i0(Y,"players_standard_fielding");return Q.remove(),{batting:J,pitching:X,fielding:$}}function L0(q){if(!q||!q.href)return null;let Q=q.href.match(/\/players\/.\/([^/.]+)\.shtml/);return Q?Q[1]:null}function o0(q){return q.toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,12)}function _0(q){if(!q)return[];let Q=Array.from(q.querySelectorAll("tbody > tr")).filter((Y)=>!Y.classList.contains("thead")),J=Array.from(q.querySelectorAll("thead tr th")).map((Y)=>(Y.textContent??"").trim()),X=[];for(let Y of Q){let $=[Y.querySelector("th"),...Y.querySelectorAll("td")];if($.length!==J.length)continue;let K={};for(let Z=0;Z<J.length;Z++){let j=J[Z],z=$[Z];if(Z===0){let W=z?.textContent?.trim()||"",O=z?.querySelector?.("a"),G=L0(O);if(/^\d+$/.test(W)){let F=Y.querySelector("td");W=F?.textContent?.trim()||"(unknown)",O=F?.querySelector?.("a"),G=L0(O)||G}K.name=W,K.player_id=G||o0(W)}else{let W=z?.textContent?.trim()||"",O=Number(W.replace(/,/g,""));K[j]=isNaN(O)?W:O}}X.push(K)}return X}function H0(q){return q.map((Q)=>{let J=Number(Q.PA)||0,X=Number(Q.AB)||0,Y=Number(Q.H)||0,$=Number(Q.HR)||0,K=Number(Q.BB)||0,Z=Number(Q.SO)||0,j=Number(Q.SF)||0,z=Number(Q.HBP)||0,W=Number(Q["2B"])||0,O=Number(Q["3B"])||0,G=Y-W-O-$,F=X-Z-$+j,E=F>0?(Y-$)/F:null,_=J>0?Z/J:null,T=J>0?K/J:null,I=J>0?$/J:null;return{name:Q.name,player_id:Q.player_id,PA:J,stats:{H:Y,HR:$,BB:K,SO:Z,SF:j,HBP:z,singles:G,doubles:W,triples:O},rates:{kRate:_,bbRate:T,hrRate:I,BABIP:E}}})}function I0(q){return q.map((Q)=>{let J=Number(Q.IP)||0,X=Number(Q.TBF)||0,Y=Number(Q.H)||0,$=Number(Q.HR)||0,K=Number(Q.BB)||0,Z=Number(Q.SO)||0,j=Number(Q.HBP)||0,z=X>0?Z/X:null,W=X>0?K/X:null,O=X>0?$/X:null,G=X-Z-$-K-j,F=G>0?(Y-$)/G:null;return{name:Q.name,player_id:Q.player_id,TBF:X,stats:{IP:J,H:Y,HR:$,BB:K,SO:Z,HBP:j},rates:{kRate:z,bbRate:W,hrRate:O,BABIP:F}}})}function i(q,Q,J,X){let Y=q.map((Z)=>{let j=J.find((z)=>z.player_id===Z);if(!j)throw new Error(`Lineup player not found: ${Z}`);return j}),$=X.find((Z)=>Z.player_id===Q);if(!$)throw new Error(`Starting pitcher not found: ${Q}`);let K=new Set;for(let Z of Y){if(K.has(Z.player_id))throw new Error(`Duplicate player in lineup: ${Z.player_id}`);K.add(Z.player_id)}if(K.has(Q))throw new Error(`Pitcher also appears in lineup: ${Q}`);return{lineup:Y,pitcher:$}}function r0(q,Q){return(q+Q)/2}function c(q,Q){return q==null||isNaN(q)||q===0?Q:q}var e=0.22,q0=0.08,J0=0.03;function x0(q,Q){let J=q.rates||{},X=Q.rates||{},Y=q.stats||{},$=M(c(J.kRate,e),"batter.kRate"),K=M(c(X.kRate,e),"pitcher.kRate"),Z=M(c(J.bbRate,q0),"batter.bbRate"),j=M(c(X.bbRate,q0),"pitcher.bbRate"),z=M(c(J.hrRate,J0),"batter.hrRate"),W=M(c(X.hrRate,J0),"pitcher.hrRate"),O=M(J.BABIP??0.29,"batter.BABIP"),G=M(X.BABIP??0.29,"pitcher.BABIP"),F=Math.max(0,q.PA||0),E=Math.max(0,Y.HBP??0),_=Math.max(0,Y.singles??0),T=Math.max(0,Y.doubles??0),I=Math.max(0,Y.triples??0),k=M(e>0?$*K/e:0,"K"),x=M(q0>0?Z*j/q0:0,"BB"),p=M(J0>0?z*W/J0:0,"HR"),D0=M(r0(O,G),"BABIP"),t=M(F>0?E/F:0,"HBP"),C=k+x+t+p,D=Math.max(0,1-C),v=D0*D,A=D-v,P=_+T+I,R=P>0?_/P:0.7,O0=P>0?T/P:0.2,l0=P>0?I/P:0.1;return{K:M(k,"K"),BB:M(x,"BB"),HBP:M(t,"HBP"),HR:M(p,"HR"),"1B":M(v*R,"1B"),"2B":M(v*O0,"2B"),"3B":M(v*l0,"3B"),Out:M(A,"Out")}}function M(q,Q){if(typeof q!=="number"||isNaN(q))return 0;if(q<0){if(Q)console.warn(`[probabilityModel] Clamped negative value for ${Q}: ${q} → 0`);return 0}if(q>1){if(Q)console.warn(`[probabilityModel] Clamped value >1 for ${Q}: ${q} → 1`);return 1}return q}function o(q){let{lineup:Q,pitcher:J}=q;return Q.map((X)=>{let Y=x0(X,J);return{batter_id:X.player_id,pitcher_id:J.player_id,probabilities:Y}})}function r(q){let Q=Object.values(q).reduce((X,Y)=>X+Y,0),J=Math.random()*Q;for(let[X,Y]of Object.entries(q))if((J-=Y)<=0)return X;return Object.keys(q).pop()||""}var s0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},a0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function P0(q){if(q==="Out"){let Q=r(s0),J=r(a0[Q]);return`${Q} to ${J}`}return q}function A0(){return{inning:1,top:!0,outs:0,bases:[0,0,0],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function C0(q){let Q=[];if(q[0])Q.push(0);if(q[1]&&q[0])Q.push(1);if(q[2]&&q[1]&&q[0])Q.push(2);return Q}function M0(q,Q){let J=0,X=[0,0,0];for(let $=2;$>=0;$--){if(!q[$])continue;let K=$+(Q==="1B"?1:Q==="2B"?2:Q==="3B"?3:4);if(K>=3)J++;else X[K]=1}let Y={"1B":0,"2B":1,"3B":2}[Q];if(Y!==void 0)X[Y]=1;if(Q==="HR")J++;return[X,J]}function y0(q,Q,J,X,Y,$,K){let Z=$||r,j=K||P0,z=J.top?0:1,W=z===0?q:Q,O=z===0?Y:X,G=Array.isArray(O)?O:[],F=J.lineupIndices[z],E=W[F%W.length],_=E.probabilities;if(J.pitcherFatigue&&J.pitcherFatigue[1-z]){J.pitcherFatigue[1-z].battersFaced++;let C=J.pitcherFatigue[1-z].battersFaced;if(C>18){let v=Math.min((C-18)*0.005,0.05);_={..._};let A=_.Out;if(_.BB)_.BB+=v;if(_["1B"])_["1B"]+=v;if(_.Out){if(_.Out-=v,_.Out<0.5*A)_.Out=0.5*A}let P=Object.values(_).reduce((R,O0)=>R+O0,0);Object.keys(_).forEach((R)=>_[R]=Math.max(0,_[R]/P))}}let T=Z(_),I=j(T);J.lineupIndices[z]++;let k=void 0,x="",p=!1,D0=!1,t=!1;if(T==="Out"){let C=I.match(/to ([A-Z0-9]+)/);if(C){if(x=C[1],k=G.find((D)=>D.position===x),k&&k.stats){let D=Number(k.stats.E)||0,v=Number(k.stats.PO)||0,A=Number(k.stats.A)||0,P=v+A+D,R=P>0?D/P:0.01;if(Math.random()<R)p=!0}else if(Math.random()<0.01)p=!0}}if(p){let[C,D]=M0(J.bases,"1B");return J.bases=C,J.score[z]+=D,{batter_id:E.batter_id,outcome:`Error on ${x}`,fielder:k,fielderPosition:x}}if(T==="Out"&&/^Groundout to [A-Z0-9]+$/.test(I)&&J.outs===0){let C=C0(J.bases);if(C.length>=2){if(Math.random()<0.01){t=!0;let D=C.slice().sort((v,A)=>A-v);for(let v=0;v<2&&v<D.length;v++)J.bases[D[v]]=0;return J.outs=3,{batter_id:E.batter_id,outcome:"Grounded into triple play",...k?{fielder:k,fielderPosition:x}:{}}}}}if(T==="Out"&&/^Groundout to [A-Z0-9]+$/.test(I)&&J.outs<2){let C=C0(J.bases);if(C.length>=1){if(Math.random()<0.25){D0=!0;let D=Math.max(...C);return J.bases[D]=0,J.outs=Math.min(J.outs+2,3),{batter_id:E.batter_id,outcome:"Grounded into double play",...k?{fielder:k,fielderPosition:x}:{}}}}}if(T==="Out"&&/^Groundout to [A-Z0-9]+$/.test(I)){J.outs++;let C=C0(J.bases);for(let D of C.slice().sort((v,A)=>A-v))if(J.bases[D])if(D===2)J.bases[D]=0,J.score[z]+=1;else J.bases[D+1]=1,J.bases[D]=0,console.log("Advancing forced runner from",D,"to",D+1,"Bases:",J.bases);return{batter_id:E.batter_id,outcome:I,...k?{fielder:k,fielderPosition:x}:{}}}if(T==="Out"||T==="K")J.outs++;else if(T==="BB"||T==="HBP"){let[C,D]=M0(J.bases,"1B");J.bases=C,J.score[z]+=D}else{let[C,D]=M0(J.bases,T);J.bases=C,J.score[z]+=D}return{batter_id:E.batter_id,outcome:I,...k?{fielder:k,fielderPosition:x}:{}}}function Q0(q,Q,J,X,Y,$,K){let Z=K||Math.random;if(!Q.bases[$-1])return{success:!1,out:!1,description:`No runner on base ${$} to steal from.`};let j=q===2?0.6:q===3?0.3:0.1;if(J?.stats&&Y?.stats){let W=Number(J.stats.SPD||J.stats.SB||50),O=Number(Y.stats.ARM||Y.stats["CS%"]||50);if(j=0.5+(W-O)/200,q===3)j-=0.2;if(q===4)j-=0.4;j=Math.max(0.05,Math.min(0.95,j))}if(Z(1)<j){if(Q.bases[$-1]=0,q<=3)Q.bases[q-1]=1;else Q.score[Q.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${q===4?"Home":q}`}}else return Q.bases[$-1]=0,Q.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${q===4?"Home":q}`}}function X0(q,Q,J,X,Y,$){let K=$||Math.random;if(!Q.bases[q-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${q} to pick off.`};let Z=0.05,j=0.1;if(X?.stats&&J?.stats){let W=Number(X.stats.PK||50),O=Number(J.stats.SPD||50);Z=0.03+(W-O)/1000,Z=Math.max(0.01,Math.min(0.15,Z))}if(Y?.stats)j=0.05+Number(Y.stats.E||0)/1000,j=Math.max(0.01,Math.min(0.2,j));let z=K(1);if(z<Z)return Q.bases[q-1]=0,Q.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${q}`};else if(z<Z+j){if(Q.bases[q-1]=0,q<3)Q.bases[q]=1;else Q.score[Q.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${q}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${q} unsuccessful`}}function w0(q,Q){if(!q)return!1;let{inning:J,top:X,score:Y,runsScoredThisHalf:$}=q,[K,Z]=Y;if(X||J<9)return!1;let j=Z-$<=K,z=Z>K;if(j&&z)return Q("Home",Y,J,!1),!0;return!1}function G0(q,Q){if(!q?.isHalfInningOver)return;let{inning:J,top:X,score:Y}=q,[$,K]=Y;if(J<9)return;if(!X){if(K>$){Q("Home",Y,J,!0);return}return}if(X){if($>K){Q("Away",Y,J,!1);return}if(K>$){Q("Home",Y,J,!1);return}}}var f=document.getElementById("home-team-select"),h=document.getElementById("away-team-select"),S0=document.getElementById("load-teams-btn"),S=document.getElementById("status"),F0=document.getElementById("lineups-container"),Y0=document.getElementById("game-state-container"),w=document.getElementById("next-atbat-btn"),g=document.getElementById("atbat-result-container"),g0=document.getElementById("customize-home-lineup-btn"),B0=document.getElementById("customize-away-lineup-btn"),n=document.getElementById("custom-lineup-modal"),R0=document.getElementById("close-lineup-modal"),f0=document.getElementById("lineup-modal-title"),h0=document.getElementById("custom-lineup-form"),s=document.getElementById("batting-order-list"),a=document.getElementById("pitcher-select"),y=document.getElementById("lineup-error"),Z0=document.getElementById("steal-2b-btn"),$0=document.getElementById("steal-3b-btn"),V0=document.getElementById("steal-home-btn"),K0=document.getElementById("pickoff-1b-btn"),z0=document.getElementById("pickoff-2b-btn"),N0=document.getElementById("pickoff-3b-btn"),L=null,H=null,N=null,U=null,m=null,l=null,V=null,t0=1,e0=!0,b=null,U0=null,d=null,j0=null,d0=null,W0=[];async function qq(){return["ARI-2025.html","ATL-2025.html","BAL-2025.html","BOS-2025.html","CHC-2025.html","CHW-2025.html","CIN-2025.html","CLE-2025.html","COL-2025.html","DET-2025.html","HOU-2025.html","KCR-2025.html","LAA-2025.html","LAD-2025.html","MIA-2025.html","MIL-2025.html","MIN-2025.html","NYM-2025.html","NYY-2025.html","OAK-2025.html","PHI-2025.html","PIT-2025.html","SDP-2025.html","SEA-2025.html","SFG-2025.html","STL-2025.html","TBR-2025.html","TEX-2025.html","TOR-2025.html","WSN-2025.html"]}async function b0(q){let J=await(await fetch(`./data/${q}`)).text(),{batting:X,pitching:Y}=E0(J),$=X?_0(X):[],K=Y?_0(Y):[],Z=H0($),j=I0(K);return{batters:Z,pitchers:j}}function u0(q,Q){if(!F0)return;F0.innerHTML="";let J=(X,Y)=>{if(!X)return`<div><strong>${Y}:</strong> Not loaded</div>`;let $=X.lineup||X.batters||[],K=X.pitcher||X.pitchers&&X.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${Y} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>PA</th></tr></thead>
          <tbody>
            ${($||[]).slice(0,9).map((Z,j)=>`<tr><td>${j+1}</td><td>${Z.name||""}</td><td>${Z.PA||""}</td></tr>`).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${K.name}</div>
      </div>
    `};F0.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${J(q,"Home")}</div>
      <div style="flex:1;min-width:250px;">${J(Q,"Away")}</div>
    </div>
  `}function p0(){if(!Y0)return;if(!V||!N||!U){if(Y0.innerHTML="<em>Game not started.</em>",w)w.style.display="none";return}let q=V,{inning:Q,top:J,outs:X,bases:Y,score:$,lineupIndices:K}=q,Z=J?0:1,j=Z===0?l:m,z=Z===0?U:N;if(!z){if(Y0.innerHTML="<em>Roster not loaded.</em>",w)w.style.display="none";return}let W=K[Z]%z.lineup.length,O=z.lineup[W],G=(Z===0?N:U).pitcher,F=["1B","2B","3B"].map((E,_)=>q.bases[_]?E:"").filter(Boolean).join(", ")||"Empty";if(Y0.innerHTML=`
    <div><strong>Inning:</strong> ${Q} (${J?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${X}</div>
    <div><strong>Bases:</strong> ${F}</div>
    <div><strong>Score:</strong> Away ${$[0]} &ndash; Home ${$[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${O.name} (vs ${G.name})</div>
  `,w)w.style.display=""}function u(q,Q=!1){if(!g)return;if(!q)return;W0.push(q),k0()}function k0(){if(!g)return;g.innerHTML="";let q=null,Q=null;for(let J of W0){if(J.inning!==q||J.top!==Q){let $=document.createElement("div");$.style.marginTop="1em",$.style.fontWeight="bold",$.textContent=`Inning ${J.inning} - ${J.top?"Top":"Bottom"}`,g.appendChild($),q=J.inning,Q=J.top}let X=["1B","2B","3B"].map(($,K)=>J.bases[K]?$:"").filter(Boolean).join(", ")||"Empty",Y=document.createElement("div");Y.innerHTML=`<strong>${J.batterName}:</strong> ${J.outcome} <span style="color:#888">(Outs: ${J.outs}, Score: Away ${J.score[0]} – Home ${J.score[1]}, Bases: ${X})</span>`,g.appendChild(Y)}}function v0(q,Q,J,X){if(w)w.disabled=!0;if(S)S.textContent=`Game Over: ${q} wins! Final Score: Away ${Q[0]} – Home ${Q[1]} (${J}${X?" Top":" Bottom"})`;if(g){let Y=document.createElement("div");Y.style.marginTop="1em",Y.style.fontWeight="bold",Y.style.color="#b00",Y.textContent=`Game Over: ${q} wins! Final Score: Away ${Q[0]} – Home ${Q[1]} (${J}${X?" Top":" Bottom"})`,g.appendChild(Y)}}function Jq(){if(!N||!U)return;m=o(N),l=o(U),V=A0(),W0=[],k0(),B()}function Qq(){if(!V||!m||!l)return;let q=V,Q=q.top?0:1,J=Q===0?l:m,X=Q===0?U:N;if(!X)return;let Y=q.lineupIndices[Q]%X.lineup.length,$=X.lineup[Y],K=y0(l,m,q,[],[]);u({batterName:$.name,outcome:K.outcome,outs:q.outs,score:[...q.score],bases:[...q.bases],inning:q.inning,top:q.top});let Z=q;if(!Z._halfInningStartScore)Z._halfInningStartScore=[...q.score];if(w0(Z,v0)){B();return}let j="",z=!1,W=!1,O=!1;if(q.outs>=3){q.outs=0,q.bases=[0,0,0];let G=q.top?q.score[0]-Z._halfInningStartScore[0]:q.score[1]-Z._halfInningStartScore[1];if(q.top)q.top=!1,j="End of top half. Switching to bottom of inning.",z=!0,W=!0;else q.top=!0,q.inning++,j="End of inning. Advancing to next inning.",z=!0,O=!0;Z._halfInningStartScore=[...q.score],Z.isHalfInningOver=!0,Z.runsScoredThisHalf=G}else Z.isHalfInningOver=!1,Z.runsScoredThisHalf=0;if(z){if(g){let G=document.createElement("div");G.innerHTML=`<em>${j}</em>`,g.appendChild(G),t0=q.inning,e0=q.top;let F=document.createElement("div");F.style.marginTop="1em",F.style.fontWeight="bold",F.textContent=`Inning ${q.inning} - ${q.top?"Top":"Bottom"}`,g.appendChild(F)}G0(Z,v0)}else G0(Z,v0);B()}async function T0(){if(!f||!h||!S)return;let q=f.value,Q=h.value;if(!q||!Q)return;S.textContent="Loading lineups...";try{let[J,X]=await Promise.all([b0(q),b0(Q)]);L=J,H=X,N=J&&J.batters&&J.pitchers?i(b&&b.length===9?b:J.batters.slice(0,9).map((Y)=>Y.player_id),U0||J.pitchers[0].player_id,J.batters,J.pitchers):null,U=X&&X.batters&&X.pitchers?i(d&&d.length===9?d:X.batters.slice(0,9).map((Y)=>Y.player_id),j0||X.pitchers[0].player_id,X.batters,X.pitchers):null,u0(N,U),W0=[],k0(),S.textContent="Lineups loaded. Ready to simulate!",console.log("--- Home Roster (normalized, ready for engine) ---"),console.log(JSON.stringify(N,null,2)),console.log("--- Away Roster (normalized, ready for engine) ---"),console.log(JSON.stringify(U,null,2)),Jq()}catch(J){S.textContent="Failed to load lineups."}}async function c0(){if(!S)return;S.textContent="Loading teams...";let q=await qq();if(!q.length){S.textContent="No teams found in data folder.";return}for(let Q of[f,h]){if(!Q)continue;Q.innerHTML="";for(let J of q){let X=document.createElement("option");X.value=J,X.textContent=J.replace(".html",""),Q.appendChild(X)}}if(f)f.value="CHC-2025.html";if(h)h.value="MIL-2025.html";if(S.textContent="Select home and away teams.",f&&h)T0()}function Xq(){if(!L||!H)return;if(N=L&&L.batters&&L.pitchers?i(b&&b.length===9?b:L.batters.slice(0,9).map((q)=>q.player_id),U0||L.pitchers[0].player_id,L.batters,L.pitchers):null,U=H&&H.batters&&H.pitchers?i(d&&d.length===9?d:H.batters.slice(0,9).map((q)=>q.player_id),j0||H.pitchers[0].player_id,H.batters,H.pitchers):null,N&&U)m=o({lineup:N.lineup,pitcher:U.pitcher}),l=o({lineup:U.lineup,pitcher:N.pitcher});u0(N,U),p0()}function m0(q,Q,J,X,Y){if(d0=q,!n||!f0||!s||!a)return;if(f0.textContent=`Customize ${q==="home"?"Home":"Away"} Lineup`,y)y.textContent="";n.style.display="flex";let $=X,K=Y;if(q==="home"&&N)$=N.lineup?N.lineup.map((Z)=>Z.player_id):X,K=N.pitcher?N.pitcher.player_id:Y;else if(q==="away"&&U)$=U.lineup?U.lineup.map((Z)=>Z.player_id):X,K=U.pitcher?U.pitcher.player_id:Y;s.innerHTML="";for(let Z=0;Z<9;Z++){let j=document.createElement("li"),z=document.createElement("select");if(z.name=`batter${Z}`,z.required=!0,z.innerHTML='<option value="">-- Select --</option>'+Q.map((W)=>`<option value="${W.player_id}">${W.name} (${W.PA} PA)</option>`).join(""),$&&$[Z])z.value=$[Z];j.appendChild(z),s.appendChild(j)}if(a.innerHTML='<option value="">-- Select --</option>'+J.map((Z)=>`<option value="${Z.player_id}">${Z.name} (${Z.stats&&Z.stats.IP?Z.stats.IP:""} IP)</option>`).join(""),K)a.value=K}function Yq(){if(!V)return;if(Z0)Z0.disabled=!V.bases[0];if($0)$0.disabled=!V.bases[1];if(V0)V0.disabled=!V.bases[2];if(K0)K0.disabled=!V.bases[0];if(z0)z0.disabled=!V.bases[1];if(N0)N0.disabled=!V.bases[2]}function B(){p0(),Yq()}if(S0)S0.addEventListener("click",c0);if(f)f.addEventListener("change",T0);if(h)h.addEventListener("change",T0);if(w)w.addEventListener("click",Qq);if(g0)g0.addEventListener("click",()=>{if(!L)return;m0("home",L.batters,L.pitchers,b,U0)});if(B0)B0.addEventListener("click",()=>{if(!H)return;m0("away",H.batters,H.pitchers,d,j0)});if(R0)R0.addEventListener("click",()=>{if(n)n.style.display="none"});if(h0)h0.addEventListener("submit",(q)=>{if(q.preventDefault(),!s||!a)return;let Q=[],J=s.querySelectorAll("select");for(let Y of J){if(!Y.value){if(y)y.textContent="Please select a player for every lineup slot.";return}Q.push(Y.value)}if(new Set(Q).size!==Q.length){if(y)y.textContent="No duplicate players allowed in the lineup.";return}let X=a.value;if(!X){if(y)y.textContent="Please select a starting pitcher.";return}if(Q.includes(X)){if(y)y.textContent="Pitcher cannot also be in the batting lineup.";return}if(d0==="home")b=Q,U0=X;else d=Q,j0=X;if(n)n.style.display="none";Xq()});window.addEventListener("DOMContentLoaded",()=>{c0()});if(Z0)Z0.addEventListener("click",()=>{if(!V||!N||!U)return;let q=V.top?0:1,J=(q===0?U:N).lineup.find((K)=>!0)||{},X=(q===0?N:U).pitcher,Y=(q===0?N:U).lineup[0]||{},$=Q0(2,V,J,X,Y,1);u({batterName:"Runner",outcome:$.description,outs:V.outs,score:[...V.score],bases:[...V.bases],inning:V.inning,top:V.top}),B()});if($0)$0.addEventListener("click",()=>{if(!V||!N||!U)return;let q=V.top?0:1,J=(q===0?U:N).lineup.find((K)=>!0)||{},X=(q===0?N:U).pitcher,Y=(q===0?N:U).lineup[0]||{},$=Q0(3,V,J,X,Y,2);u({batterName:"Runner",outcome:$.description,outs:V.outs,score:[...V.score],bases:[...V.bases],inning:V.inning,top:V.top}),B()});if(V0)V0.addEventListener("click",()=>{if(!V||!N||!U)return;let q=V.top?0:1,J=(q===0?U:N).lineup.find((K)=>!0)||{},X=(q===0?N:U).pitcher,Y=(q===0?N:U).lineup[0]||{},$=Q0(4,V,J,X,Y,3);u({batterName:"Runner",outcome:$.description,outs:V.outs,score:[...V.score],bases:[...V.bases],inning:V.inning,top:V.top}),B()});if(K0)K0.addEventListener("click",()=>{if(!V||!N||!U)return;let q=V.top?0:1,J=(q===0?U:N).lineup.find((K)=>!0)||{},X=(q===0?N:U).pitcher,Y=(q===0?N:U).lineup[0]||{},$=X0(1,V,J,X,Y);u({batterName:"Runner",outcome:$.description,outs:V.outs,score:[...V.score],bases:[...V.bases],inning:V.inning,top:V.top}),B()});if(z0)z0.addEventListener("click",()=>{if(!V||!N||!U)return;let q=V.top?0:1,J=(q===0?U:N).lineup.find((K)=>!0)||{},X=(q===0?N:U).pitcher,Y=(q===0?N:U).lineup[0]||{},$=X0(2,V,J,X,Y);u({batterName:"Runner",outcome:$.description,outs:V.outs,score:[...V.score],bases:[...V.bases],inning:V.inning,top:V.top}),B()});if(N0)N0.addEventListener("click",()=>{if(!V||!N||!U)return;let q=V.top?0:1,J=(q===0?U:N).lineup.find((K)=>!0)||{},X=(q===0?N:U).pitcher,Y=(q===0?N:U).lineup[0]||{},$=X0(3,V,J,X,Y);u({batterName:"Runner",outcome:$.description,outs:V.outs,score:[...V.score],bases:[...V.bases],inning:V.inning,top:V.top}),B()});
