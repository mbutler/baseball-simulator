var Z0=Object.create;var{getPrototypeOf:H0,defineProperty:O1,getOwnPropertyNames:U0}=Object;var N0=Object.prototype.hasOwnProperty;var K0=(T,q,z)=>{z=T!=null?Z0(H0(T)):{};let J=q||!T||!T.__esModule?O1(z,"default",{value:T,enumerable:!0}):z;for(let Q of U0(T))if(!N0.call(J,Q))O1(J,Q,{get:()=>T[Q],enumerable:!0});return J};var j0=(T,q)=>{for(var z in q)O1(T,z,{get:q[z],enumerable:!0,configurable:!0,set:(J)=>q[z]=()=>J})};var v0=(T,q)=>()=>(T&&(q=T(T=0)),q);var _0=((T)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(T,{get:(q,z)=>(typeof require!=="undefined"?require:q)[z]}):T)(function(T){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+T+'" is not supported')});var r1={};j0(r1,{sep:()=>m1,resolve:()=>N1,relative:()=>n1,posix:()=>o1,parse:()=>i1,normalize:()=>k1,join:()=>c1,isAbsolute:()=>B1,format:()=>S1,extname:()=>p1,dirname:()=>g1,delimiter:()=>s1,default:()=>D0,basename:()=>b1,_makeLong:()=>d1});function n(T){if(typeof T!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(T))}function l1(T,q){var z="",J=0,Q=-1,Y=0,L;for(var X=0;X<=T.length;++X){if(X<T.length)L=T.charCodeAt(X);else if(L===47)break;else L=47;if(L===47){if(Q===X-1||Y===1);else if(Q!==X-1&&Y===2){if(z.length<2||J!==2||z.charCodeAt(z.length-1)!==46||z.charCodeAt(z.length-2)!==46){if(z.length>2){var $=z.lastIndexOf("/");if($!==z.length-1){if($===-1)z="",J=0;else z=z.slice(0,$),J=z.length-1-z.lastIndexOf("/");Q=X,Y=0;continue}}else if(z.length===2||z.length===1){z="",J=0,Q=X,Y=0;continue}}if(q){if(z.length>0)z+="/..";else z="..";J=2}}else{if(z.length>0)z+="/"+T.slice(Q+1,X);else z=T.slice(Q+1,X);J=X-Q-1}Q=X,Y=0}else if(L===46&&Y!==-1)++Y;else Y=-1}return z}function W0(T,q){var z=q.dir||q.root,J=q.base||(q.name||"")+(q.ext||"");if(!z)return J;if(z===q.root)return z+J;return z+T+J}function N1(){var T="",q=!1,z;for(var J=arguments.length-1;J>=-1&&!q;J--){var Q;if(J>=0)Q=arguments[J];else{if(z===void 0)z=process.cwd();Q=z}if(n(Q),Q.length===0)continue;T=Q+"/"+T,q=Q.charCodeAt(0)===47}if(T=l1(T,!q),q)if(T.length>0)return"/"+T;else return"/";else if(T.length>0)return T;else return"."}function k1(T){if(n(T),T.length===0)return".";var q=T.charCodeAt(0)===47,z=T.charCodeAt(T.length-1)===47;if(T=l1(T,!q),T.length===0&&!q)T=".";if(T.length>0&&z)T+="/";if(q)return"/"+T;return T}function B1(T){return n(T),T.length>0&&T.charCodeAt(0)===47}function c1(){if(arguments.length===0)return".";var T;for(var q=0;q<arguments.length;++q){var z=arguments[q];if(n(z),z.length>0)if(T===void 0)T=z;else T+="/"+z}if(T===void 0)return".";return k1(T)}function n1(T,q){if(n(T),n(q),T===q)return"";if(T=N1(T),q=N1(q),T===q)return"";var z=1;for(;z<T.length;++z)if(T.charCodeAt(z)!==47)break;var J=T.length,Q=J-z,Y=1;for(;Y<q.length;++Y)if(q.charCodeAt(Y)!==47)break;var L=q.length,X=L-Y,$=Q<X?Q:X,V=-1,M=0;for(;M<=$;++M){if(M===$){if(X>$){if(q.charCodeAt(Y+M)===47)return q.slice(Y+M+1);else if(M===0)return q.slice(Y+M)}else if(Q>$){if(T.charCodeAt(z+M)===47)V=M;else if(M===0)V=0}break}var N=T.charCodeAt(z+M),R=q.charCodeAt(Y+M);if(N!==R)break;else if(N===47)V=M}var I="";for(M=z+V+1;M<=J;++M)if(M===J||T.charCodeAt(M)===47)if(I.length===0)I+="..";else I+="/..";if(I.length>0)return I+q.slice(Y+V);else{if(Y+=V,q.charCodeAt(Y)===47)++Y;return q.slice(Y)}}function d1(T){return T}function g1(T){if(n(T),T.length===0)return".";var q=T.charCodeAt(0),z=q===47,J=-1,Q=!0;for(var Y=T.length-1;Y>=1;--Y)if(q=T.charCodeAt(Y),q===47){if(!Q){J=Y;break}}else Q=!1;if(J===-1)return z?"/":".";if(z&&J===1)return"//";return T.slice(0,J)}function b1(T,q){if(q!==void 0&&typeof q!=="string")throw new TypeError('"ext" argument must be a string');n(T);var z=0,J=-1,Q=!0,Y;if(q!==void 0&&q.length>0&&q.length<=T.length){if(q.length===T.length&&q===T)return"";var L=q.length-1,X=-1;for(Y=T.length-1;Y>=0;--Y){var $=T.charCodeAt(Y);if($===47){if(!Q){z=Y+1;break}}else{if(X===-1)Q=!1,X=Y+1;if(L>=0)if($===q.charCodeAt(L)){if(--L===-1)J=Y}else L=-1,J=X}}if(z===J)J=X;else if(J===-1)J=T.length;return T.slice(z,J)}else{for(Y=T.length-1;Y>=0;--Y)if(T.charCodeAt(Y)===47){if(!Q){z=Y+1;break}}else if(J===-1)Q=!1,J=Y+1;if(J===-1)return"";return T.slice(z,J)}}function p1(T){n(T);var q=-1,z=0,J=-1,Q=!0,Y=0;for(var L=T.length-1;L>=0;--L){var X=T.charCodeAt(L);if(X===47){if(!Q){z=L+1;break}continue}if(J===-1)Q=!1,J=L+1;if(X===46){if(q===-1)q=L;else if(Y!==1)Y=1}else if(q!==-1)Y=-1}if(q===-1||J===-1||Y===0||Y===1&&q===J-1&&q===z+1)return"";return T.slice(q,J)}function S1(T){if(T===null||typeof T!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof T);return W0("/",T)}function i1(T){n(T);var q={root:"",dir:"",base:"",ext:"",name:""};if(T.length===0)return q;var z=T.charCodeAt(0),J=z===47,Q;if(J)q.root="/",Q=1;else Q=0;var Y=-1,L=0,X=-1,$=!0,V=T.length-1,M=0;for(;V>=Q;--V){if(z=T.charCodeAt(V),z===47){if(!$){L=V+1;break}continue}if(X===-1)$=!1,X=V+1;if(z===46){if(Y===-1)Y=V;else if(M!==1)M=1}else if(Y!==-1)M=-1}if(Y===-1||X===-1||M===0||M===1&&Y===X-1&&Y===L+1){if(X!==-1)if(L===0&&J)q.base=q.name=T.slice(1,X);else q.base=q.name=T.slice(L,X)}else{if(L===0&&J)q.name=T.slice(1,Y),q.base=T.slice(1,X);else q.name=T.slice(L,Y),q.base=T.slice(L,X);q.ext=T.slice(Y,X)}if(L>0)q.dir=T.slice(0,L-1);else if(J)q.dir="/";return q}var m1="/",s1=":",o1,D0;var a1=v0(()=>{o1=((T)=>(T.posix=T,T))({resolve:N1,normalize:k1,isAbsolute:B1,join:c1,relative:n1,_makeLong:d1,dirname:g1,basename:b1,extname:p1,format:S1,parse:i1,sep:m1,delimiter:s1,win32:null,posix:null}),D0=o1});var K1=null;async function t1(){if(K1)return K1;try{if(typeof window!=="undefined"&&typeof fetch!=="undefined"){let T=await fetch("./complete-dataset-2025.json");if(!T.ok)throw new Error(`Failed to load dataset: ${T.status} ${T.statusText}`);let q=await T.json();return K1=q,q}else{let T=await import("fs"),z=(await Promise.resolve().then(() => (a1(),r1))).join(process.cwd(),"dist","complete-dataset-2025.json"),J=T.readFileSync(z,"utf8"),Q=JSON.parse(J);return K1=Q,Q}}catch(T){throw console.error("Error loading dataset:",T),new Error("Failed to load baseball dataset. Please ensure complete-dataset-2025.json is available.")}}async function e1(){return(await t1()).teams.map((q)=>`${q.team}-${q.year}`)}async function I1(T){let z=(await t1()).teams.find((L)=>`${L.team}-${L.year}`===T);if(!z)throw new Error(`Team ${T} not found in dataset`);let J=[],Q=[],Y=[];return z.players.forEach((L)=>{let X={name:L.name,player_id:L.player_id,team:L.team,year:L.year};if(L.batting)J.push({...X,PA:L.batting.PA,stats:L.batting.stats,rates:L.batting.rates,baserunning:L.batting.baserunning});if(L.pitching)Q.push({...X,TBF:L.pitching.TBF,stats:L.pitching.stats,rates:L.pitching.rates});if(L.fielding)Y.push({...X,position:L.fielding.position,stats:L.fielding.stats})}),{batters:J,pitchers:Q,fielders:Y}}function M1(T,q,z,J){let Q=T.map((X)=>{let $=z.find((V)=>V.player_id===X);if(!$)throw new Error(`Lineup player not found: ${X}`);return $}),Y=J.find((X)=>X.player_id===q);if(!Y)throw new Error(`Starting pitcher not found: ${q}`);let L=new Set;for(let X of Q){if(L.has(X.player_id))throw new Error(`Duplicate player in lineup: ${X.player_id}`);L.add(X.player_id)}return{lineup:Q,pitcher:Y}}function j1(T,q){return(T+q)/2}function L1(T,q){return T==null||isNaN(T)||T===0?q:T}var E0=0.22,T0=0.08,z0=0.03;function v1(T,q,z){let J=T.rates||{},Q=q.rates||{},Y=T.stats||{},L=O(L1(J.kRate,E0),"batter.kRate"),X=O(L1(Q.kRate,E0),"pitcher.kRate"),$=O(L1(J.bbRate,T0),"batter.bbRate"),V=O(L1(Q.bbRate,T0),"pitcher.bbRate"),M=O(L1(J.hrRate,z0),"batter.hrRate"),N=O(L1(Q.hrRate,z0),"pitcher.hrRate"),R=O(J.BABIP??0.29,"batter.BABIP"),I=O(Q.BABIP??0.29,"pitcher.BABIP"),l=Math.max(0,T.PA||0),$1=Math.max(0,Y.HBP??0),E1=Math.max(0,Y.singles??0),b=Math.max(0,Y.doubles??0),T1=Math.max(0,Y.triples??0),B=j1(L,X),c=j1($,V),p=l>0?$1/l:0.01,S=j1(M,N),_=B+c+p+S,W=Math.max(0,1-_),P=Math.max(0.27,Math.min(0.33,j1(R,I))),H=P*W,F=W-H,J1=0.75,H1=0.2,U1=0.05,U=H*J1,Z=H*H1,K=H*U1;if(z){if(z.risp)P+=0.01,Z*=1.1;if(z.late)c*=1.1,B*=1.05;if(z.twoOuts)P-=0.01;H=Math.max(0,Math.min(1,P))*W,F=W-H,U=H*J1,Z=H*H1,K=H*U1}let j=B+c+p+S+U+Z+K,v=0.58;if(j>1-v){let C=(1-v)/j;B*=C,c*=C,p*=C,S*=C,U*=C,Z*=C,K*=C,F=1-(B+c+p+S+U+Z+K)}let D={K:O(B,"K"),BB:O(c,"BB"),HBP:O(p,"HBP"),HR:O(S,"HR"),"1B":O(U,"1B"),"2B":O(Z,"2B"),"3B":O(K,"3B"),Out:O(F,"Out")},e=Object.values(D).reduce((C,V0)=>C+V0,0);if(e>0)Object.keys(D).forEach((C)=>{D[C]=D[C]/e});return D}function O(T,q){if(typeof T!=="number"||isNaN(T))return 0;if(T<0){if(q)console.warn(`[probabilityModel] Clamped negative value for ${q}: ${T} → 0`);return 0}if(T>1){if(q)console.warn(`[probabilityModel] Clamped value >1 for ${q}: ${T} → 1`);return 1}return T}function V1(T){let{lineup:q,pitcher:z}=T;return q.map((J)=>{let Q=v1(J,z);return{batter_id:J.player_id,pitcher_id:z.player_id,probabilities:Q}})}function Z1(T){let q=Object.values(T).reduce((J,Q)=>J+Q,0),z=Math.random()*q;for(let[J,Q]of Object.entries(T))if((z-=Q)<=0)return J;return Object.keys(T).pop()||""}var C0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},O0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function q0(T){if(T==="Out"){let q=Z1(C0),z=Z1(O0[q]);return`${q} to ${z}`}return T}function J0(T){if(!T||typeof T!=="string")return"";let q=T.replace(/\*/g,"").split(/[/,]/)[0],z={"1":"P","2":"C","3":"1B","4":"2B","5":"3B","6":"SS","7":"LF","8":"CF","9":"RF",D:"DH",H:"PH"};if(z[q])return z[q];let J=q.charAt(0);if(z[J])return z[J];return q}function L0(){return{inning:1,top:!0,outs:0,bases:[null,null,null],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function G1(T){let q=[];if(T[0])q.push(0);if(T[1]&&T[0])q.push(1);if(T[2]&&T[1]&&T[0])q.push(2);return q}function x1(T,q,z){let J=0,Q=[null,null,null];for(let L=2;L>=0;L--){if(!T[L])continue;let X=T[L],$=X.baserunning?.speed||50,V=X.baserunning?.runsBaserunning||0,M=L+(q==="1B"?1:q==="2B"?2:q==="3B"?3:4);if(q==="1B"){if($>70&&Math.random()<0.15)M=Math.min(M+1,3)}else if(q==="2B"){if(L===0&&V>2&&Math.random()<0.25)M=3}if(M>=3)J++;else Q[M]=X}let Y={"1B":0,"2B":1,"3B":2}[q];if(Y!==void 0)Q[Y]=z;if(q==="HR")J++;return[Q,J]}function Q0(T,q,z,J,Q,Y,L,X,$){let V=X||Z1,M=$||q0,N=z.top?0:1,R=N===0?T:q,I=N===0?Y:L,l=N===0?Q:J,$1=Array.isArray(l)?l:[],E1=z.lineupIndices[N],b=R[E1%R.length],T1=I.lineup[E1%I.lineup.length],B=!!(z.bases[1]||z.bases[2]),c=z.inning>=8&&Math.abs(z.score[0]-z.score[1])<=2,p=z.outs===2,S={risp:B,late:c,twoOuts:p},_=v1(T1,I.pitcher,S);if(z.pitcherFatigue&&z.pitcherFatigue[1-N]){z.pitcherFatigue[1-N].battersFaced++;let U=z.pitcherFatigue[1-N].battersFaced;if(U>18){let K=Math.min((U-18)*0.005,0.05);_={..._};let j=_.Out;if(_.BB)_.BB+=K;if(_["1B"])_["1B"]+=K;if(_.Out){if(_.Out-=K,_.Out<0.5*j)_.Out=0.5*j}let v=Object.values(_).reduce((D,e)=>D+e,0);Object.keys(_).forEach((D)=>_[D]=Math.max(0,_[D]/v))}}let W=V(_),P=M(W);z.lineupIndices[N]++;let H=void 0,F="",J1=!1,H1=!1,U1=!1;if(W==="Out"){let U=P.match(/to ([A-Z0-9]+)/);if(U){if(F=U[1],H=$1.find((Z)=>Z.position===F),H&&H.stats){let Z=Number(H.stats.E)||0,K=Number(H.stats.PO)||0,j=Number(H.stats.A)||0,v=K+j+Z,D=v>0?Z/v:0.01;if(Math.random()<D)J1=!0}else if(Math.random()<0.01)J1=!0}}if(J1){let[U,Z]=x1(z.bases,"1B",T1);return z.bases=U,z.score[N]+=Z,{batter_id:b.batter_id,outcome:`Error on ${F}`,fielder:H,fielderPosition:F}}if(W==="Out"&&/^Groundout to [A-Z0-9]+$/.test(P)&&z.outs===0){let U=G1(z.bases);if(U.length>=2){let Z=0.01;if(H&&H.stats){let K=Number(H.stats.RF)||0,j=Number(H.stats.TZ)||0,v=Number(H.stats.FP)||0.985,D=Math.max(0,(K-4.5)*0.005),e=Math.max(0,j*0.002),C=v>0.995?0.01:0;Z=Math.min(0.05,Z+D+e+C)}if(Math.random()<Z){U1=!0;let K=U.slice().sort((j,v)=>v-j);for(let j=0;j<2&&j<K.length;j++)z.bases[K[j]]=null;return z.outs=3,{batter_id:b.batter_id,outcome:"Grounded into triple play",...H?{fielder:H,fielderPosition:F}:{}}}}}if(W==="Out"&&/^Groundout to [A-Z0-9]+$/.test(P)&&z.outs<2){let U=G1(z.bases);if(U.length>=1){let Z=0.25;if(H&&H.stats){let K=Number(H.stats.RF)||0,j=Number(H.stats.TZ)||0,v=Number(H.stats.FP)||0.985,D=Math.max(0,(K-4.5)*0.05),e=Math.max(0,j*0.02),C=v>0.995?0.1:0;Z=Math.min(0.6,Z+D+e+C)}if(Math.random()<Z){H1=!0;let K=Math.max(...U);return z.bases[K]=null,z.outs=Math.min(z.outs+2,3),{batter_id:b.batter_id,outcome:"Grounded into double play",...H?{fielder:H,fielderPosition:F}:{}}}}}if(W==="Out"&&/^Groundout to [A-Z0-9]+$/.test(P)){z.outs++;let U=G1(z.bases);for(let Z of U.slice().sort((K,j)=>j-K))if(z.bases[Z])if(Z===2)z.bases[Z]=null,z.score[N]+=1;else z.bases[Z+1]=z.bases[Z],z.bases[Z]=null;return{batter_id:b.batter_id,outcome:P,...H?{fielder:H,fielderPosition:F}:{}}}if(W==="Out"||W==="K")z.outs++;else if(W==="BB"||W==="HBP"){let[U,Z]=x1(z.bases,"1B",T1);z.bases=U,z.score[N]+=Z}else{let[U,Z]=x1(z.bases,W,T1);z.bases=U,z.score[N]+=Z}if(W==="K"||W==="BB"){let U=$1.find((Z)=>Z.position==="C");if(U&&U.stats){let Z=Number(U.stats.FP)||0.985,K=Number(U.stats.PB)||0,j=Z>0.995?0.001:0.005;if(Math.random()<j){for(let v=2;v>=0;v--)if(z.bases[v])if(v===2)z.bases[v]=null,z.score[N]++;else z.bases[v+1]=z.bases[v],z.bases[v]=null;return{batter_id:b.batter_id,outcome:"Strikeout, but passed ball allows runner to advance",fielder:U,fielderPosition:"C"}}}}return{batter_id:b.batter_id,outcome:P,...H?{fielder:H,fielderPosition:F}:{}}}function _1(T,q,z,J,Q,Y,L){let X=L||Math.random;if(!q.bases[Y-1])return{success:!1,out:!1,description:`No runner on base ${Y} to steal from.`};let $=T===2?0.6:T===3?0.3:0.1;if(z?.baserunning&&Q?.stats){let M=z.baserunning.speed||50,N=Q.stats.armStrength||50,R=z.name||z.player_id||"Unknown Runner",I=Q.name||Q.player_id||"Unknown Catcher";if(console.log(`[STEAL ATTEMPT] Runner: ${R} (speed: ${M}), Catcher: ${I} (arm: ${N})`),$=0.5+(M-N)/200,T===3)$-=0.2;if(T===4)$-=0.4;$=Math.max(0.05,Math.min(0.95,$))}if(X(1)<$){let M=q.bases[Y-1];if(q.bases[Y-1]=null,T<=3)q.bases[T-1]=M;else q.score[q.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${T===4?"Home":T}`}}else return q.bases[Y-1]=null,q.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${T===4?"Home":T}`}}function W1(T,q,z,J,Q,Y){let L=Y||Math.random;if(!q.bases[T-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${T} to pick off.`};let X=0.05,$=0.1;if(J?.stats&&z?.baserunning){let M=J.stats.pickoffs||0,N=z.baserunning.speed||50;X=0.03+M*0.02-(N-50)/1000,X=Math.max(0.01,Math.min(0.15,X))}if(Q?.stats)$=0.05+(1-(Q.stats.FP||0.985))*2,$=Math.max(0.01,Math.min(0.2,$));let V=L(1);if(V<X)return q.bases[T-1]=null,q.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${T}`};else if(V<X+$){let M=q.bases[T-1];if(q.bases[T-1]=null,T<3)q.bases[T]=M;else q.score[q.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${T}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${T} unsuccessful`}}function F1(T,q){let{inning:z,top:J,outs:Q,score:Y}=T,[L,X]=Y;if(z<9)return!1;if(J&&Q===3){if(X>L)return q("Home",Y,z,!0),!0;return!1}if(!J&&Q===3)if(L>X)return q("Away",Y,z,!1),!0;else if(X>L)return q("Home",Y,z,!1),!0;else return!1;if(!J&&Q<3&&X>L)return q("Home",Y,z,!1),!0;return!1}var w=document.getElementById("home-team-select"),A=document.getElementById("away-team-select"),w1=document.getElementById("load-teams-btn"),G=document.getElementById("status"),D1=document.getElementById("lineups-container"),d=document.getElementById("game-state-container"),k=document.getElementById("next-atbat-btn"),x=document.getElementById("atbat-result-container"),A1=document.getElementById("customize-home-lineup-btn"),y1=document.getElementById("customize-away-lineup-btn"),z1=document.getElementById("custom-lineup-modal"),R1=document.getElementById("close-lineup-modal"),P1=document.getElementById("lineup-modal-title"),f1=document.getElementById("custom-lineup-form"),Q1=document.getElementById("batting-order-list"),X1=document.getElementById("pitcher-select"),f=document.getElementById("lineup-error"),i=document.getElementById("steal-2b-btn"),m=document.getElementById("steal-3b-btn"),s=document.getElementById("steal-home-btn"),o=document.getElementById("pickoff-1b-btn"),r=document.getElementById("pickoff-2b-btn"),a=document.getElementById("pickoff-3b-btn"),q1=document.getElementById("simulate-full-game-btn");function u1(T,q){if(!D1)return;D1.innerHTML="";let z=(J,Q)=>{if(!J)return`<div><strong>${Q}:</strong> Not loaded</div>`;let Y=J.lineup||J.batters||[],L=J.pitcher||J.pitchers&&J.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${Q} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>BABIP</th></tr></thead>
          <tbody>
            ${(Y||[]).slice(0,9).map((X,$)=>{let V=X.position?J0(X.position):"",M=X.rates?.BABIP?Number(X.rates.BABIP).toFixed(3):"";return`<tr><td>${$+1}</td><td>${X.name||""}${V?` <span class='pos-label'>(${V})</span>`:""}</td><td>${M}</td></tr>`}).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${L.name}</div>
      </div>
    `};D1.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${z(T,"Home")}</div>
      <div style="flex:1;min-width:250px;">${z(q,"Away")}</div>
    </div>
  `}function y(T,q,z,J,Q,Y,L){if(!d)return;if(!T||!q||!z){if(d.innerHTML="<em>Game not started.</em>",k)k.style.display="none";return}if(k)k.style.display="";let X=T,{inning:$,top:V,outs:M,bases:N,score:R,lineupIndices:I}=X,l=V?0:1,$1=l===0?Q:J,E1=l===0?z:q;if(!E1){if(d.innerHTML="<em>Roster not loaded.</em>",k)k.style.display="none";return}let b=I[l]%E1.lineup.length,T1=E1.lineup[b],B=(l===0?q:z).pitcher,c=["1B","2B","3B"].map((p,S)=>X.bases[S]?p:"").filter(Boolean).join(", ")||"Empty";d.innerHTML=`
    <div><strong>Inning:</strong> ${$} (${V?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${M}</div>
    <div><strong>Bases:</strong> ${c}</div>
    <div><strong>Score:</strong> Away ${R[0]} &ndash; Home ${R[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${T1.name} (vs ${B.name})</div>
  `}function t(T,q,z){if(!x)return;if(!T)return;q.push(T),z()}function u(T){if(!x)return;x.innerHTML="";let q=null,z=null;for(let J of T){if(J.inning!==q||J.top!==z){let L=document.createElement("div");L.style.marginTop="1em",L.style.fontWeight="bold",L.textContent=`Inning ${J.inning} - ${J.top?"Top":"Bottom"}`,x.appendChild(L),q=J.inning,z=J.top}let Q=["1B","2B","3B"].map((L,X)=>J.bases[X]?L:"").filter(Boolean).join(", ")||"Empty",Y=document.createElement("div");Y.innerHTML=`<strong>${J.batterName}:</strong> ${J.outcome} <span style="color:#888">(Outs: ${J.outs}, Score: Away ${J.score[0]} – Home ${J.score[1]}, Bases: ${Q})</span>`,x.appendChild(Y)}}function h(T,q){T(),q()}var E={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeFielders:null,awayFielders:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};function X0(){E.loadedHome=null,E.loadedAway=null,E.homeRoster=null,E.awayRoster=null,E.homeFielders=null,E.awayFielders=null,E.homeMatchups=null,E.awayMatchups=null,E.gameState=null,E.lastRenderedInning=1,E.lastRenderedTop=!0,E.customHomeLineup=null,E.customHomePitcher=null,E.customAwayLineup=null,E.customAwayPitcher=null,E.editingTeam=null,E.atBatLog=[]}async function k0(){try{return await e1()}catch(T){return console.error("Error fetching available teams:",T),[]}}function Y1(T,q){let z=T.find((Q)=>Q.position===q);if(z)return z;let J=T.find((Q)=>Q.positions&&Q.positions.includes(q));if(J)return J;return T.find((Q)=>Q.stats)||{stats:{armStrength:50,FP:0.985}}}function Y0(T,q,z,J){let Q=document.querySelector(".sticky-action-bar");if(Q)Q.querySelectorAll("button").forEach((L)=>{L.disabled=!0,L.classList.add("disabled-greyed")});if(G)G.textContent=`Game Over: ${T} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${z}${J?" Top":" Bottom"})`;if(x){let Y=document.createElement("div");Y.style.marginTop="1em",Y.style.fontWeight="bold",Y.style.color="#b00",Y.textContent=`Game Over: ${T} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${z}${J?" Top":" Bottom"})`,x.appendChild(Y)}}async function I0(){if(!G)return;E.gameState=null,E.lastRenderedInning=1,E.lastRenderedTop=!0,E.atBatLog=[];let T=document.querySelector(".sticky-action-bar");if(T)T.querySelectorAll("button").forEach((z)=>{z.disabled=!1,z.classList.remove("disabled-greyed")});if(k)k.disabled=!1;if(i)i.disabled=!1;if(m)m.disabled=!1;if(s)s.disabled=!1;if(o)o.disabled=!1;if(r)r.disabled=!1;if(a)a.disabled=!1;if(q1)q1.disabled=!1;if(d)d.innerHTML="";if(x)x.innerHTML="";if(E.loadedHome&&E.loadedAway)h1(),G.textContent="New game started. Ready to simulate!";else if(w&&A&&w.value&&A.value)await C1();else G.textContent="Please select home and away teams."}function h1(){if(!E.homeRoster||!E.awayRoster)return;E.homeMatchups=V1(E.homeRoster),E.awayMatchups=V1(E.awayRoster),E.gameState=L0(),E.atBatLog=[],u(E.atBatLog),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)}function $0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups||!E.homeRoster||!E.awayRoster)return;let T=E.gameState,q=T.top?0:1,z=q===0?E.awayRoster:E.homeRoster,J=T.lineupIndices[q]%z.lineup.length,Q=z.lineup[J],Y=Q0(E.awayMatchups,E.homeMatchups,T,E.awayFielders||[],E.homeFielders||[],E.awayRoster,E.homeRoster);if(t({batterName:Q.name,outcome:Y.outcome,outs:T.outs,score:[...T.score],bases:T.bases.map((V)=>V?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>u(E.atBatLog)),F1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},Y0)){h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g);return}let X="",$=!1;if(T.outs>=3){if(T.top)X="End of top half. Switching to bottom of inning.";else X="End of inning. Advancing to next inning.";if(t({batterName:"::",outcome:X,outs:T.outs,score:[...T.score],bases:T.bases.map((V)=>V?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>u(E.atBatLog)),T.bases=[null,null,null],T.outs=0,T.top)T.top=!1;else T.top=!0,T.inning++;$=!0}if($){if(F1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},Y0)){h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g);return}}h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)}function G0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups)h1();while(E.gameState&&k&&!k.disabled)$0()}async function C1(){if(!w||!A||!G)return;let T=w.value,q=A.value;if(!T||!q)return;G.textContent="Loading lineups...";try{let[z,J]=await Promise.all([I1(T),I1(q)]);E.loadedHome=z,E.loadedAway=J,E.homeFielders=z.fielders,E.awayFielders=J.fielders;let Q=z.batters.map((L)=>{let X=z.fielders.find(($)=>$.player_id===L.player_id);if(X)return{...L,...X,stats:{...L.stats,...X.stats},position:X.position};return L}),Y=J.batters.map((L)=>{let X=J.fielders.find(($)=>$.player_id===L.player_id);if(X)return{...L,...X,stats:{...L.stats,...X.stats},position:X.position};return L});E.homeRoster=z&&z.batters&&z.pitchers?M1(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:Q.slice(0,9).map((L)=>L.player_id),E.customHomePitcher||z.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||z.pitchers[0].player_id,Q,z.pitchers):null,E.awayRoster=J&&J.batters&&J.pitchers?M1(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:Y.slice(0,9).map((L)=>L.player_id),E.customAwayPitcher||J.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||J.pitchers[0].player_id,Y,J.pitchers):null,u1(E.homeRoster,E.awayRoster),E.atBatLog=[],u(E.atBatLog),G.textContent="Lineups loaded. Ready to simulate!",h1()}catch(z){console.error("Failed to load lineups:",z);let J=z&&typeof z==="object"&&"message"in z?z.message:String(z);G.textContent=`Failed to load lineups: ${J}`}}async function x0(){if(!G)return;if(X0(),k)k.disabled=!1;if(i)i.disabled=!1;if(m)m.disabled=!1;if(s)s.disabled=!1;if(o)o.disabled=!1;if(r)r.disabled=!1;if(a)a.disabled=!1;if(q1)q1.disabled=!1;if(d)d.innerHTML="";if(x)x.innerHTML="";G.textContent="Loading teams...";try{let T=await k0();if(!T.length){G.textContent="No teams found in data folder.";return}for(let J of[w,A]){if(!J)continue;J.innerHTML="";for(let Q of T){let Y=document.createElement("option");Y.value=Q,Y.textContent=Q,J.appendChild(Y)}}let q="CHC-2025",z="MIL-2025";if(w)w.value=T.includes(q)?q:T[0]||"";if(A)A.value=T.includes(z)?z:T[1]||T[0]||"";if(G.textContent="Select home and away teams.",w&&A&&w.value&&A.value)C1()}catch(T){console.error("Failed to populate team dropdowns:",T);let q=T&&typeof T==="object"&&"message"in T?T.message:String(T);G.textContent=`Failed to load teams: ${q}`}}function F0(){if(!E.loadedHome||!E.loadedAway)return;let T=E.homeRoster?.pitcher?.player_id,q=E.awayRoster?.pitcher?.player_id,z=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.fielders?E.loadedHome.batters.map((L)=>{let X=E.loadedHome.fielders.find(($)=>$.player_id===L.player_id);if(X)return{...L,...X,stats:{...L.stats,...X.stats},position:X.position};return L}):[],J=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.fielders?E.loadedAway.batters.map((L)=>{let X=E.loadedAway.fielders.find(($)=>$.player_id===L.player_id);if(X)return{...L,...X,stats:{...L.stats,...X.stats},position:X.position};return L}):[];E.homeRoster=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.pitchers?M1(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:z.slice(0,9).map((L)=>L.player_id),E.customHomePitcher||E.loadedHome.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||E.loadedHome.pitchers[0].player_id,z,E.loadedHome.pitchers):null,E.awayRoster=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.pitchers?M1(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:J.slice(0,9).map((L)=>L.player_id),E.customAwayPitcher||E.loadedAway.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||E.loadedAway.pitchers[0].player_id,J,E.loadedAway.pitchers):null;let Q=E.homeRoster?.pitcher?.player_id,Y=E.awayRoster?.pitcher?.player_id;if(E.gameState&&E.gameState.pitcherFatigue){if(T&&Q&&T!==Q)E.gameState.pitcherFatigue[1]={battersFaced:0},console.log(`\uD83D\uDD04 Home pitcher changed from ${T} to ${Q} - fatigue reset`);if(q&&Y&&q!==Y)E.gameState.pitcherFatigue[0]={battersFaced:0},console.log(`\uD83D\uDD04 Away pitcher changed from ${q} to ${Y} - fatigue reset`)}if(E.homeRoster&&E.awayRoster)E.homeMatchups=V1({lineup:E.homeRoster.lineup,pitcher:E.awayRoster.pitcher}),E.awayMatchups=V1({lineup:E.awayRoster.lineup,pitcher:E.homeRoster.pitcher});u1(E.homeRoster,E.awayRoster),y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop)}function M0(T,q,z,J,Q){if(E.editingTeam=T,!z1||!P1||!Q1||!X1)return;if(P1.textContent=`Customize ${T==="home"?"Home":"Away"} Lineup`,f)f.textContent="";z1.style.display="flex";let Y=J,L=Q;if(T==="home"&&E.homeRoster)Y=E.homeRoster.lineup?E.homeRoster.lineup.map((X)=>X.player_id):J,L=E.homeRoster.pitcher?E.homeRoster.pitcher.player_id:Q;else if(T==="away"&&E.awayRoster)Y=E.awayRoster.lineup?E.awayRoster.lineup.map((X)=>X.player_id):J,L=E.awayRoster.pitcher?E.awayRoster.pitcher.player_id:Q;Q1.innerHTML="";for(let X=0;X<9;X++){let $=document.createElement("li"),V=document.createElement("select");if(V.name=`batter${X}`,V.required=!0,V.innerHTML='<option value="">-- Select --</option>'+q.map((M)=>`<option value="${M.player_id}">${M.name} (${M.PA} PA)</option>`).join(""),Y&&Y[X])V.value=Y[X];$.appendChild(V),Q1.appendChild($)}if(X1.innerHTML='<option value="">-- Select --</option>'+z.filter((X)=>X.name&&X.name!=="Player"&&X.name!=="Pitcher").map((X)=>`<option value="${X.player_id}">${X.name} (${X.stats&&X.stats.IP?X.stats.IP:""} IP)</option>`).join(""),L)X1.value=L}function g(){if(!E.gameState)return;if(i)i.disabled=!E.gameState.bases[0];if(m)m.disabled=!E.gameState.bases[1];if(s)s.disabled=!E.gameState.bases[2];if(o)o.disabled=!E.gameState.bases[0];if(r)r.disabled=!E.gameState.bases[1];if(a)a.disabled=!E.gameState.bases[2]}if(w1)w1.addEventListener("click",I0);if(w)w.addEventListener("change",C1);if(A)A.addEventListener("change",C1);if(k)k.addEventListener("click",$0);if(A1)A1.addEventListener("click",()=>{if(!E.loadedHome)return;M0("home",E.loadedHome.batters,E.loadedHome.pitchers,E.customHomeLineup,E.customHomePitcher)});if(y1)y1.addEventListener("click",()=>{if(!E.loadedAway)return;M0("away",E.loadedAway.batters,E.loadedAway.pitchers,E.customAwayLineup,E.customAwayPitcher)});if(R1)R1.addEventListener("click",()=>{if(z1)z1.style.display="none"});if(f1)f1.addEventListener("submit",(T)=>{if(T.preventDefault(),!Q1||!X1)return;let q=[],z=Q1.querySelectorAll("select");for(let Q of z){if(!Q.value){if(f)f.textContent="Please select a player for every lineup slot.";return}q.push(Q.value)}if(new Set(q).size!==q.length){if(f)f.textContent="No duplicate players allowed in the lineup.";return}let J=X1.value;if(!J){if(f)f.textContent="Please select a starting pitcher.";return}if(q.includes(J)){if(f)f.textContent="Pitcher cannot also be in the batting lineup.";return}if(E.editingTeam==="home")E.customHomeLineup=q,E.customHomePitcher=J;else E.customAwayLineup=q,E.customAwayPitcher=J;if(z1)z1.style.display="none";F0()});window.addEventListener("DOMContentLoaded",()=>{x0()});if(i)i.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,Q=E.gameState.bases[0];if(!Q)return;let Y=J?Y1(J,"C"):{stats:{armStrength:50}},L=z.pitcher,X=_1(2,E.gameState,Q,L,Y,1);t({batterName:Q.name,outcome:X.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map(($)=>$?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>u(E.atBatLog)),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)});if(m)m.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,Q=E.gameState.bases[1];if(!Q)return;let Y=J?Y1(J,"C"):{stats:{armStrength:50}},L=z.pitcher,X=_1(3,E.gameState,Q,L,Y,2);t({batterName:Q.name,outcome:X.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map(($)=>$?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>u(E.atBatLog)),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)});if(s)s.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,Q=E.gameState.bases[2];if(!Q)return;let Y=J?Y1(J,"C"):{stats:{armStrength:50}},L=z.pitcher,X=_1(4,E.gameState,Q,L,Y,3);t({batterName:Q.name,outcome:X.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map(($)=>$?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>u(E.atBatLog)),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)});if(o)o.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,Q=E.gameState.bases[0];if(!Q)return;let Y=J?Y1(J,"1B"):{stats:{FP:0.985}},L=z.pitcher,X=W1(1,E.gameState,Q,L,Y);t({batterName:Q.name,outcome:X.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map(($)=>$?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>u(E.atBatLog)),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)});if(r)r.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,Q=E.gameState.bases[1];if(!Q)return;let Y=J?Y1(J,"2B"):{stats:{FP:0.985}},L=z.pitcher,X=W1(2,E.gameState,Q,L,Y);t({batterName:Q.name,outcome:X.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map(($)=>$?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>u(E.atBatLog)),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)});if(a)a.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,Q=E.gameState.bases[2];if(!Q)return;let Y=J?Y1(J,"3B"):{stats:{FP:0.985}},L=z.pitcher,X=W1(3,E.gameState,Q,L,Y);t({batterName:Q.name,outcome:X.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map(($)=>$?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>u(E.atBatLog)),h(()=>y(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),g)});if(q1)q1.addEventListener("click",G0);
