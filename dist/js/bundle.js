function x(Q){const G=/<!--([\s\S]*?)-->/g,K=[];let J;while((J=G.exec(Q))!==null)K.push(J[1]);return K}function A(Q,G){const K=new DOMParser;for(let J of Q)if(J.includes(`id="${G}"`))return K.parseFromString(J,"text/html").querySelector(`table#${G}`)||null;return null}function E(Q){const G=document.createElement("div");G.style.display="none",document.body.appendChild(G),G.innerHTML=Q;const K=G.querySelector("table#players_standard_batting"),J=G.querySelector("table#players_standard_pitching"),U=x(Q),W=A(U,"players_standard_fielding");return G.remove(),{batting:K,pitching:J,fielding:W}}function L(Q){if(!Q||!Q.href)return null;const G=Q.href.match(/\/players\/.\/([^/.]+)\.shtml/);return G?G[1]:null}function F(Q){return Q.toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,12)}function v(Q){if(!Q)return[];const G=Array.from(Q.querySelectorAll("tbody > tr")).filter((U)=>!U.classList.contains("thead")),K=Array.from(Q.querySelectorAll("thead tr th")).map((U)=>U.textContent.trim()),J=[];for(let U of G){const W=[U.querySelector("th"),...U.querySelectorAll("td")];if(W.length!==K.length)continue;const X={};for(let V=0;V<K.length;V++){const Y=K[V],q=W[V];if(V===0){let $=q.textContent.trim(),_=q.querySelector("a"),Z=L(_);if(/^\d+$/.test($)){const D=U.querySelector("td");$=D?.textContent.trim()||"(unknown)",_=D?.querySelector("a"),Z=L(_)||Z}X.name=$,X.player_id=Z||F($)}else{const $=q.textContent.trim(),_=Number($.replace(/,/g,""));X[Y]=isNaN(_)?$:_}}J.push(X)}return J}function M(Q){return Q.map((G)=>{const K=Number(G.PA)||0,J=Number(G.AB)||0,U=Number(G.H)||0,W=Number(G.HR)||0,X=Number(G.BB)||0,V=Number(G.SO)||0,Y=Number(G.SF)||0,q=Number(G.HBP)||0,$=Number(G["2B"])||0,_=Number(G["3B"])||0,Z=U-$-_-W,D=J-V-W+Y,N=D>0?(U-W)/D:null,O=K>0?V/K:null,C=K>0?X/K:null,f=K>0?W/K:null;return{name:G.name,player_id:G.player_id,PA:K,stats:{H:U,HR:W,BB:X,SO:V,SF:Y,HBP:q,singles:Z,doubles:$,triples:_},rates:{kRate:O,bbRate:C,hrRate:f,BABIP:N}}})}function j(Q){return Q.map((G)=>{const K=Number(G.IP)||0,J=Number(G.TBF)||0,U=Number(G.H)||0,W=Number(G.HR)||0,X=Number(G.BB)||0,V=Number(G.SO)||0,Y=Number(G.HBP)||0,q=J>0?V/J:null,$=J>0?X/J:null,_=J>0?W/J:null,Z=J-V-W-X-Y,D=Z>0?(U-W)/Z:null;return{name:G.name,player_id:G.player_id,TBF:J,stats:{IP:K,H:U,HR:W,BB:X,SO:V,HBP:Y},rates:{kRate:q,bbRate:$,hrRate:_,BABIP:D}}})}function y(Q,G,K,J){const U=Q.map((V)=>{const Y=K.find((q)=>q.player_id===V);if(!Y)throw new Error(`Lineup player not found: ${V}`);return Y}),W=J.find((V)=>V.player_id===G);if(!W)throw new Error(`Starting pitcher not found: ${G}`);const X=new Set;for(let V of U){if(X.has(V.player_id))throw new Error(`Duplicate player in lineup: ${V.player_id}`);X.add(V.player_id)}if(X.has(G))throw new Error(`Pitcher also appears in lineup: ${G}`);return{lineup:U,pitcher:W}}function z(Q,G,K=5){if(!Q){console.log(`${G}: \u274C missing`);return}const J=Q.querySelectorAll("tbody tr");console.log(`\uD83D\uDCCA ${G} preview (${Math.min(J.length,K)} rows):`);for(let U=0;U<Math.min(J.length,K);U++){const W=J[U],X=W.querySelector("th"),V=X?X.textContent.trim():"(no name)",Y=Array.from(W.querySelectorAll("td")).map((q)=>q.textContent.trim());console.log(`   - ${U+1}: [${V}, ${Y.slice(0,4).join(", ")} ...]`)}}async function S(){try{const G=await(await fetch("./data/CHC-2025.html")).text();console.log("\uD83C\uDF10 Loaded team HTML");const{batting:K,pitching:J,fielding:U}=E(G);console.log("\uD83E\uDDEA Table detection:"),console.log("   batting:",K?"\u2705 found":"\u274C missing"),console.log("   pitching:",J?"\u2705 found":"\u274C missing"),console.log("   fielding:",U?"\u2705 found":"\u274C missing"),z(K,"Batting"),z(J,"Pitching"),z(U,"Fielding");const W=v(K),X=v(J),V=M(W),Y=j(X);console.log("\uD83C\uDFAF Normalized batting example:",V.slice(0,2)),console.log("\uD83C\uDFAF Normalized pitching example:",Y.slice(0,2));const q=V.map((Z)=>Z.player_id).filter((Z,D,N)=>Z&&N.indexOf(Z)===D).slice(0,9),$=Y.find((Z)=>Z.player_id)?.player_id,_=y(q,$,V,Y);console.log("\uD83C\uDFC6 Built roster:",_)}catch(Q){console.error("\u274C Error loading team HTML:",Q)}}S();
