var V0=Object.create;var{getPrototypeOf:Z0,defineProperty:D1,getOwnPropertyNames:N0}=Object;var U0=Object.prototype.hasOwnProperty;var v0=(T,q,z)=>{z=T!=null?V0(Z0(T)):{};let J=q||!T||!T.__esModule?D1(z,"default",{value:T,enumerable:!0}):z;for(let H of N0(T))if(!U0.call(J,H))D1(J,H,{get:()=>T[H],enumerable:!0});return J};var K0=(T,q)=>{for(var z in q)D1(T,z,{get:q[z],enumerable:!0,configurable:!0,set:(J)=>q[z]=()=>J})};var j0=(T,q)=>()=>(T&&(q=T(T=0)),q);var _0=((T)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(T,{get:(q,z)=>(typeof require!=="undefined"?require:q)[z]}):T)(function(T){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+T+'" is not supported')});var o1={};K0(o1,{sep:()=>i1,resolve:()=>N1,relative:()=>n1,posix:()=>s1,parse:()=>S1,normalize:()=>k1,join:()=>h1,isAbsolute:()=>B1,format:()=>p1,extname:()=>g1,dirname:()=>d1,delimiter:()=>m1,default:()=>D0,basename:()=>b1,_makeLong:()=>c1});function B(T){if(typeof T!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(T))}function u1(T,q){var z="",J=0,H=-1,X=0,L;for(var Q=0;Q<=T.length;++Q){if(Q<T.length)L=T.charCodeAt(Q);else if(L===47)break;else L=47;if(L===47){if(H===Q-1||X===1);else if(H!==Q-1&&X===2){if(z.length<2||J!==2||z.charCodeAt(z.length-1)!==46||z.charCodeAt(z.length-2)!==46){if(z.length>2){var Y=z.lastIndexOf("/");if(Y!==z.length-1){if(Y===-1)z="",J=0;else z=z.slice(0,Y),J=z.length-1-z.lastIndexOf("/");H=Q,X=0;continue}}else if(z.length===2||z.length===1){z="",J=0,H=Q,X=0;continue}}if(q){if(z.length>0)z+="/..";else z="..";J=2}}else{if(z.length>0)z+="/"+T.slice(H+1,Q);else z=T.slice(H+1,Q);J=Q-H-1}H=Q,X=0}else if(L===46&&X!==-1)++X;else X=-1}return z}function C0(T,q){var z=q.dir||q.root,J=q.base||(q.name||"")+(q.ext||"");if(!z)return J;if(z===q.root)return z+J;return z+T+J}function N1(){var T="",q=!1,z;for(var J=arguments.length-1;J>=-1&&!q;J--){var H;if(J>=0)H=arguments[J];else{if(z===void 0)z=process.cwd();H=z}if(B(H),H.length===0)continue;T=H+"/"+T,q=H.charCodeAt(0)===47}if(T=u1(T,!q),q)if(T.length>0)return"/"+T;else return"/";else if(T.length>0)return T;else return"."}function k1(T){if(B(T),T.length===0)return".";var q=T.charCodeAt(0)===47,z=T.charCodeAt(T.length-1)===47;if(T=u1(T,!q),T.length===0&&!q)T=".";if(T.length>0&&z)T+="/";if(q)return"/"+T;return T}function B1(T){return B(T),T.length>0&&T.charCodeAt(0)===47}function h1(){if(arguments.length===0)return".";var T;for(var q=0;q<arguments.length;++q){var z=arguments[q];if(B(z),z.length>0)if(T===void 0)T=z;else T+="/"+z}if(T===void 0)return".";return k1(T)}function n1(T,q){if(B(T),B(q),T===q)return"";if(T=N1(T),q=N1(q),T===q)return"";var z=1;for(;z<T.length;++z)if(T.charCodeAt(z)!==47)break;var J=T.length,H=J-z,X=1;for(;X<q.length;++X)if(q.charCodeAt(X)!==47)break;var L=q.length,Q=L-X,Y=H<Q?H:Q,M=-1,$=0;for(;$<=Y;++$){if($===Y){if(Q>Y){if(q.charCodeAt(X+$)===47)return q.slice(X+$+1);else if($===0)return q.slice(X+$)}else if(H>Y){if(T.charCodeAt(z+$)===47)M=$;else if($===0)M=0}break}var U=T.charCodeAt(z+$),w=q.charCodeAt(X+$);if(U!==w)break;else if(U===47)M=$}var O="";for($=z+M+1;$<=J;++$)if($===J||T.charCodeAt($)===47)if(O.length===0)O+="..";else O+="/..";if(O.length>0)return O+q.slice(X+M);else{if(X+=M,q.charCodeAt(X)===47)++X;return q.slice(X)}}function c1(T){return T}function d1(T){if(B(T),T.length===0)return".";var q=T.charCodeAt(0),z=q===47,J=-1,H=!0;for(var X=T.length-1;X>=1;--X)if(q=T.charCodeAt(X),q===47){if(!H){J=X;break}}else H=!1;if(J===-1)return z?"/":".";if(z&&J===1)return"//";return T.slice(0,J)}function b1(T,q){if(q!==void 0&&typeof q!=="string")throw new TypeError('"ext" argument must be a string');B(T);var z=0,J=-1,H=!0,X;if(q!==void 0&&q.length>0&&q.length<=T.length){if(q.length===T.length&&q===T)return"";var L=q.length-1,Q=-1;for(X=T.length-1;X>=0;--X){var Y=T.charCodeAt(X);if(Y===47){if(!H){z=X+1;break}}else{if(Q===-1)H=!1,Q=X+1;if(L>=0)if(Y===q.charCodeAt(L)){if(--L===-1)J=X}else L=-1,J=Q}}if(z===J)J=Q;else if(J===-1)J=T.length;return T.slice(z,J)}else{for(X=T.length-1;X>=0;--X)if(T.charCodeAt(X)===47){if(!H){z=X+1;break}}else if(J===-1)H=!1,J=X+1;if(J===-1)return"";return T.slice(z,J)}}function g1(T){B(T);var q=-1,z=0,J=-1,H=!0,X=0;for(var L=T.length-1;L>=0;--L){var Q=T.charCodeAt(L);if(Q===47){if(!H){z=L+1;break}continue}if(J===-1)H=!1,J=L+1;if(Q===46){if(q===-1)q=L;else if(X!==1)X=1}else if(q!==-1)X=-1}if(q===-1||J===-1||X===0||X===1&&q===J-1&&q===z+1)return"";return T.slice(q,J)}function p1(T){if(T===null||typeof T!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof T);return C0("/",T)}function S1(T){B(T);var q={root:"",dir:"",base:"",ext:"",name:""};if(T.length===0)return q;var z=T.charCodeAt(0),J=z===47,H;if(J)q.root="/",H=1;else H=0;var X=-1,L=0,Q=-1,Y=!0,M=T.length-1,$=0;for(;M>=H;--M){if(z=T.charCodeAt(M),z===47){if(!Y){L=M+1;break}continue}if(Q===-1)Y=!1,Q=M+1;if(z===46){if(X===-1)X=M;else if($!==1)$=1}else if(X!==-1)$=-1}if(X===-1||Q===-1||$===0||$===1&&X===Q-1&&X===L+1){if(Q!==-1)if(L===0&&J)q.base=q.name=T.slice(1,Q);else q.base=q.name=T.slice(L,Q)}else{if(L===0&&J)q.name=T.slice(1,X),q.base=T.slice(1,Q);else q.name=T.slice(L,X),q.base=T.slice(L,Q);q.ext=T.slice(X,Q)}if(L>0)q.dir=T.slice(0,L-1);else if(J)q.dir="/";return q}var i1="/",m1=":",s1,D0;var r1=j0(()=>{s1=((T)=>(T.posix=T,T))({resolve:N1,normalize:k1,isAbsolute:B1,join:h1,relative:n1,_makeLong:c1,dirname:d1,basename:b1,extname:g1,format:p1,parse:S1,sep:i1,delimiter:m1,win32:null,posix:null}),D0=s1});var U1=null;async function a1(){if(U1)return U1;try{if(typeof window!=="undefined"&&typeof fetch!=="undefined"){let T=await fetch("./complete-dataset-2025.json");if(!T.ok)throw new Error(`Failed to load dataset: ${T.status} ${T.statusText}`);let q=await T.json();return U1=q,q}else{let T=await import("fs"),z=(await Promise.resolve().then(() => (r1(),o1))).join(process.cwd(),"dist","complete-dataset-2025.json"),J=T.readFileSync(z,"utf8"),H=JSON.parse(J);return U1=H,H}}catch(T){throw console.error("Error loading dataset:",T),new Error("Failed to load baseball dataset. Please ensure complete-dataset-2025.json is available.")}}async function t1(){return(await a1()).teams.map((q)=>`${q.team}-${q.year}`)}async function W1(T){let z=(await a1()).teams.find((L)=>`${L.team}-${L.year}`===T);if(!z)throw new Error(`Team ${T} not found in dataset`);let J=[],H=[],X=[];return z.players.forEach((L)=>{let Q={name:L.name,player_id:L.player_id,team:L.team,year:L.year};if(L.batting)J.push({...Q,PA:L.batting.PA,stats:L.batting.stats,rates:L.batting.rates,baserunning:L.batting.baserunning});if(L.pitching)H.push({...Q,TBF:L.pitching.TBF,stats:L.pitching.stats,rates:L.pitching.rates});if(L.fielding)X.push({...Q,position:L.fielding.position,stats:L.fielding.stats})}),{batters:J,pitchers:H,fielders:X}}function z1(T,q,z,J){let H=T.map((Q)=>{let Y=z.find((M)=>M.player_id===Q);if(!Y)throw new Error(`Lineup player not found: ${Q}`);return Y}),X=J.find((Q)=>Q.player_id===q);if(!X)throw new Error(`Starting pitcher not found: ${q}`);let L=new Set;for(let Q of H){if(L.has(Q.player_id))throw new Error(`Duplicate player in lineup: ${Q.player_id}`);L.add(Q.player_id)}return{lineup:H,pitcher:X}}function v1(T,q){return(T+q)/2}function a(T,q){return T==null||isNaN(T)||T===0?q:T}var e1=0.22,E0=0.08,T0=0.03;function K1(T,q,z){let J=T.rates||{},H=q.rates||{},X=T.stats||{},L=W(a(J.kRate,e1),"batter.kRate"),Q=W(a(H.kRate,e1),"pitcher.kRate"),Y=W(a(J.bbRate,E0),"batter.bbRate"),M=W(a(H.bbRate,E0),"pitcher.bbRate"),$=W(a(J.hrRate,T0),"batter.hrRate"),U=W(a(H.hrRate,T0),"pitcher.hrRate"),w=W(J.BABIP??0.29,"batter.BABIP"),O=W(H.BABIP??0.29,"pitcher.BABIP"),P=Math.max(0,T.PA||0),T1=Math.max(0,X.HBP??0),m=Math.max(0,X.singles??0),d=Math.max(0,X.doubles??0),s=Math.max(0,X.triples??0),l=v1(L,Q),u=v1(Y,M),b=P>0?T1/P:0.01,g=v1($,U),_=l+u+b+g,C=Math.max(0,1-_),A=Math.max(0.27,Math.min(0.33,v1(w,O))),Z=A*C,G=C-Z,r=0.75,V1=0.2,Z1=0.05,N=Z*r,V=Z*V1,v=Z*Z1;if(z){if(z.risp)A+=0.01,V*=1.1;if(z.late)u*=1.1,l*=1.05;if(z.twoOuts)A-=0.01;Z=Math.max(0,Math.min(1,A))*C,G=C-Z,N=Z*r,V=Z*V1,v=Z*Z1}let K=l+u+b+g+N+V+v,j=0.58;if(K>1-j){let k=(1-j)/K;l*=k,u*=k,b*=k,g*=k,N*=k,V*=k,v*=k,G=1-(l+u+b+g+N+V+v)}let D={K:W(l,"K"),BB:W(u,"BB"),HBP:W(b,"HBP"),HR:W(g,"HR"),"1B":W(N,"1B"),"2B":W(V,"2B"),"3B":W(v,"3B"),Out:W(G,"Out")},i=Object.values(D).reduce((k,M0)=>k+M0,0);if(i>0)Object.keys(D).forEach((k)=>{D[k]=D[k]/i});return D}function W(T,q){if(typeof T!=="number"||isNaN(T))return 0;if(T<0){if(q)console.warn(`[probabilityModel] Clamped negative value for ${q}: ${T} → 0`);return 0}if(T>1){if(q)console.warn(`[probabilityModel] Clamped value >1 for ${q}: ${T} → 1`);return 1}return T}function q1(T){let{lineup:q,pitcher:z}=T;return q.map((J)=>{let H=K1(J,z);return{batter_id:J.player_id,pitcher_id:z.player_id,probabilities:H}})}function J1(T){let q=Object.values(T).reduce((J,H)=>J+H,0),z=Math.random()*q;for(let[J,H]of Object.entries(T))if((z-=H)<=0)return J;return Object.keys(T).pop()||""}var k0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},W0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function z0(T){if(T==="Out"){let q=J1(k0),z=J1(W0[q]);return`${q} to ${z}`}return T}function q0(T){if(!T||typeof T!=="string")return"";let q=T.replace(/\*/g,"").split(/[/,]/)[0],z={"1":"P","2":"C","3":"1B","4":"2B","5":"3B","6":"SS","7":"LF","8":"CF","9":"RF",D:"DH",H:"PH"};if(z[q])return z[q];let J=q.charAt(0);if(z[J])return z[J];return q}function J0(){return{inning:1,top:!0,outs:0,bases:[null,null,null],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function O1(T){let q=[];if(T[0])q.push(0);if(T[1]&&T[0])q.push(1);if(T[2]&&T[1]&&T[0])q.push(2);return q}function G1(T,q,z){let J=0,H=[null,null,null];for(let L=2;L>=0;L--){if(!T[L])continue;let Q=T[L],Y=Q.baserunning?.speed||50,M=Q.baserunning?.runsBaserunning||0,$=L+(q==="1B"?1:q==="2B"?2:q==="3B"?3:4);if(q==="1B"){if(Y>70&&Math.random()<0.15)$=Math.min($+1,3)}else if(q==="2B"){if(L===0&&M>2&&Math.random()<0.25)$=3}if($>=3)J++;else H[$]=Q}let X={"1B":0,"2B":1,"3B":2}[q];if(X!==void 0)H[X]=z;if(q==="HR")J++;return[H,J]}function L0(T,q,z,J,H,X,L,Q,Y){let M=Q||J1,$=Y||z0,U=z.top?0:1,w=U===0?T:q,O=U===0?X:L,P=U===0?H:J,T1=Array.isArray(P)?P:[],m=z.lineupIndices[U],d=w[m%w.length],s=O.lineup[m%O.lineup.length],l=!!(z.bases[1]||z.bases[2]),u=z.inning>=8&&Math.abs(z.score[0]-z.score[1])<=2,b=z.outs===2,g={risp:l,late:u,twoOuts:b},_=K1(s,O.pitcher,g);if(z.pitcherFatigue&&z.pitcherFatigue[1-U]){z.pitcherFatigue[1-U].battersFaced++;let N=z.pitcherFatigue[1-U].battersFaced;if(N>18){let v=Math.min((N-18)*0.005,0.05);_={..._};let K=_.Out;if(_.BB)_.BB+=v;if(_["1B"])_["1B"]+=v;if(_.Out){if(_.Out-=v,_.Out<0.5*K)_.Out=0.5*K}let j=Object.values(_).reduce((D,i)=>D+i,0);Object.keys(_).forEach((D)=>_[D]=Math.max(0,_[D]/j))}}let C=M(_),A=$(C);z.lineupIndices[U]++;let Z=void 0,G="",r=!1,V1=!1,Z1=!1;if(C==="Out"){let N=A.match(/to ([A-Z0-9]+)/);if(N){if(G=N[1],Z=T1.find((V)=>V.position===G),Z&&Z.stats){let V=Number(Z.stats.E)||0,v=Number(Z.stats.PO)||0,K=Number(Z.stats.A)||0,j=v+K+V,D=j>0?V/j:0.01;if(Math.random()<D)r=!0}else if(Math.random()<0.01)r=!0}}if(r){let[N,V]=G1(z.bases,"1B",s);return z.bases=N,z.score[U]+=V,{batter_id:d.batter_id,outcome:`Error on ${G}`,fielder:Z,fielderPosition:G}}if(C==="Out"&&/^Groundout to [A-Z0-9]+$/.test(A)&&z.outs===0){let N=O1(z.bases);if(N.length>=2){let V=0.01;if(Z&&Z.stats){let v=Number(Z.stats.RF)||0,K=Number(Z.stats.TZ)||0,j=Number(Z.stats.FP)||0.985,D=Math.max(0,(v-4.5)*0.005),i=Math.max(0,K*0.002),k=j>0.995?0.01:0;V=Math.min(0.05,V+D+i+k)}if(Math.random()<V){Z1=!0;let v=N.slice().sort((K,j)=>j-K);for(let K=0;K<2&&K<v.length;K++)z.bases[v[K]]=null;return z.outs=3,{batter_id:d.batter_id,outcome:"Grounded into triple play",...Z?{fielder:Z,fielderPosition:G}:{}}}}}if(C==="Out"&&/^Groundout to [A-Z0-9]+$/.test(A)&&z.outs<2){let N=O1(z.bases);if(N.length>=1){let V=0.25;if(Z&&Z.stats){let v=Number(Z.stats.RF)||0,K=Number(Z.stats.TZ)||0,j=Number(Z.stats.FP)||0.985,D=Math.max(0,(v-4.5)*0.05),i=Math.max(0,K*0.02),k=j>0.995?0.1:0;V=Math.min(0.6,V+D+i+k)}if(Math.random()<V){V1=!0;let v=Math.max(...N);return z.bases[v]=null,z.outs=Math.min(z.outs+2,3),{batter_id:d.batter_id,outcome:"Grounded into double play",...Z?{fielder:Z,fielderPosition:G}:{}}}}}if(C==="Out"&&/^Groundout to [A-Z0-9]+$/.test(A)){z.outs++;let N=O1(z.bases);for(let V of N.slice().sort((v,K)=>K-v))if(z.bases[V])if(V===2)z.bases[V]=null,z.score[U]+=1;else z.bases[V+1]=z.bases[V],z.bases[V]=null;return{batter_id:d.batter_id,outcome:A,...Z?{fielder:Z,fielderPosition:G}:{}}}if(C==="Out"||C==="K")z.outs++;else if(C==="BB"||C==="HBP"){let[N,V]=G1(z.bases,"1B",s);z.bases=N,z.score[U]+=V}else{let[N,V]=G1(z.bases,C,s);z.bases=N,z.score[U]+=V}if(C==="K"||C==="BB"){let N=T1.find((V)=>V.position==="C");if(N&&N.stats){let V=Number(N.stats.FP)||0.985,v=Number(N.stats.PB)||0,K=V>0.995?0.001:0.005;if(Math.random()<K){for(let j=2;j>=0;j--)if(z.bases[j])if(j===2)z.bases[j]=null,z.score[U]++;else z.bases[j+1]=z.bases[j],z.bases[j]=null;return{batter_id:d.batter_id,outcome:"Strikeout, but passed ball allows runner to advance",fielder:N,fielderPosition:"C"}}}}return{batter_id:d.batter_id,outcome:A,...Z?{fielder:Z,fielderPosition:G}:{}}}function j1(T,q,z,J,H,X,L){let Q=L||Math.random;if(!q.bases[X-1])return{success:!1,out:!1,description:`No runner on base ${X} to steal from.`};let Y=T===2?0.6:T===3?0.3:0.1;if(z?.baserunning&&H?.stats){let $=z.baserunning.speed||50,U=H.stats.armStrength||50,w=z.name||z.player_id||"Unknown Runner",O=H.name||H.player_id||"Unknown Catcher";if(console.log(`[STEAL ATTEMPT] Runner: ${w} (speed: ${$}), Catcher: ${O} (arm: ${U})`),Y=0.5+($-U)/200,T===3)Y-=0.2;if(T===4)Y-=0.4;Y=Math.max(0.05,Math.min(0.95,Y))}if(Q(1)<Y){let $=q.bases[X-1];if(q.bases[X-1]=null,T<=3)q.bases[T-1]=$;else q.score[q.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${T===4?"Home":T}`}}else return q.bases[X-1]=null,q.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${T===4?"Home":T}`}}function _1(T,q,z,J,H,X){let L=X||Math.random;if(!q.bases[T-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${T} to pick off.`};let Q=0.05,Y=0.1;if(J?.stats&&z?.baserunning){let $=J.stats.pickoffs||0,U=z.baserunning.speed||50;Q=0.03+$*0.02-(U-50)/1000,Q=Math.max(0.01,Math.min(0.15,Q))}if(H?.stats)Y=0.05+(1-(H.stats.FP||0.985))*2,Y=Math.max(0.01,Math.min(0.2,Y));let M=L(1);if(M<Q)return q.bases[T-1]=null,q.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${T}`};else if(M<Q+Y){let $=q.bases[T-1];if(q.bases[T-1]=null,T<3)q.bases[T]=$;else q.score[q.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${T}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${T} unsuccessful`}}function x1(T,q){let{inning:z,top:J,outs:H,score:X}=T,[L,Q]=X;if(z<9)return!1;if(J&&H===3){if(Q>L)return q("Home",X,z,!0),!0;return!1}if(!J&&H===3)if(L>Q)return q("Away",X,z,!1),!0;else if(Q>L)return q("Home",X,z,!1),!0;else return!1;if(!J&&H<3&&Q>L)return q("Home",X,z,!1),!0;return!1}var h=document.getElementById("home-team-select"),n=document.getElementById("away-team-select"),F1=document.getElementById("load-teams-btn"),x=document.getElementById("status"),C1=document.getElementById("lineups-container"),L1=document.getElementById("game-state-container"),F=document.getElementById("next-atbat-btn"),p=document.getElementById("atbat-result-container"),I1=document.getElementById("customize-home-lineup-btn"),w1=document.getElementById("customize-away-lineup-btn"),o=document.getElementById("custom-lineup-modal"),A1=document.getElementById("close-lineup-modal"),y1=document.getElementById("lineup-modal-title"),R1=document.getElementById("custom-lineup-form"),t=document.getElementById("batting-order-list"),e=document.getElementById("pitcher-select"),y=document.getElementById("lineup-error"),H1=document.getElementById("steal-2b-btn"),Q1=document.getElementById("steal-3b-btn"),X1=document.getElementById("steal-home-btn"),Y1=document.getElementById("pickoff-1b-btn"),$1=document.getElementById("pickoff-2b-btn"),M1=document.getElementById("pickoff-3b-btn"),f1=document.getElementById("simulate-full-game-btn");function P1(T,q){if(!C1)return;C1.innerHTML="";let z=(J,H)=>{if(!J)return`<div><strong>${H}:</strong> Not loaded</div>`;let X=J.lineup||J.batters||[],L=J.pitcher||J.pitchers&&J.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${H} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>BABIP</th></tr></thead>
          <tbody>
            ${(X||[]).slice(0,9).map((Q,Y)=>{let M=Q.position?q0(Q.position):"",$=Q.rates?.BABIP?Number(Q.rates.BABIP).toFixed(3):"";return`<tr><td>${Y+1}</td><td>${Q.name||""}${M?` <span class='pos-label'>(${M})</span>`:""}</td><td>${$}</td></tr>`}).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${L.name}</div>
      </div>
    `};C1.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${z(T,"Home")}</div>
      <div style="flex:1;min-width:250px;">${z(q,"Away")}</div>
    </div>
  `}function I(T,q,z,J,H,X,L){if(!L1)return;if(!T||!q||!z){if(L1.innerHTML="<em>Game not started.</em>",F)F.style.display="none";return}if(F)F.style.display="";let Q=T,{inning:Y,top:M,outs:$,bases:U,score:w,lineupIndices:O}=Q,P=M?0:1,T1=P===0?H:J,m=P===0?z:q;if(!m){if(L1.innerHTML="<em>Roster not loaded.</em>",F)F.style.display="none";return}let d=O[P]%m.lineup.length,s=m.lineup[d],l=(P===0?q:z).pitcher,u=["1B","2B","3B"].map((b,g)=>Q.bases[g]?b:"").filter(Boolean).join(", ")||"Empty";L1.innerHTML=`
    <div><strong>Inning:</strong> ${Y} (${M?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${$}</div>
    <div><strong>Bases:</strong> ${u}</div>
    <div><strong>Score:</strong> Away ${w[0]} &ndash; Home ${w[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${s.name} (vs ${l.name})</div>
  `}function S(T,q,z){if(!p)return;if(!T)return;q.push(T),z()}function R(T){if(!p)return;p.innerHTML="";let q=null,z=null;for(let J of T){if(J.inning!==q||J.top!==z){let L=document.createElement("div");L.style.marginTop="1em",L.style.fontWeight="bold",L.textContent=`Inning ${J.inning} - ${J.top?"Top":"Bottom"}`,p.appendChild(L),q=J.inning,z=J.top}let H=["1B","2B","3B"].map((L,Q)=>J.bases[Q]?L:"").filter(Boolean).join(", ")||"Empty",X=document.createElement("div");X.innerHTML=`<strong>${J.batterName}:</strong> ${J.outcome} <span style="color:#888">(Outs: ${J.outs}, Score: Away ${J.score[0]} – Home ${J.score[1]}, Bases: ${H})</span>`,p.appendChild(X)}}function f(T,q){T(),q()}var E={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeFielders:null,awayFielders:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};async function O0(){try{return await t1()}catch(T){return console.error("Error fetching available teams:",T),[]}}function E1(T,q){let z=T.find((H)=>H.position===q);if(z)return z;let J=T.find((H)=>H.positions&&H.positions.includes(q));if(J)return J;return T.find((H)=>H.stats)||{stats:{armStrength:50,FP:0.985}}}function H0(T,q,z,J){let H=document.querySelector(".sticky-action-bar");if(H)H.querySelectorAll("button").forEach((L)=>{L.disabled=!0,L.classList.add("disabled-greyed")});if(x)x.textContent=`Game Over: ${T} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${z}${J?" Top":" Bottom"})`;if(p){let X=document.createElement("div");X.style.marginTop="1em",X.style.fontWeight="bold",X.style.color="#b00",X.textContent=`Game Over: ${T} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${z}${J?" Top":" Bottom"})`,p.appendChild(X)}}function Q0(){if(!E.homeRoster||!E.awayRoster)return;E.homeMatchups=q1(E.homeRoster),E.awayMatchups=q1(E.awayRoster),E.gameState=J0(),E.atBatLog=[],R(E.atBatLog),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)}function X0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups||!E.homeRoster||!E.awayRoster)return;let T=E.gameState,q=T.top?0:1,z=q===0?E.awayRoster:E.homeRoster,J=T.lineupIndices[q]%z.lineup.length,H=z.lineup[J],X=L0(E.awayMatchups,E.homeMatchups,T,E.awayFielders||[],E.homeFielders||[],E.awayRoster,E.homeRoster);if(S({batterName:H.name,outcome:X.outcome,outs:T.outs,score:[...T.score],bases:T.bases.map((M)=>M?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>R(E.atBatLog)),x1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},H0)){f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c);return}let Q="",Y=!1;if(T.outs>=3){if(T.top)Q="End of top half. Switching to bottom of inning.";else Q="End of inning. Advancing to next inning.";if(S({batterName:"::",outcome:Q,outs:T.outs,score:[...T.score],bases:T.bases.map((M)=>M?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>R(E.atBatLog)),T.bases=[null,null,null],T.outs=0,T.top)T.top=!1;else T.top=!0,T.inning++;Y=!0}if(Y){if(x1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},H0)){f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c);return}}f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)}function G0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups)Q0();while(E.gameState&&F&&!F.disabled)X0()}async function l1(){if(!h||!n||!x)return;let T=h.value,q=n.value;if(!T||!q)return;x.textContent="Loading lineups...";try{let[z,J]=await Promise.all([W1(T),W1(q)]);E.loadedHome=z,E.loadedAway=J,E.homeFielders=z.fielders,E.awayFielders=J.fielders;let H=z.batters.map((L)=>{let Q=z.fielders.find((Y)=>Y.player_id===L.player_id);if(Q)return{...L,...Q,stats:{...L.stats,...Q.stats},position:Q.position};return L}),X=J.batters.map((L)=>{let Q=J.fielders.find((Y)=>Y.player_id===L.player_id);if(Q)return{...L,...Q,stats:{...L.stats,...Q.stats},position:Q.position};return L});E.homeRoster=z&&z.batters&&z.pitchers?z1(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:H.slice(0,9).map((L)=>L.player_id),E.customHomePitcher||z.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||z.pitchers[0].player_id,H,z.pitchers):null,E.awayRoster=J&&J.batters&&J.pitchers?z1(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:X.slice(0,9).map((L)=>L.player_id),E.customAwayPitcher||J.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||J.pitchers[0].player_id,X,J.pitchers):null,P1(E.homeRoster,E.awayRoster),E.atBatLog=[],R(E.atBatLog),x.textContent="Lineups loaded. Ready to simulate!",Q0()}catch(z){console.error("Failed to load lineups:",z);let J=z&&typeof z==="object"&&"message"in z?z.message:String(z);x.textContent=`Failed to load lineups: ${J}`}}async function Y0(){if(!x)return;x.textContent="Loading teams...";try{let T=await O0();if(!T.length){x.textContent="No teams found in data folder.";return}for(let J of[h,n]){if(!J)continue;J.innerHTML="";for(let H of T){let X=document.createElement("option");X.value=H,X.textContent=H,J.appendChild(X)}}let q="CHC-2025",z="MIL-2025";if(h)h.value=T.includes(q)?q:T[0]||"";if(n)n.value=T.includes(z)?z:T[1]||T[0]||"";if(x.textContent="Select home and away teams.",h&&n&&h.value&&n.value)l1()}catch(T){console.error("Failed to populate team dropdowns:",T);let q=T&&typeof T==="object"&&"message"in T?T.message:String(T);x.textContent=`Failed to load teams: ${q}`}}function x0(){if(!E.loadedHome||!E.loadedAway)return;let T=E.homeRoster?.pitcher?.player_id,q=E.awayRoster?.pitcher?.player_id,z=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.fielders?E.loadedHome.batters.map((L)=>{let Q=E.loadedHome.fielders.find((Y)=>Y.player_id===L.player_id);if(Q)return{...L,...Q,stats:{...L.stats,...Q.stats},position:Q.position};return L}):[],J=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.fielders?E.loadedAway.batters.map((L)=>{let Q=E.loadedAway.fielders.find((Y)=>Y.player_id===L.player_id);if(Q)return{...L,...Q,stats:{...L.stats,...Q.stats},position:Q.position};return L}):[];E.homeRoster=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.pitchers?z1(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:z.slice(0,9).map((L)=>L.player_id),E.customHomePitcher||E.loadedHome.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||E.loadedHome.pitchers[0].player_id,z,E.loadedHome.pitchers):null,E.awayRoster=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.pitchers?z1(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:J.slice(0,9).map((L)=>L.player_id),E.customAwayPitcher||E.loadedAway.pitchers.find((L)=>L.name&&L.name!=="Player")?.player_id||E.loadedAway.pitchers[0].player_id,J,E.loadedAway.pitchers):null;let H=E.homeRoster?.pitcher?.player_id,X=E.awayRoster?.pitcher?.player_id;if(E.gameState&&E.gameState.pitcherFatigue){if(T&&H&&T!==H)E.gameState.pitcherFatigue[1]={battersFaced:0},console.log(`\uD83D\uDD04 Home pitcher changed from ${T} to ${H} - fatigue reset`);if(q&&X&&q!==X)E.gameState.pitcherFatigue[0]={battersFaced:0},console.log(`\uD83D\uDD04 Away pitcher changed from ${q} to ${X} - fatigue reset`)}if(E.homeRoster&&E.awayRoster)E.homeMatchups=q1({lineup:E.homeRoster.lineup,pitcher:E.awayRoster.pitcher}),E.awayMatchups=q1({lineup:E.awayRoster.lineup,pitcher:E.homeRoster.pitcher});P1(E.homeRoster,E.awayRoster),I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop)}function $0(T,q,z,J,H){if(E.editingTeam=T,!o||!y1||!t||!e)return;if(y1.textContent=`Customize ${T==="home"?"Home":"Away"} Lineup`,y)y.textContent="";o.style.display="flex";let X=J,L=H;if(T==="home"&&E.homeRoster)X=E.homeRoster.lineup?E.homeRoster.lineup.map((Q)=>Q.player_id):J,L=E.homeRoster.pitcher?E.homeRoster.pitcher.player_id:H;else if(T==="away"&&E.awayRoster)X=E.awayRoster.lineup?E.awayRoster.lineup.map((Q)=>Q.player_id):J,L=E.awayRoster.pitcher?E.awayRoster.pitcher.player_id:H;t.innerHTML="";for(let Q=0;Q<9;Q++){let Y=document.createElement("li"),M=document.createElement("select");if(M.name=`batter${Q}`,M.required=!0,M.innerHTML='<option value="">-- Select --</option>'+q.map(($)=>`<option value="${$.player_id}">${$.name} (${$.PA} PA)</option>`).join(""),X&&X[Q])M.value=X[Q];Y.appendChild(M),t.appendChild(Y)}if(e.innerHTML='<option value="">-- Select --</option>'+z.filter((Q)=>Q.name&&Q.name!=="Player"&&Q.name!=="Pitcher").map((Q)=>`<option value="${Q.player_id}">${Q.name} (${Q.stats&&Q.stats.IP?Q.stats.IP:""} IP)</option>`).join(""),L)e.value=L}function c(){if(!E.gameState)return;if(H1)H1.disabled=!E.gameState.bases[0];if(Q1)Q1.disabled=!E.gameState.bases[1];if(X1)X1.disabled=!E.gameState.bases[2];if(Y1)Y1.disabled=!E.gameState.bases[0];if($1)$1.disabled=!E.gameState.bases[1];if(M1)M1.disabled=!E.gameState.bases[2]}if(F1)F1.addEventListener("click",Y0);if(h)h.addEventListener("change",l1);if(n)n.addEventListener("change",l1);if(F)F.addEventListener("click",X0);if(I1)I1.addEventListener("click",()=>{if(!E.loadedHome)return;$0("home",E.loadedHome.batters,E.loadedHome.pitchers,E.customHomeLineup,E.customHomePitcher)});if(w1)w1.addEventListener("click",()=>{if(!E.loadedAway)return;$0("away",E.loadedAway.batters,E.loadedAway.pitchers,E.customAwayLineup,E.customAwayPitcher)});if(A1)A1.addEventListener("click",()=>{if(o)o.style.display="none"});if(R1)R1.addEventListener("submit",(T)=>{if(T.preventDefault(),!t||!e)return;let q=[],z=t.querySelectorAll("select");for(let H of z){if(!H.value){if(y)y.textContent="Please select a player for every lineup slot.";return}q.push(H.value)}if(new Set(q).size!==q.length){if(y)y.textContent="No duplicate players allowed in the lineup.";return}let J=e.value;if(!J){if(y)y.textContent="Please select a starting pitcher.";return}if(q.includes(J)){if(y)y.textContent="Pitcher cannot also be in the batting lineup.";return}if(E.editingTeam==="home")E.customHomeLineup=q,E.customHomePitcher=J;else E.customAwayLineup=q,E.customAwayPitcher=J;if(o)o.style.display="none";x0()});window.addEventListener("DOMContentLoaded",()=>{Y0()});if(H1)H1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,H=E.gameState.bases[0];if(!H)return;let X=J?E1(J,"C"):{stats:{armStrength:50}},L=z.pitcher,Q=j1(2,E.gameState,H,L,X,1);S({batterName:H.name,outcome:Q.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((Y)=>Y?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)});if(Q1)Q1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,H=E.gameState.bases[1];if(!H)return;let X=J?E1(J,"C"):{stats:{armStrength:50}},L=z.pitcher,Q=j1(3,E.gameState,H,L,X,2);S({batterName:H.name,outcome:Q.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((Y)=>Y?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)});if(X1)X1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,H=E.gameState.bases[2];if(!H)return;let X=J?E1(J,"C"):{stats:{armStrength:50}},L=z.pitcher,Q=j1(4,E.gameState,H,L,X,3);S({batterName:H.name,outcome:Q.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((Y)=>Y?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)});if(Y1)Y1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,H=E.gameState.bases[0];if(!H)return;let X=J?E1(J,"1B"):{stats:{FP:0.985}},L=z.pitcher,Q=_1(1,E.gameState,H,L,X);S({batterName:H.name,outcome:Q.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((Y)=>Y?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)});if($1)$1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,H=E.gameState.bases[1];if(!H)return;let X=J?E1(J,"2B"):{stats:{FP:0.985}},L=z.pitcher,Q=_1(2,E.gameState,H,L,X);S({batterName:H.name,outcome:Q.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((Y)=>Y?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)});if(M1)M1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,q=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,J=T===0?E.homeFielders:E.awayFielders,H=E.gameState.bases[2];if(!H)return;let X=J?E1(J,"3B"):{stats:{FP:0.985}},L=z.pitcher,Q=_1(3,E.gameState,H,L,X);S({batterName:H.name,outcome:Q.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((Y)=>Y?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>I(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),c)});if(f1)f1.addEventListener("click",G0);
