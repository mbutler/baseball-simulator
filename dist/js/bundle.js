function F(J){const q=/<!--([\s\S]*?)-->/g,K=[];let G;while((G=q.exec(J))!==null)K.push(G[1]);return K}function y(J,q){const K=new DOMParser;for(let G of J)if(G.includes(`id="${q}"`))return K.parseFromString(G,"text/html").querySelector(`table#${q}`)||null;return null}function f(J){const q=document.createElement("div");q.style.display="none",document.body.appendChild(q),q.innerHTML=J;const K=q.querySelector("table#players_standard_batting"),G=q.querySelector("table#players_standard_pitching"),Q=F(J),U=y(Q,"players_standard_fielding");return q.remove(),{batting:K,pitching:G,fielding:U}}function O(J){if(!J||!J.href)return null;const q=J.href.match(/\/players\/.\/([^/.]+)\.shtml/);return q?q[1]:null}function k(J){return J.toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,12)}function j(J){if(!J)return[];const q=Array.from(J.querySelectorAll("tbody > tr")).filter((Q)=>!Q.classList.contains("thead")),K=Array.from(J.querySelectorAll("thead tr th")).map((Q)=>(Q.textContent??"").trim()),G=[];for(let Q of q){const U=[Q.querySelector("th"),...Q.querySelectorAll("td")];if(U.length!==K.length)continue;const W={};for(let V=0;V<K.length;V++){const Z=K[V],M=U[V];if(V===0){let X=M?.textContent?.trim()||"",Y=M?.querySelector?.("a")||null,_=O(Y);if(/^\d+$/.test(X)){const E=Q.querySelector("td");X=E?.textContent?.trim()||"(unknown)",Y=E?.querySelector?.("a")||null,_=O(Y)||_}W.name=X,W.player_id=_||k(X)}else{const X=M?.textContent?.trim()||"",Y=Number(X.replace(/,/g,""));W[Z]=isNaN(Y)?X:Y}}G.push(W)}return G}function v(J){return J.map((q)=>{const K=Number(q.PA)||0,G=Number(q.AB)||0,Q=Number(q.H)||0,U=Number(q.HR)||0,W=Number(q.BB)||0,V=Number(q.SO)||0,Z=Number(q.SF)||0,M=Number(q.HBP)||0,X=Number(q["2B"])||0,Y=Number(q["3B"])||0,_=Q-X-Y-U,E=G-V-U+Z,A=E>0?(Q-U)/E:null,w=K>0?V/K:null,H=K>0?W/K:null,R=K>0?U/K:null;return{name:q.name,player_id:q.player_id,PA:K,stats:{H:Q,HR:U,BB:W,SO:V,SF:Z,HBP:M,singles:_,doubles:X,triples:Y},rates:{kRate:w,bbRate:H,hrRate:R,BABIP:A}}})}function C(J){return J.map((q)=>{const K=Number(q.IP)||0,G=Number(q.TBF)||0,Q=Number(q.H)||0,U=Number(q.HR)||0,W=Number(q.BB)||0,V=Number(q.SO)||0,Z=Number(q.HBP)||0,M=G>0?V/G:null,X=G>0?W/G:null,Y=G>0?U/G:null,_=G-V-U-W-Z,E=_>0?(Q-U)/_:null;return{name:q.name,player_id:q.player_id,TBF:G,stats:{IP:K,H:Q,HR:U,BB:W,SO:V,HBP:Z},rates:{kRate:M,bbRate:X,hrRate:Y,BABIP:E}}})}async function P(){try{const J=await fetch("./data/index.json");if(J.ok)return await J.json()}catch{}try{const q=await(await fetch("./data/")).text();return Array.from(q.matchAll(/href="([A-Z]{3}-\d{4}\.html)"/g)).map((G)=>G[1])}catch{return[]}}async function I(J){const K=await(await fetch(`./data/${J}`)).text(),{batting:G,pitching:Q}=f(K),U=G?j(G):[],W=Q?j(Q):[],V=v(U),Z=C(W);return{batters:V,pitchers:Z}}function T(J,q){if(!L)return;L.innerHTML="";const K=(G,Q)=>{if(!G)return`<div><strong>${Q}:</strong> Not loaded</div>`;const U=G.pitchers&&G.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${Q} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>PA</th></tr></thead>
          <tbody>
            ${(G.batters||[]).slice(0,9).map((W,V)=>`<tr><td>${V+1}</td><td>${W.name||""}</td><td>${W.PA||""}</td></tr>`).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${U.name}</div>
      </div>
    `};L.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${K(J,"Home")}</div>
      <div style="flex:1;min-width:250px;">${K(q,"Away")}</div>
    </div>
  `}async function x(){if(!N||!z||!$)return;const J=N.value,q=z.value;if(!J||!q)return;$.textContent="Loading lineups...";try{const[K,G]=await Promise.all([I(J),I(q)]);T(K,G),$.textContent="Lineups loaded. Ready to simulate!"}catch(K){$.textContent="Failed to load lineups."}}async function D(){if(!$)return;$.textContent="Loading teams...";const J=await P();if(!J.length){$.textContent="No teams found in data folder.";return}for(let q of[N,z]){if(!q)continue;q.innerHTML="";for(let K of J){const G=document.createElement("option");G.value=K,G.textContent=K.replace(".html",""),q.appendChild(G)}}if($.textContent="Select home and away teams.",N&&z)x()}var N=document.getElementById("home-team-select"),z=document.getElementById("away-team-select"),g=document.getElementById("load-teams-btn"),$=document.getElementById("status"),L=document.getElementById("lineups-container");if(g)g.addEventListener("click",D);if(N)N.addEventListener("change",x);if(z)z.addEventListener("change",x);window.addEventListener("DOMContentLoaded",()=>{D()});
