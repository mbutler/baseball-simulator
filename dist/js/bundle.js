var H0=Object.create;var{getPrototypeOf:Q0,defineProperty:K1,getOwnPropertyNames:X0}=Object;var Y0=Object.prototype.hasOwnProperty;var Z0=(T,q,J)=>{J=T!=null?H0(Q0(T)):{};let M=q||!T||!T.__esModule?K1(J,"default",{value:T,enumerable:!0}):J;for(let Q of X0(T))if(!Y0.call(M,Q))K1(M,Q,{get:()=>T[Q],enumerable:!0});return M};var $0=(T,q)=>{for(var J in q)K1(T,J,{get:q[J],enumerable:!0,configurable:!0,set:(M)=>q[J]=()=>M})};var E0=(T,q)=>()=>(T&&(q=T(T=0)),q);var V0=((T)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(T,{get:(q,J)=>(typeof require!=="undefined"?require:q)[J]}):T)(function(T){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+T+'" is not supported')});var p1={};$0(p1,{sep:()=>d1,resolve:()=>X1,relative:()=>R1,posix:()=>g1,parse:()=>c1,normalize:()=>j1,join:()=>A1,isAbsolute:()=>f1,format:()=>n1,extname:()=>h1,dirname:()=>l1,delimiter:()=>b1,default:()=>N0,basename:()=>B1,_makeLong:()=>u1});function f(T){if(typeof T!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(T))}function P1(T,q){var J="",M=0,Q=-1,Y=0,X;for(var H=0;H<=T.length;++H){if(H<T.length)X=T.charCodeAt(H);else if(X===47)break;else X=47;if(X===47){if(Q===H-1||Y===1);else if(Q!==H-1&&Y===2){if(J.length<2||M!==2||J.charCodeAt(J.length-1)!==46||J.charCodeAt(J.length-2)!==46){if(J.length>2){var Z=J.lastIndexOf("/");if(Z!==J.length-1){if(Z===-1)J="",M=0;else J=J.slice(0,Z),M=J.length-1-J.lastIndexOf("/");Q=H,Y=0;continue}}else if(J.length===2||J.length===1){J="",M=0,Q=H,Y=0;continue}}if(q){if(J.length>0)J+="/..";else J="..";M=2}}else{if(J.length>0)J+="/"+T.slice(Q+1,H);else J=T.slice(Q+1,H);M=H-Q-1}Q=H,Y=0}else if(X===46&&Y!==-1)++Y;else Y=-1}return J}function v0(T,q){var J=q.dir||q.root,M=q.base||(q.name||"")+(q.ext||"");if(!J)return M;if(J===q.root)return J+M;return J+T+M}function X1(){var T="",q=!1,J;for(var M=arguments.length-1;M>=-1&&!q;M--){var Q;if(M>=0)Q=arguments[M];else{if(J===void 0)J=process.cwd();Q=J}if(f(Q),Q.length===0)continue;T=Q+"/"+T,q=Q.charCodeAt(0)===47}if(T=P1(T,!q),q)if(T.length>0)return"/"+T;else return"/";else if(T.length>0)return T;else return"."}function j1(T){if(f(T),T.length===0)return".";var q=T.charCodeAt(0)===47,J=T.charCodeAt(T.length-1)===47;if(T=P1(T,!q),T.length===0&&!q)T=".";if(T.length>0&&J)T+="/";if(q)return"/"+T;return T}function f1(T){return f(T),T.length>0&&T.charCodeAt(0)===47}function A1(){if(arguments.length===0)return".";var T;for(var q=0;q<arguments.length;++q){var J=arguments[q];if(f(J),J.length>0)if(T===void 0)T=J;else T+="/"+J}if(T===void 0)return".";return j1(T)}function R1(T,q){if(f(T),f(q),T===q)return"";if(T=X1(T),q=X1(q),T===q)return"";var J=1;for(;J<T.length;++J)if(T.charCodeAt(J)!==47)break;var M=T.length,Q=M-J,Y=1;for(;Y<q.length;++Y)if(q.charCodeAt(Y)!==47)break;var X=q.length,H=X-Y,Z=Q<H?Q:H,E=-1,$=0;for(;$<=Z;++$){if($===Z){if(H>Z){if(q.charCodeAt(Y+$)===47)return q.slice(Y+$+1);else if($===0)return q.slice(Y+$)}else if(Q>Z){if(T.charCodeAt(J+$)===47)E=$;else if($===0)E=0}break}var N=T.charCodeAt(J+$),O=q.charCodeAt(Y+$);if(N!==O)break;else if(N===47)E=$}var C="";for($=J+E+1;$<=M;++$)if($===M||T.charCodeAt($)===47)if(C.length===0)C+="..";else C+="/..";if(C.length>0)return C+q.slice(Y+E);else{if(Y+=E,q.charCodeAt(Y)===47)++Y;return q.slice(Y)}}function u1(T){return T}function l1(T){if(f(T),T.length===0)return".";var q=T.charCodeAt(0),J=q===47,M=-1,Q=!0;for(var Y=T.length-1;Y>=1;--Y)if(q=T.charCodeAt(Y),q===47){if(!Q){M=Y;break}}else Q=!1;if(M===-1)return J?"/":".";if(J&&M===1)return"//";return T.slice(0,M)}function B1(T,q){if(q!==void 0&&typeof q!=="string")throw new TypeError('"ext" argument must be a string');f(T);var J=0,M=-1,Q=!0,Y;if(q!==void 0&&q.length>0&&q.length<=T.length){if(q.length===T.length&&q===T)return"";var X=q.length-1,H=-1;for(Y=T.length-1;Y>=0;--Y){var Z=T.charCodeAt(Y);if(Z===47){if(!Q){J=Y+1;break}}else{if(H===-1)Q=!1,H=Y+1;if(X>=0)if(Z===q.charCodeAt(X)){if(--X===-1)M=Y}else X=-1,M=H}}if(J===M)M=H;else if(M===-1)M=T.length;return T.slice(J,M)}else{for(Y=T.length-1;Y>=0;--Y)if(T.charCodeAt(Y)===47){if(!Q){J=Y+1;break}}else if(M===-1)Q=!1,M=Y+1;if(M===-1)return"";return T.slice(J,M)}}function h1(T){f(T);var q=-1,J=0,M=-1,Q=!0,Y=0;for(var X=T.length-1;X>=0;--X){var H=T.charCodeAt(X);if(H===47){if(!Q){J=X+1;break}continue}if(M===-1)Q=!1,M=X+1;if(H===46){if(q===-1)q=X;else if(Y!==1)Y=1}else if(q!==-1)Y=-1}if(q===-1||M===-1||Y===0||Y===1&&q===M-1&&q===J+1)return"";return T.slice(q,M)}function n1(T){if(T===null||typeof T!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof T);return v0("/",T)}function c1(T){f(T);var q={root:"",dir:"",base:"",ext:"",name:""};if(T.length===0)return q;var J=T.charCodeAt(0),M=J===47,Q;if(M)q.root="/",Q=1;else Q=0;var Y=-1,X=0,H=-1,Z=!0,E=T.length-1,$=0;for(;E>=Q;--E){if(J=T.charCodeAt(E),J===47){if(!Z){X=E+1;break}continue}if(H===-1)Z=!1,H=E+1;if(J===46){if(Y===-1)Y=E;else if($!==1)$=1}else if(Y!==-1)$=-1}if(Y===-1||H===-1||$===0||$===1&&Y===H-1&&Y===X+1){if(H!==-1)if(X===0&&M)q.base=q.name=T.slice(1,H);else q.base=q.name=T.slice(X,H)}else{if(X===0&&M)q.name=T.slice(1,Y),q.base=T.slice(1,H);else q.name=T.slice(X,Y),q.base=T.slice(X,H);q.ext=T.slice(Y,H)}if(X>0)q.dir=T.slice(0,X-1);else if(M)q.dir="/";return q}var d1="/",b1=":",g1,N0;var i1=E0(()=>{g1=((T)=>(T.posix=T,T))({resolve:X1,normalize:j1,isAbsolute:f1,join:A1,relative:R1,_makeLong:u1,dirname:l1,basename:B1,extname:h1,format:n1,parse:c1,sep:d1,delimiter:b1,win32:null,posix:null}),N0=g1});var Y1=null;async function S1(){if(Y1)return Y1;try{if(typeof window!=="undefined"&&typeof fetch!=="undefined"){let T=await fetch("./complete-dataset-2025.json");if(!T.ok)throw new Error(`Failed to load dataset: ${T.status} ${T.statusText}`);let q=await T.json();return Y1=q,q}else{let T=await import("fs"),J=(await Promise.resolve().then(() => (i1(),p1))).join(process.cwd(),"dist","complete-dataset-2025.json"),M=T.readFileSync(J,"utf8"),Q=JSON.parse(M);return Y1=Q,Q}}catch(T){throw console.error("Error loading dataset:",T),new Error("Failed to load baseball dataset. Please ensure complete-dataset-2025.json is available.")}}async function m1(){return(await S1()).teams.map((q)=>`${q.team}-${q.year}.html`)}async function U1(T){let q=await S1(),J=T.replace(".html","").split("-")[0],M=q.teams.find((H)=>H.team===J);if(!M)throw new Error(`Team ${J} not found in dataset`);let Q=[],Y=[],X=[];return M.players.forEach((H)=>{let Z={name:H.name,player_id:H.player_id,team:H.team,year:H.year};if(H.batting)Q.push({...Z,PA:H.batting.PA,stats:H.batting.stats,rates:H.batting.rates,baserunning:H.batting.baserunning});if(H.pitching)Y.push({...Z,TBF:H.pitching.TBF,stats:H.pitching.stats,rates:H.pitching.rates});if(H.fielding)X.push({...Z,position:H.fielding.position,stats:H.fielding.stats})}),{batters:Q,pitchers:Y,fielders:X}}function a(T,q,J,M){let Q=T.map((H)=>{let Z=J.find((E)=>E.player_id===H);if(!Z)throw new Error(`Lineup player not found: ${H}`);return Z}),Y=M.find((H)=>H.player_id===q);if(!Y)throw new Error(`Starting pitcher not found: ${q}`);let X=new Set;for(let H of Q){if(X.has(H.player_id))throw new Error(`Duplicate player in lineup: ${H.player_id}`);X.add(H.player_id)}if(X.has(q))throw new Error(`Pitcher also appears in lineup: ${q}`);return{lineup:Q,pitcher:Y}}function L0(T,q){return(T+q)/2}function i(T,q){return T==null||isNaN(T)||T===0?q:T}var Z1=0.22,$1=0.08,E1=0.03;function s1(T,q){let J=T.rates||{},M=q.rates||{},Q=T.stats||{},Y=K(i(J.kRate,Z1),"batter.kRate"),X=K(i(M.kRate,Z1),"pitcher.kRate"),H=K(i(J.bbRate,$1),"batter.bbRate"),Z=K(i(M.bbRate,$1),"pitcher.bbRate"),E=K(i(J.hrRate,E1),"batter.hrRate"),$=K(i(M.hrRate,E1),"pitcher.hrRate"),N=K(J.BABIP??0.29,"batter.BABIP"),O=K(M.BABIP??0.29,"pitcher.BABIP"),C=Math.max(0,T.PA||0),R=Math.max(0,Q.HBP??0),o=Math.max(0,Q.singles??0),u=Math.max(0,Q.doubles??0),_=Math.max(0,Q.triples??0),c=K(Z1>0?Y*X/Z1:0,"K"),L=K($1>0?H*Z/$1:0,"BB"),k=K(E1>0?E*$/E1:0,"HR"),G=K(L0(N,O),"BABIP"),j=K(C>0?R/C:0,"HBP"),y=c+L+j+k,b=Math.max(0,1-y),g=G*b,L1=b-g,V=o+u+_,v=V>0?o/V:0.7,U=V>0?u/V:0.2,P=V>0?_/V:0.1;return{K:K(c,"K"),BB:K(L,"BB"),HBP:K(j,"HBP"),HR:K(k,"HR"),"1B":K(g*v,"1B"),"2B":K(g*U,"2B"),"3B":K(g*P,"3B"),Out:K(L1,"Out")}}function K(T,q){if(typeof T!=="number"||isNaN(T))return 0;if(T<0){if(q)console.warn(`[probabilityModel] Clamped negative value for ${q}: ${T} → 0`);return 0}if(T>1){if(q)console.warn(`[probabilityModel] Clamped value >1 for ${q}: ${T} → 1`);return 1}return T}function t(T){let{lineup:q,pitcher:J}=T;return q.map((M)=>{let Q=s1(M,J);return{batter_id:M.player_id,pitcher_id:J.player_id,probabilities:Q}})}function e(T){let q=Object.values(T).reduce((M,Q)=>M+Q,0),J=Math.random()*q;for(let[M,Q]of Object.entries(T))if((J-=Q)<=0)return M;return Object.keys(T).pop()||""}var K0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},j0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function o1(T){if(T==="Out"){let q=e(K0),J=e(j0[q]);return`${q} to ${J}`}return T}function r1(T){if(!T||typeof T!=="string")return"";let q=T.replace(/\*/g,"").split(/[/,]/)[0],J={"1":"P","2":"C","3":"1B","4":"2B","5":"3B","6":"SS","7":"LF","8":"CF","9":"RF",D:"DH",H:"PH"};if(J[q])return J[q];let M=q.charAt(0);if(J[M])return J[M];return q}function a1(){return{inning:1,top:!0,outs:0,bases:[null,null,null],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function C1(T){let q=[];if(T[0])q.push(0);if(T[1]&&T[0])q.push(1);if(T[2]&&T[1]&&T[0])q.push(2);return q}function k1(T,q,J){let M=0,Q=[null,null,null];for(let X=2;X>=0;X--){if(!T[X])continue;let H=X+(q==="1B"?1:q==="2B"?2:q==="3B"?3:4);if(H>=3)M++;else Q[H]=T[X]}let Y={"1B":0,"2B":1,"3B":2}[q];if(Y!==void 0)Q[Y]=J;if(q==="HR")M++;return[Q,M]}function t1(T,q,J,M,Q,Y,X,H,Z){let E=H||e,$=Z||o1,N=J.top?0:1,O=N===0?T:q,C=N===0?Y:X,R=N===0?Q:M,o=Array.isArray(R)?R:[],u=J.lineupIndices[N],_=O[u%O.length],c=C.lineup[u%C.lineup.length],L=_.probabilities;if(J.pitcherFatigue&&J.pitcherFatigue[1-N]){J.pitcherFatigue[1-N].battersFaced++;let V=J.pitcherFatigue[1-N].battersFaced;if(V>18){let U=Math.min((V-18)*0.005,0.05);L={...L};let P=L.Out;if(L.BB)L.BB+=U;if(L["1B"])L["1B"]+=U;if(L.Out){if(L.Out-=U,L.Out<0.5*P)L.Out=0.5*P}let r=Object.values(L).reduce((p,M0)=>p+M0,0);Object.keys(L).forEach((p)=>L[p]=Math.max(0,L[p]/r))}}let k=E(L),G=$(k);J.lineupIndices[N]++;let j=void 0,y="",b=!1,g=!1,L1=!1;if(k==="Out"){let V=G.match(/to ([A-Z0-9]+)/);if(V){if(y=V[1],j=o.find((v)=>v.position===y),j&&j.stats){let v=Number(j.stats.E)||0,U=Number(j.stats.PO)||0,P=Number(j.stats.A)||0,r=U+P+v,p=r>0?v/r:0.01;if(Math.random()<p)b=!0}else if(Math.random()<0.01)b=!0}}if(b){let[V,v]=k1(J.bases,"1B",c);return J.bases=V,J.score[N]+=v,{batter_id:_.batter_id,outcome:`Error on ${y}`,fielder:j,fielderPosition:y}}if(k==="Out"&&/^Groundout to [A-Z0-9]+$/.test(G)&&J.outs===0){let V=C1(J.bases);if(V.length>=2){if(Math.random()<0.01){L1=!0;let v=V.slice().sort((U,P)=>P-U);for(let U=0;U<2&&U<v.length;U++)J.bases[v[U]]=null;return J.outs=3,{batter_id:_.batter_id,outcome:"Grounded into triple play",...j?{fielder:j,fielderPosition:y}:{}}}}}if(k==="Out"&&/^Groundout to [A-Z0-9]+$/.test(G)&&J.outs<2){let V=C1(J.bases);if(V.length>=1){if(Math.random()<0.25){g=!0;let v=Math.max(...V);return J.bases[v]=null,J.outs=Math.min(J.outs+2,3),{batter_id:_.batter_id,outcome:"Grounded into double play",...j?{fielder:j,fielderPosition:y}:{}}}}}if(k==="Out"&&/^Groundout to [A-Z0-9]+$/.test(G)){J.outs++;let V=C1(J.bases);for(let v of V.slice().sort((U,P)=>P-U))if(J.bases[v])if(v===2)J.bases[v]=null,J.score[N]+=1;else J.bases[v+1]=J.bases[v],J.bases[v]=null;return{batter_id:_.batter_id,outcome:G,...j?{fielder:j,fielderPosition:y}:{}}}if(k==="Out"||k==="K")J.outs++;else if(k==="BB"||k==="HBP"){let[V,v]=k1(J.bases,"1B",c);J.bases=V,J.score[N]+=v}else{let[V,v]=k1(J.bases,k,c);J.bases=V,J.score[N]+=v}return{batter_id:_.batter_id,outcome:G,...j?{fielder:j,fielderPosition:y}:{}}}function V1(T,q,J,M,Q,Y,X){let H=X||Math.random;if(!q.bases[Y-1])return{success:!1,out:!1,description:`No runner on base ${Y} to steal from.`};let Z=T===2?0.6:T===3?0.3:0.1;if(J?.baserunning&&Q?.stats){let $=J.baserunning.speed||50,N=Q.stats.armStrength||50,O=J.name||J.player_id||"Unknown Runner",C=Q.name||Q.player_id||"Unknown Catcher";if(console.log(`[STEAL ATTEMPT] Runner: ${O} (speed: ${$}), Catcher: ${C} (arm: ${N})`),Z=0.5+($-N)/200,T===3)Z-=0.2;if(T===4)Z-=0.4;Z=Math.max(0.05,Math.min(0.95,Z))}if(H(1)<Z){let $=q.bases[Y-1];if(q.bases[Y-1]=null,T<=3)q.bases[T-1]=$;else q.score[q.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${T===4?"Home":T}`}}else return q.bases[Y-1]=null,q.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${T===4?"Home":T}`}}function v1(T,q,J,M,Q,Y){let X=Y||Math.random;if(!q.bases[T-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${T} to pick off.`};let H=0.05,Z=0.1;if(M?.stats&&J?.baserunning){let $=M.stats.pickoffs||0,N=J.baserunning.speed||50;H=0.03+$*0.02-(N-50)/1000,H=Math.max(0.01,Math.min(0.15,H))}if(Q?.stats)Z=0.05+(1-(Q.stats.FP||0.985))*2,Z=Math.max(0.01,Math.min(0.2,Z));let E=X(1);if(E<H)return q.bases[T-1]=null,q.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${T}`};else if(E<H+Z){let $=q.bases[T-1];if(q.bases[T-1]=null,T<3)q.bases[T]=$;else q.score[q.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${T}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${T} unsuccessful`}}function D1(T,q){let{inning:J,top:M,outs:Q,score:Y}=T,[X,H]=Y;if(J<9)return!1;if(M&&Q===3){if(H>X)return q("Home",Y,J,!0),!0;return!1}if(!M&&Q===3)if(X>H)return q("Away",Y,J,!1),!0;else if(H>X)return q("Home",Y,J,!1),!0;else return!1;if(!M&&Q<3&&H>X)return q("Home",Y,J,!1),!0;return!1}var l=document.getElementById("home-team-select"),B=document.getElementById("away-team-select"),W1=document.getElementById("load-teams-btn"),I=document.getElementById("status"),N1=document.getElementById("lineups-container"),z1=document.getElementById("game-state-container"),D=document.getElementById("next-atbat-btn"),h=document.getElementById("atbat-result-container"),O1=document.getElementById("customize-home-lineup-btn"),_1=document.getElementById("customize-away-lineup-btn"),d=document.getElementById("custom-lineup-modal"),I1=document.getElementById("close-lineup-modal"),F1=document.getElementById("lineup-modal-title"),x1=document.getElementById("custom-lineup-form"),S=document.getElementById("batting-order-list"),m=document.getElementById("pitcher-select"),F=document.getElementById("lineup-error"),T1=document.getElementById("steal-2b-btn"),q1=document.getElementById("steal-3b-btn"),J1=document.getElementById("steal-home-btn"),M1=document.getElementById("pickoff-1b-btn"),H1=document.getElementById("pickoff-2b-btn"),Q1=document.getElementById("pickoff-3b-btn"),w1=document.getElementById("simulate-full-game-btn");function G1(T,q){if(!N1)return;N1.innerHTML="";let J=(M,Q)=>{if(!M)return`<div><strong>${Q}:</strong> Not loaded</div>`;let Y=M.lineup||M.batters||[],X=M.pitcher||M.pitchers&&M.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${Q} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>BABIP</th></tr></thead>
          <tbody>
            ${(Y||[]).slice(0,9).map((H,Z)=>{let E=H.position?r1(H.position):"",$=H.rates?.BABIP?Number(H.rates.BABIP).toFixed(3):"";return`<tr><td>${Z+1}</td><td>${H.name||""}${E?` <span class='pos-label'>(${E})</span>`:""}</td><td>${$}</td></tr>`}).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${X.name}</div>
      </div>
    `};N1.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${J(T,"Home")}</div>
      <div style="flex:1;min-width:250px;">${J(q,"Away")}</div>
    </div>
  `}function W(T,q,J,M,Q,Y,X){if(!z1)return;if(!T||!q||!J){if(z1.innerHTML="<em>Game not started.</em>",D)D.style.display="none";return}if(D)D.style.display="";let H=T,{inning:Z,top:E,outs:$,bases:N,score:O,lineupIndices:C}=H,R=E?0:1,o=R===0?Q:M,u=R===0?J:q;if(!u){if(z1.innerHTML="<em>Roster not loaded.</em>",D)D.style.display="none";return}let _=C[R]%u.lineup.length,c=u.lineup[_],L=(R===0?q:J).pitcher,k=["1B","2B","3B"].map((G,j)=>H.bases[j]?G:"").filter(Boolean).join(", ")||"Empty";z1.innerHTML=`
    <div><strong>Inning:</strong> ${Z} (${E?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${$}</div>
    <div><strong>Bases:</strong> ${k}</div>
    <div><strong>Score:</strong> Away ${O[0]} &ndash; Home ${O[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${c.name} (vs ${L.name})</div>
  `}function n(T,q,J){if(!h)return;if(!T)return;q.push(T),J()}function x(T){if(!h)return;h.innerHTML="";let q=null,J=null;for(let M of T){if(M.inning!==q||M.top!==J){let X=document.createElement("div");X.style.marginTop="1em",X.style.fontWeight="bold",X.textContent=`Inning ${M.inning} - ${M.top?"Top":"Bottom"}`,h.appendChild(X),q=M.inning,J=M.top}let Q=["1B","2B","3B"].map((X,H)=>M.bases[H]?X:"").filter(Boolean).join(", ")||"Empty",Y=document.createElement("div");Y.innerHTML=`<strong>${M.batterName}:</strong> ${M.outcome} <span style="color:#888">(Outs: ${M.outs}, Score: Away ${M.score[0]} – Home ${M.score[1]}, Bases: ${Q})</span>`,h.appendChild(Y)}}function w(T,q){T(),q()}var z={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeFielders:null,awayFielders:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};async function U0(){try{return await m1()}catch(T){return console.error("Error fetching available teams:",T),[]}}function s(T,q){let J=T.find((Q)=>Q.position===q);if(J)return J;let M=T.find((Q)=>Q.positions&&Q.positions.includes(q));if(M)return M;return T.find((Q)=>Q.stats)||{stats:{armStrength:50,FP:0.985}}}function e1(T,q,J,M){let Q=document.querySelector(".sticky-action-bar");if(Q)Q.querySelectorAll("button").forEach((X)=>{X.disabled=!0,X.classList.add("disabled-greyed")});if(I)I.textContent=`Game Over: ${T} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${J}${M?" Top":" Bottom"})`;if(h){let Y=document.createElement("div");Y.style.marginTop="1em",Y.style.fontWeight="bold",Y.style.color="#b00",Y.textContent=`Game Over: ${T} wins! Final Score: Away ${q[0]} – Home ${q[1]} (${J}${M?" Top":" Bottom"})`,h.appendChild(Y)}}function z0(){if(!z.homeRoster||!z.awayRoster)return;z.homeMatchups=t(z.homeRoster),z.awayMatchups=t(z.awayRoster),z.gameState=a1(),z.atBatLog=[],x(z.atBatLog),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)}function T0(){if(!z.gameState||!z.homeMatchups||!z.awayMatchups||!z.homeRoster||!z.awayRoster)return;let T=z.gameState,q=T.top?0:1,J=q===0?z.awayRoster:z.homeRoster,M=T.lineupIndices[q]%J.lineup.length,Q=J.lineup[M],Y=t1(z.awayMatchups,z.homeMatchups,T,[],[],z.awayRoster,z.homeRoster);if(n({batterName:Q.name,outcome:Y.outcome,outs:T.outs,score:[...T.score],bases:T.bases.map((E)=>E?1:0),inning:T.inning,top:T.top},z.atBatLog,()=>x(z.atBatLog)),D1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},e1)){w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A);return}let H="",Z=!1;if(T.outs>=3){if(T.top)H="End of top half. Switching to bottom of inning.";else H="End of inning. Advancing to next inning.";if(n({batterName:"::",outcome:H,outs:T.outs,score:[...T.score],bases:T.bases.map((E)=>E?1:0),inning:T.inning,top:T.top},z.atBatLog,()=>x(z.atBatLog)),T.bases=[null,null,null],T.outs=0,T.top)T.top=!1;else T.top=!0,T.inning++;Z=!0}if(Z){if(D1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},e1)){w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A);return}}w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)}function C0(){if(!z.gameState||!z.homeMatchups||!z.awayMatchups)z0();while(z.gameState&&D&&!D.disabled)T0()}async function y1(){if(!l||!B||!I)return;let T=l.value,q=B.value;if(!T||!q)return;I.textContent="Loading lineups...";try{let[J,M]=await Promise.all([U1(T),U1(q)]);z.loadedHome=J,z.loadedAway=M,z.homeFielders=J.fielders,z.awayFielders=M.fielders;let Q=J.batters.map((X)=>{let H=J.fielders.find((Z)=>Z.player_id===X.player_id);if(H)return{...X,...H,stats:{...X.stats,...H.stats},position:H.position};return X}),Y=M.batters.map((X)=>{let H=M.fielders.find((Z)=>Z.player_id===X.player_id);if(H)return{...X,...H,stats:{...X.stats,...H.stats},position:H.position};return X});z.homeRoster=J&&J.batters&&J.pitchers?a(z.customHomeLineup&&z.customHomeLineup.length===9?z.customHomeLineup:Q.slice(0,9).map((X)=>X.player_id),z.customHomePitcher||J.pitchers.find((X)=>X.name&&X.name!=="Player")?.player_id||J.pitchers[0].player_id,Q,J.pitchers):null,z.awayRoster=M&&M.batters&&M.pitchers?a(z.customAwayLineup&&z.customAwayLineup.length===9?z.customAwayLineup:Y.slice(0,9).map((X)=>X.player_id),z.customAwayPitcher||M.pitchers.find((X)=>X.name&&X.name!=="Player")?.player_id||M.pitchers[0].player_id,Y,M.pitchers):null,G1(z.homeRoster,z.awayRoster),z.atBatLog=[],x(z.atBatLog),I.textContent="Lineups loaded. Ready to simulate!",z0()}catch(J){I.textContent="Failed to load lineups."}}async function q0(){if(!I)return;I.textContent="Loading teams...";let T=await U0();if(!T.length){I.textContent="No teams found in data folder.";return}for(let q of[l,B]){if(!q)continue;q.innerHTML="";for(let J of T){let M=document.createElement("option");M.value=J,M.textContent=J.replace(".html",""),q.appendChild(M)}}if(l)l.value="CHC-2025.html";if(B)B.value="MIL-2025.html";if(I.textContent="Select home and away teams.",l&&B)y1()}function k0(){if(!z.loadedHome||!z.loadedAway)return;let T=z.homeRoster?.pitcher?.player_id,q=z.awayRoster?.pitcher?.player_id,J=z.loadedHome&&z.loadedHome.batters&&z.loadedHome.fielders?z.loadedHome.batters.map((X)=>{let H=z.loadedHome.fielders.find((Z)=>Z.player_id===X.player_id);if(H)return{...X,...H,stats:{...X.stats,...H.stats},position:H.position};return X}):[],M=z.loadedAway&&z.loadedAway.batters&&z.loadedAway.fielders?z.loadedAway.batters.map((X)=>{let H=z.loadedAway.fielders.find((Z)=>Z.player_id===X.player_id);if(H)return{...X,...H,stats:{...X.stats,...H.stats},position:H.position};return X}):[];z.homeRoster=z.loadedHome&&z.loadedHome.batters&&z.loadedHome.pitchers?a(z.customHomeLineup&&z.customHomeLineup.length===9?z.customHomeLineup:J.slice(0,9).map((X)=>X.player_id),z.customHomePitcher||z.loadedHome.pitchers.find((X)=>X.name&&X.name!=="Player")?.player_id||z.loadedHome.pitchers[0].player_id,J,z.loadedHome.pitchers):null,z.awayRoster=z.loadedAway&&z.loadedAway.batters&&z.loadedAway.pitchers?a(z.customAwayLineup&&z.customAwayLineup.length===9?z.customAwayLineup:M.slice(0,9).map((X)=>X.player_id),z.customAwayPitcher||z.loadedAway.pitchers.find((X)=>X.name&&X.name!=="Player")?.player_id||z.loadedAway.pitchers[0].player_id,M,z.loadedAway.pitchers):null;let Q=z.homeRoster?.pitcher?.player_id,Y=z.awayRoster?.pitcher?.player_id;if(z.gameState&&z.gameState.pitcherFatigue){if(T&&Q&&T!==Q)z.gameState.pitcherFatigue[1]={battersFaced:0},console.log(`\uD83D\uDD04 Home pitcher changed from ${T} to ${Q} - fatigue reset`);if(q&&Y&&q!==Y)z.gameState.pitcherFatigue[0]={battersFaced:0},console.log(`\uD83D\uDD04 Away pitcher changed from ${q} to ${Y} - fatigue reset`)}if(z.homeRoster&&z.awayRoster)z.homeMatchups=t({lineup:z.homeRoster.lineup,pitcher:z.awayRoster.pitcher}),z.awayMatchups=t({lineup:z.awayRoster.lineup,pitcher:z.homeRoster.pitcher});G1(z.homeRoster,z.awayRoster),W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop)}function J0(T,q,J,M,Q){if(z.editingTeam=T,!d||!F1||!S||!m)return;if(F1.textContent=`Customize ${T==="home"?"Home":"Away"} Lineup`,F)F.textContent="";d.style.display="flex";let Y=M,X=Q;if(T==="home"&&z.homeRoster)Y=z.homeRoster.lineup?z.homeRoster.lineup.map((H)=>H.player_id):M,X=z.homeRoster.pitcher?z.homeRoster.pitcher.player_id:Q;else if(T==="away"&&z.awayRoster)Y=z.awayRoster.lineup?z.awayRoster.lineup.map((H)=>H.player_id):M,X=z.awayRoster.pitcher?z.awayRoster.pitcher.player_id:Q;S.innerHTML="";for(let H=0;H<9;H++){let Z=document.createElement("li"),E=document.createElement("select");if(E.name=`batter${H}`,E.required=!0,E.innerHTML='<option value="">-- Select --</option>'+q.map(($)=>`<option value="${$.player_id}">${$.name} (${$.PA} PA)</option>`).join(""),Y&&Y[H])E.value=Y[H];Z.appendChild(E),S.appendChild(Z)}if(m.innerHTML='<option value="">-- Select --</option>'+J.filter((H)=>H.name&&H.name!=="Player"&&H.name!=="Pitcher").map((H)=>`<option value="${H.player_id}">${H.name} (${H.stats&&H.stats.IP?H.stats.IP:""} IP)</option>`).join(""),X)m.value=X}function A(){if(!z.gameState)return;if(T1)T1.disabled=!z.gameState.bases[0];if(q1)q1.disabled=!z.gameState.bases[1];if(J1)J1.disabled=!z.gameState.bases[2];if(M1)M1.disabled=!z.gameState.bases[0];if(H1)H1.disabled=!z.gameState.bases[1];if(Q1)Q1.disabled=!z.gameState.bases[2]}if(W1)W1.addEventListener("click",q0);if(l)l.addEventListener("change",y1);if(B)B.addEventListener("change",y1);if(D)D.addEventListener("click",T0);if(O1)O1.addEventListener("click",()=>{if(!z.loadedHome)return;J0("home",z.loadedHome.batters,z.loadedHome.pitchers,z.customHomeLineup,z.customHomePitcher)});if(_1)_1.addEventListener("click",()=>{if(!z.loadedAway)return;J0("away",z.loadedAway.batters,z.loadedAway.pitchers,z.customAwayLineup,z.customAwayPitcher)});if(I1)I1.addEventListener("click",()=>{if(d)d.style.display="none"});if(x1)x1.addEventListener("submit",(T)=>{if(T.preventDefault(),!S||!m)return;let q=[],J=S.querySelectorAll("select");for(let Q of J){if(!Q.value){if(F)F.textContent="Please select a player for every lineup slot.";return}q.push(Q.value)}if(new Set(q).size!==q.length){if(F)F.textContent="No duplicate players allowed in the lineup.";return}let M=m.value;if(!M){if(F)F.textContent="Please select a starting pitcher.";return}if(q.includes(M)){if(F)F.textContent="Pitcher cannot also be in the batting lineup.";return}if(z.editingTeam==="home")z.customHomeLineup=q,z.customHomePitcher=M;else z.customAwayLineup=q,z.customAwayPitcher=M;if(d)d.style.display="none";k0()});window.addEventListener("DOMContentLoaded",()=>{q0()});if(T1)T1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let T=z.gameState.top?0:1,q=T===0?z.awayRoster:z.homeRoster,J=T===0?z.homeRoster:z.awayRoster,M=T===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[0];if(!Q)return;let Y=M?s(M,"C"):{stats:{armStrength:50}},X=J.pitcher,H=V1(2,z.gameState,Q,X,Y,1);n({batterName:Q.name,outcome:H.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>x(z.atBatLog)),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)});if(q1)q1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let T=z.gameState.top?0:1,q=T===0?z.awayRoster:z.homeRoster,J=T===0?z.homeRoster:z.awayRoster,M=T===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[1];if(!Q)return;let Y=M?s(M,"C"):{stats:{armStrength:50}},X=J.pitcher,H=V1(3,z.gameState,Q,X,Y,2);n({batterName:Q.name,outcome:H.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>x(z.atBatLog)),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)});if(J1)J1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let T=z.gameState.top?0:1,q=T===0?z.awayRoster:z.homeRoster,J=T===0?z.homeRoster:z.awayRoster,M=T===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[2];if(!Q)return;let Y=M?s(M,"C"):{stats:{armStrength:50}},X=J.pitcher,H=V1(4,z.gameState,Q,X,Y,3);n({batterName:Q.name,outcome:H.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>x(z.atBatLog)),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)});if(M1)M1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let T=z.gameState.top?0:1,q=T===0?z.awayRoster:z.homeRoster,J=T===0?z.homeRoster:z.awayRoster,M=T===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[0];if(!Q)return;let Y=M?s(M,"1B"):{stats:{FP:0.985}},X=J.pitcher,H=v1(1,z.gameState,Q,X,Y);n({batterName:Q.name,outcome:H.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>x(z.atBatLog)),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)});if(H1)H1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let T=z.gameState.top?0:1,q=T===0?z.awayRoster:z.homeRoster,J=T===0?z.homeRoster:z.awayRoster,M=T===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[1];if(!Q)return;let Y=M?s(M,"2B"):{stats:{FP:0.985}},X=J.pitcher,H=v1(2,z.gameState,Q,X,Y);n({batterName:Q.name,outcome:H.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>x(z.atBatLog)),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)});if(Q1)Q1.addEventListener("click",()=>{if(!z.gameState||!z.homeRoster||!z.awayRoster)return;let T=z.gameState.top?0:1,q=T===0?z.awayRoster:z.homeRoster,J=T===0?z.homeRoster:z.awayRoster,M=T===0?z.homeFielders:z.awayFielders,Q=z.gameState.bases[2];if(!Q)return;let Y=M?s(M,"3B"):{stats:{FP:0.985}},X=J.pitcher,H=v1(3,z.gameState,Q,X,Y);n({batterName:Q.name,outcome:H.description,outs:z.gameState.outs,score:[...z.gameState.score],bases:z.gameState.bases.map((Z)=>Z?1:0),inning:z.gameState.inning,top:z.gameState.top},z.atBatLog,()=>x(z.atBatLog)),w(()=>W(z.gameState,z.homeRoster,z.awayRoster,z.homeMatchups,z.awayMatchups,z.lastRenderedInning,z.lastRenderedTop),A)});if(w1)w1.addEventListener("click",C0);
