var V0=Object.create;var{getPrototypeOf:Z0,defineProperty:D1,getOwnPropertyNames:N0}=Object;var U0=Object.prototype.hasOwnProperty;var v0=(T,H,z)=>{z=T!=null?V0(Z0(T)):{};let q=H||!T||!T.__esModule?D1(z,"default",{value:T,enumerable:!0}):z;for(let L of N0(T))if(!U0.call(q,L))D1(q,L,{get:()=>T[L],enumerable:!0});return q};var K0=(T,H)=>{for(var z in H)D1(T,z,{get:H[z],enumerable:!0,configurable:!0,set:(q)=>H[z]=()=>q})};var j0=(T,H)=>()=>(T&&(H=T(T=0)),H);var C0=((T)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(T,{get:(H,z)=>(typeof require!=="undefined"?require:H)[z]}):T)(function(T){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+T+'" is not supported')});var o1={};K0(o1,{sep:()=>i1,resolve:()=>N1,relative:()=>n1,posix:()=>s1,parse:()=>S1,normalize:()=>k1,join:()=>h1,isAbsolute:()=>B1,format:()=>p1,extname:()=>g1,dirname:()=>d1,delimiter:()=>m1,default:()=>D0,basename:()=>b1,_makeLong:()=>c1});function B(T){if(typeof T!=="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(T))}function u1(T,H){var z="",q=0,L=-1,M=0,Q;for(var J=0;J<=T.length;++J){if(J<T.length)Q=T.charCodeAt(J);else if(Q===47)break;else Q=47;if(Q===47){if(L===J-1||M===1);else if(L!==J-1&&M===2){if(z.length<2||q!==2||z.charCodeAt(z.length-1)!==46||z.charCodeAt(z.length-2)!==46){if(z.length>2){var X=z.lastIndexOf("/");if(X!==z.length-1){if(X===-1)z="",q=0;else z=z.slice(0,X),q=z.length-1-z.lastIndexOf("/");L=J,M=0;continue}}else if(z.length===2||z.length===1){z="",q=0,L=J,M=0;continue}}if(H){if(z.length>0)z+="/..";else z="..";q=2}}else{if(z.length>0)z+="/"+T.slice(L+1,J);else z=T.slice(L+1,J);q=J-L-1}L=J,M=0}else if(Q===46&&M!==-1)++M;else M=-1}return z}function _0(T,H){var z=H.dir||H.root,q=H.base||(H.name||"")+(H.ext||"");if(!z)return q;if(z===H.root)return z+q;return z+T+q}function N1(){var T="",H=!1,z;for(var q=arguments.length-1;q>=-1&&!H;q--){var L;if(q>=0)L=arguments[q];else{if(z===void 0)z=process.cwd();L=z}if(B(L),L.length===0)continue;T=L+"/"+T,H=L.charCodeAt(0)===47}if(T=u1(T,!H),H)if(T.length>0)return"/"+T;else return"/";else if(T.length>0)return T;else return"."}function k1(T){if(B(T),T.length===0)return".";var H=T.charCodeAt(0)===47,z=T.charCodeAt(T.length-1)===47;if(T=u1(T,!H),T.length===0&&!H)T=".";if(T.length>0&&z)T+="/";if(H)return"/"+T;return T}function B1(T){return B(T),T.length>0&&T.charCodeAt(0)===47}function h1(){if(arguments.length===0)return".";var T;for(var H=0;H<arguments.length;++H){var z=arguments[H];if(B(z),z.length>0)if(T===void 0)T=z;else T+="/"+z}if(T===void 0)return".";return k1(T)}function n1(T,H){if(B(T),B(H),T===H)return"";if(T=N1(T),H=N1(H),T===H)return"";var z=1;for(;z<T.length;++z)if(T.charCodeAt(z)!==47)break;var q=T.length,L=q-z,M=1;for(;M<H.length;++M)if(H.charCodeAt(M)!==47)break;var Q=H.length,J=Q-M,X=L<J?L:J,$=-1,Y=0;for(;Y<=X;++Y){if(Y===X){if(J>X){if(H.charCodeAt(M+Y)===47)return H.slice(M+Y+1);else if(Y===0)return H.slice(M+Y)}else if(L>X){if(T.charCodeAt(z+Y)===47)$=Y;else if(Y===0)$=0}break}var U=T.charCodeAt(z+Y),I=H.charCodeAt(M+Y);if(U!==I)break;else if(U===47)$=Y}var O="";for(Y=z+$+1;Y<=q;++Y)if(Y===q||T.charCodeAt(Y)===47)if(O.length===0)O+="..";else O+="/..";if(O.length>0)return O+H.slice(M+$);else{if(M+=$,H.charCodeAt(M)===47)++M;return H.slice(M)}}function c1(T){return T}function d1(T){if(B(T),T.length===0)return".";var H=T.charCodeAt(0),z=H===47,q=-1,L=!0;for(var M=T.length-1;M>=1;--M)if(H=T.charCodeAt(M),H===47){if(!L){q=M;break}}else L=!1;if(q===-1)return z?"/":".";if(z&&q===1)return"//";return T.slice(0,q)}function b1(T,H){if(H!==void 0&&typeof H!=="string")throw new TypeError('"ext" argument must be a string');B(T);var z=0,q=-1,L=!0,M;if(H!==void 0&&H.length>0&&H.length<=T.length){if(H.length===T.length&&H===T)return"";var Q=H.length-1,J=-1;for(M=T.length-1;M>=0;--M){var X=T.charCodeAt(M);if(X===47){if(!L){z=M+1;break}}else{if(J===-1)L=!1,J=M+1;if(Q>=0)if(X===H.charCodeAt(Q)){if(--Q===-1)q=M}else Q=-1,q=J}}if(z===q)q=J;else if(q===-1)q=T.length;return T.slice(z,q)}else{for(M=T.length-1;M>=0;--M)if(T.charCodeAt(M)===47){if(!L){z=M+1;break}}else if(q===-1)L=!1,q=M+1;if(q===-1)return"";return T.slice(z,q)}}function g1(T){B(T);var H=-1,z=0,q=-1,L=!0,M=0;for(var Q=T.length-1;Q>=0;--Q){var J=T.charCodeAt(Q);if(J===47){if(!L){z=Q+1;break}continue}if(q===-1)L=!1,q=Q+1;if(J===46){if(H===-1)H=Q;else if(M!==1)M=1}else if(H!==-1)M=-1}if(H===-1||q===-1||M===0||M===1&&H===q-1&&H===z+1)return"";return T.slice(H,q)}function p1(T){if(T===null||typeof T!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof T);return _0("/",T)}function S1(T){B(T);var H={root:"",dir:"",base:"",ext:"",name:""};if(T.length===0)return H;var z=T.charCodeAt(0),q=z===47,L;if(q)H.root="/",L=1;else L=0;var M=-1,Q=0,J=-1,X=!0,$=T.length-1,Y=0;for(;$>=L;--$){if(z=T.charCodeAt($),z===47){if(!X){Q=$+1;break}continue}if(J===-1)X=!1,J=$+1;if(z===46){if(M===-1)M=$;else if(Y!==1)Y=1}else if(M!==-1)Y=-1}if(M===-1||J===-1||Y===0||Y===1&&M===J-1&&M===Q+1){if(J!==-1)if(Q===0&&q)H.base=H.name=T.slice(1,J);else H.base=H.name=T.slice(Q,J)}else{if(Q===0&&q)H.name=T.slice(1,M),H.base=T.slice(1,J);else H.name=T.slice(Q,M),H.base=T.slice(Q,J);H.ext=T.slice(M,J)}if(Q>0)H.dir=T.slice(0,Q-1);else if(q)H.dir="/";return H}var i1="/",m1=":",s1,D0;var r1=j0(()=>{s1=((T)=>(T.posix=T,T))({resolve:N1,normalize:k1,isAbsolute:B1,join:h1,relative:n1,_makeLong:c1,dirname:d1,basename:b1,extname:g1,format:p1,parse:S1,sep:i1,delimiter:m1,win32:null,posix:null}),D0=s1});var U1=null;async function a1(){if(U1)return U1;try{if(typeof window!=="undefined"&&typeof fetch!=="undefined"){let T=await fetch("./complete-dataset-2025.json");if(!T.ok)throw new Error(`Failed to load dataset: ${T.status} ${T.statusText}`);let H=await T.json();return U1=H,H}else{let T=await import("fs"),z=(await Promise.resolve().then(() => (r1(),o1))).join(process.cwd(),"dist","complete-dataset-2025.json"),q=T.readFileSync(z,"utf8"),L=JSON.parse(q);return U1=L,L}}catch(T){throw console.error("Error loading dataset:",T),new Error("Failed to load baseball dataset. Please ensure complete-dataset-2025.json is available.")}}async function t1(){return(await a1()).teams.map((H)=>`${H.team}-${H.year}.html`)}async function W1(T){let H=await a1(),z=T.replace(".html","").split("-")[0],q=H.teams.find((J)=>J.team===z);if(!q)throw new Error(`Team ${z} not found in dataset`);let L=[],M=[],Q=[];return q.players.forEach((J)=>{let X={name:J.name,player_id:J.player_id,team:J.team,year:J.year};if(J.batting)L.push({...X,PA:J.batting.PA,stats:J.batting.stats,rates:J.batting.rates,baserunning:J.batting.baserunning});if(J.pitching)M.push({...X,TBF:J.pitching.TBF,stats:J.pitching.stats,rates:J.pitching.rates});if(J.fielding)Q.push({...X,position:J.fielding.position,stats:J.fielding.stats})}),{batters:L,pitchers:M,fielders:Q}}function z1(T,H,z,q){let L=T.map((J)=>{let X=z.find(($)=>$.player_id===J);if(!X)throw new Error(`Lineup player not found: ${J}`);return X}),M=q.find((J)=>J.player_id===H);if(!M)throw new Error(`Starting pitcher not found: ${H}`);let Q=new Set;for(let J of L){if(Q.has(J.player_id))throw new Error(`Duplicate player in lineup: ${J.player_id}`);Q.add(J.player_id)}if(Q.has(H))throw new Error(`Pitcher also appears in lineup: ${H}`);return{lineup:L,pitcher:M}}function v1(T,H){return(T+H)/2}function a(T,H){return T==null||isNaN(T)||T===0?H:T}var e1=0.22,E0=0.08,T0=0.03;function K1(T,H,z){let q=T.rates||{},L=H.rates||{},M=T.stats||{},Q=W(a(q.kRate,e1),"batter.kRate"),J=W(a(L.kRate,e1),"pitcher.kRate"),X=W(a(q.bbRate,E0),"batter.bbRate"),$=W(a(L.bbRate,E0),"pitcher.bbRate"),Y=W(a(q.hrRate,T0),"batter.hrRate"),U=W(a(L.hrRate,T0),"pitcher.hrRate"),I=W(q.BABIP??0.29,"batter.BABIP"),O=W(L.BABIP??0.29,"pitcher.BABIP"),P=Math.max(0,T.PA||0),T1=Math.max(0,M.HBP??0),m=Math.max(0,M.singles??0),n=Math.max(0,M.doubles??0),s=Math.max(0,M.triples??0),l=v1(Q,J),u=v1(X,$),c=P>0?T1/P:0.01,d=v1(Y,U),C=l+u+c+d,_=Math.max(0,1-C),w=Math.max(0.27,Math.min(0.33,v1(I,O))),Z=w*_,G=_-Z,r=0.75,V1=0.2,Z1=0.05,N=Z*r,V=Z*V1,v=Z*Z1;if(z){if(z.risp)w+=0.01,V*=1.1;if(z.late)u*=1.1,l*=1.05;if(z.twoOuts)w-=0.01;Z=Math.max(0,Math.min(1,w))*_,G=_-Z,N=Z*r,V=Z*V1,v=Z*Z1}let K=l+u+c+d+N+V+v,j=0.58;if(K>1-j){let k=(1-j)/K;l*=k,u*=k,c*=k,d*=k,N*=k,V*=k,v*=k,G=1-(l+u+c+d+N+V+v)}let D={K:W(l,"K"),BB:W(u,"BB"),HBP:W(c,"HBP"),HR:W(d,"HR"),"1B":W(N,"1B"),"2B":W(V,"2B"),"3B":W(v,"3B"),Out:W(G,"Out")},i=Object.values(D).reduce((k,$0)=>k+$0,0);if(i>0)Object.keys(D).forEach((k)=>{D[k]=D[k]/i});return D}function W(T,H){if(typeof T!=="number"||isNaN(T))return 0;if(T<0){if(H)console.warn(`[probabilityModel] Clamped negative value for ${H}: ${T} → 0`);return 0}if(T>1){if(H)console.warn(`[probabilityModel] Clamped value >1 for ${H}: ${T} → 1`);return 1}return T}function H1(T){let{lineup:H,pitcher:z}=T;return H.map((q)=>{let L=K1(q,z);return{batter_id:q.player_id,pitcher_id:z.player_id,probabilities:L}})}function q1(T){let H=Object.values(T).reduce((q,L)=>q+L,0),z=Math.random()*H;for(let[q,L]of Object.entries(T))if((z-=L)<=0)return q;return Object.keys(T).pop()||""}var k0={Groundout:0.48,Flyout:0.32,Lineout:0.12,Popout:0.08},W0={Groundout:{"1B":0.1,"2B":0.27,SS:0.32,"3B":0.16,P:0.15},Flyout:{LF:0.28,CF:0.48,RF:0.24},Lineout:{"1B":0.28,"2B":0.18,SS:0.18,"3B":0.28,LF:0.04,CF:0.02,RF:0.02},Popout:{C:0.3,"1B":0.18,"2B":0.08,SS:0.18,"3B":0.18,LF:0.04,RF:0.04}};function z0(T){if(T==="Out"){let H=q1(k0),z=q1(W0[H]);return`${H} to ${z}`}return T}function H0(T){if(!T||typeof T!=="string")return"";let H=T.replace(/\*/g,"").split(/[/,]/)[0],z={"1":"P","2":"C","3":"1B","4":"2B","5":"3B","6":"SS","7":"LF","8":"CF","9":"RF",D:"DH",H:"PH"};if(z[H])return z[H];let q=H.charAt(0);if(z[q])return z[q];return H}function q0(){return{inning:1,top:!0,outs:0,bases:[null,null,null],lineupIndices:[0,0],score:[0,0],pitcherFatigue:[{battersFaced:0},{battersFaced:0}]}}function O1(T){let H=[];if(T[0])H.push(0);if(T[1]&&T[0])H.push(1);if(T[2]&&T[1]&&T[0])H.push(2);return H}function G1(T,H,z){let q=0,L=[null,null,null];for(let Q=2;Q>=0;Q--){if(!T[Q])continue;let J=T[Q],X=J.baserunning?.speed||50,$=J.baserunning?.runsBaserunning||0,Y=Q+(H==="1B"?1:H==="2B"?2:H==="3B"?3:4);if(H==="1B"){if(X>70&&Math.random()<0.15)Y=Math.min(Y+1,3)}else if(H==="2B"){if(Q===0&&$>2&&Math.random()<0.25)Y=3}if(Y>=3)q++;else L[Y]=J}let M={"1B":0,"2B":1,"3B":2}[H];if(M!==void 0)L[M]=z;if(H==="HR")q++;return[L,q]}function J0(T,H,z,q,L,M,Q,J,X){let $=J||q1,Y=X||z0,U=z.top?0:1,I=U===0?T:H,O=U===0?M:Q,P=U===0?L:q,T1=Array.isArray(P)?P:[],m=z.lineupIndices[U],n=I[m%I.length],s=O.lineup[m%O.lineup.length],l=!!(z.bases[1]||z.bases[2]),u=z.inning>=8&&Math.abs(z.score[0]-z.score[1])<=2,c=z.outs===2,d={risp:l,late:u,twoOuts:c},C=K1(s,O.pitcher,d);if(z.pitcherFatigue&&z.pitcherFatigue[1-U]){z.pitcherFatigue[1-U].battersFaced++;let N=z.pitcherFatigue[1-U].battersFaced;if(N>18){let v=Math.min((N-18)*0.005,0.05);C={...C};let K=C.Out;if(C.BB)C.BB+=v;if(C["1B"])C["1B"]+=v;if(C.Out){if(C.Out-=v,C.Out<0.5*K)C.Out=0.5*K}let j=Object.values(C).reduce((D,i)=>D+i,0);Object.keys(C).forEach((D)=>C[D]=Math.max(0,C[D]/j))}}let _=$(C),w=Y(_);z.lineupIndices[U]++;let Z=void 0,G="",r=!1,V1=!1,Z1=!1;if(_==="Out"){let N=w.match(/to ([A-Z0-9]+)/);if(N){if(G=N[1],Z=T1.find((V)=>V.position===G),Z&&Z.stats){let V=Number(Z.stats.E)||0,v=Number(Z.stats.PO)||0,K=Number(Z.stats.A)||0,j=v+K+V,D=j>0?V/j:0.01;if(Math.random()<D)r=!0}else if(Math.random()<0.01)r=!0}}if(r){let[N,V]=G1(z.bases,"1B",s);return z.bases=N,z.score[U]+=V,{batter_id:n.batter_id,outcome:`Error on ${G}`,fielder:Z,fielderPosition:G}}if(_==="Out"&&/^Groundout to [A-Z0-9]+$/.test(w)&&z.outs===0){let N=O1(z.bases);if(N.length>=2){let V=0.01;if(Z&&Z.stats){let v=Number(Z.stats.RF)||0,K=Number(Z.stats.TZ)||0,j=Number(Z.stats.FP)||0.985,D=Math.max(0,(v-4.5)*0.005),i=Math.max(0,K*0.002),k=j>0.995?0.01:0;V=Math.min(0.05,V+D+i+k)}if(Math.random()<V){Z1=!0;let v=N.slice().sort((K,j)=>j-K);for(let K=0;K<2&&K<v.length;K++)z.bases[v[K]]=null;return z.outs=3,{batter_id:n.batter_id,outcome:"Grounded into triple play",...Z?{fielder:Z,fielderPosition:G}:{}}}}}if(_==="Out"&&/^Groundout to [A-Z0-9]+$/.test(w)&&z.outs<2){let N=O1(z.bases);if(N.length>=1){let V=0.25;if(Z&&Z.stats){let v=Number(Z.stats.RF)||0,K=Number(Z.stats.TZ)||0,j=Number(Z.stats.FP)||0.985,D=Math.max(0,(v-4.5)*0.05),i=Math.max(0,K*0.02),k=j>0.995?0.1:0;V=Math.min(0.6,V+D+i+k)}if(Math.random()<V){V1=!0;let v=Math.max(...N);return z.bases[v]=null,z.outs=Math.min(z.outs+2,3),{batter_id:n.batter_id,outcome:"Grounded into double play",...Z?{fielder:Z,fielderPosition:G}:{}}}}}if(_==="Out"&&/^Groundout to [A-Z0-9]+$/.test(w)){z.outs++;let N=O1(z.bases);for(let V of N.slice().sort((v,K)=>K-v))if(z.bases[V])if(V===2)z.bases[V]=null,z.score[U]+=1;else z.bases[V+1]=z.bases[V],z.bases[V]=null;return{batter_id:n.batter_id,outcome:w,...Z?{fielder:Z,fielderPosition:G}:{}}}if(_==="Out"||_==="K")z.outs++;else if(_==="BB"||_==="HBP"){let[N,V]=G1(z.bases,"1B",s);z.bases=N,z.score[U]+=V}else{let[N,V]=G1(z.bases,_,s);z.bases=N,z.score[U]+=V}if(_==="K"||_==="BB"){let N=T1.find((V)=>V.position==="C");if(N&&N.stats){let V=Number(N.stats.FP)||0.985,v=Number(N.stats.PB)||0,K=V>0.995?0.001:0.005;if(Math.random()<K){for(let j=2;j>=0;j--)if(z.bases[j])if(j===2)z.bases[j]=null,z.score[U]++;else z.bases[j+1]=z.bases[j],z.bases[j]=null;return{batter_id:n.batter_id,outcome:"Strikeout, but passed ball allows runner to advance",fielder:N,fielderPosition:"C"}}}}return{batter_id:n.batter_id,outcome:w,...Z?{fielder:Z,fielderPosition:G}:{}}}function j1(T,H,z,q,L,M,Q){let J=Q||Math.random;if(!H.bases[M-1])return{success:!1,out:!1,description:`No runner on base ${M} to steal from.`};let X=T===2?0.6:T===3?0.3:0.1;if(z?.baserunning&&L?.stats){let Y=z.baserunning.speed||50,U=L.stats.armStrength||50,I=z.name||z.player_id||"Unknown Runner",O=L.name||L.player_id||"Unknown Catcher";if(console.log(`[STEAL ATTEMPT] Runner: ${I} (speed: ${Y}), Catcher: ${O} (arm: ${U})`),X=0.5+(Y-U)/200,T===3)X-=0.2;if(T===4)X-=0.4;X=Math.max(0.05,Math.min(0.95,X))}if(J(1)<X){let Y=H.bases[M-1];if(H.bases[M-1]=null,T<=3)H.bases[T-1]=Y;else H.score[H.top?0:1]+=1;return{success:!0,out:!1,description:`Runner successfully stole base ${T===4?"Home":T}`}}else return H.bases[M-1]=null,H.outs++,{success:!1,out:!0,description:`Runner caught stealing base ${T===4?"Home":T}`}}function C1(T,H,z,q,L,M){let Q=M||Math.random;if(!H.bases[T-1])return{success:!1,out:!1,error:!1,description:`No runner on base ${T} to pick off.`};let J=0.05,X=0.1;if(q?.stats&&z?.baserunning){let Y=q.stats.pickoffs||0,U=z.baserunning.speed||50;J=0.03+Y*0.02-(U-50)/1000,J=Math.max(0.01,Math.min(0.15,J))}if(L?.stats)X=0.05+(1-(L.stats.FP||0.985))*2,X=Math.max(0.01,Math.min(0.2,X));let $=Q(1);if($<J)return H.bases[T-1]=null,H.outs++,{success:!0,out:!0,error:!1,description:`Runner picked off at base ${T}`};else if($<J+X){let Y=H.bases[T-1];if(H.bases[T-1]=null,T<3)H.bases[T]=Y;else H.score[H.top?0:1]+=1;return{success:!1,out:!1,error:!0,description:`Pickoff error: runner advances from base ${T}`}}else return{success:!1,out:!1,error:!1,description:`Pickoff attempt at base ${T} unsuccessful`}}function x1(T,H){let{inning:z,top:q,outs:L,score:M}=T,[Q,J]=M;if(z<9)return!1;if(q&&L===3){if(J>Q)return H("Home",M,z,!0),!0;return!1}if(!q&&L===3)if(Q>J)return H("Away",M,z,!1),!0;else if(J>Q)return H("Home",M,z,!1),!0;else return!1;if(!q&&L<3&&J>Q)return H("Home",M,z,!1),!0;return!1}var b=document.getElementById("home-team-select"),g=document.getElementById("away-team-select"),F1=document.getElementById("load-teams-btn"),A=document.getElementById("status"),_1=document.getElementById("lineups-container"),J1=document.getElementById("game-state-container"),x=document.getElementById("next-atbat-btn"),p=document.getElementById("atbat-result-container"),I1=document.getElementById("customize-home-lineup-btn"),w1=document.getElementById("customize-away-lineup-btn"),o=document.getElementById("custom-lineup-modal"),A1=document.getElementById("close-lineup-modal"),y1=document.getElementById("lineup-modal-title"),R1=document.getElementById("custom-lineup-form"),t=document.getElementById("batting-order-list"),e=document.getElementById("pitcher-select"),y=document.getElementById("lineup-error"),L1=document.getElementById("steal-2b-btn"),M1=document.getElementById("steal-3b-btn"),Q1=document.getElementById("steal-home-btn"),X1=document.getElementById("pickoff-1b-btn"),Y1=document.getElementById("pickoff-2b-btn"),$1=document.getElementById("pickoff-3b-btn"),f1=document.getElementById("simulate-full-game-btn");function P1(T,H){if(!_1)return;_1.innerHTML="";let z=(q,L)=>{if(!q)return`<div><strong>${L}:</strong> Not loaded</div>`;let M=q.lineup||q.batters||[],Q=q.pitcher||q.pitchers&&q.pitchers[0]||{name:"N/A"};return`
      <div style="margin-bottom:1.5em;">
        <strong>${L} Lineup</strong>
        <table class="lineup-table">
          <thead><tr><th>#</th><th>Name</th><th>BABIP</th></tr></thead>
          <tbody>
            ${(M||[]).slice(0,9).map((J,X)=>{let $=J.position?H0(J.position):"",Y=J.rates?.BABIP?Number(J.rates.BABIP).toFixed(3):"";return`<tr><td>${X+1}</td><td>${J.name||""}${$?` <span class='pos-label'>(${$})</span>`:""}</td><td>${Y}</td></tr>`}).join("")}
          </tbody>
        </table>
        <div><strong>Pitcher:</strong> ${Q.name}</div>
      </div>
    `};_1.innerHTML=`
    <div style="display:flex;gap:2em;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">${z(T,"Home")}</div>
      <div style="flex:1;min-width:250px;">${z(H,"Away")}</div>
    </div>
  `}function F(T,H,z,q,L,M,Q){if(!J1)return;if(!T||!H||!z){if(J1.innerHTML="<em>Game not started.</em>",x)x.style.display="none";return}if(x)x.style.display="";let J=T,{inning:X,top:$,outs:Y,bases:U,score:I,lineupIndices:O}=J,P=$?0:1,T1=P===0?L:q,m=P===0?z:H;if(!m){if(J1.innerHTML="<em>Roster not loaded.</em>",x)x.style.display="none";return}let n=O[P]%m.lineup.length,s=m.lineup[n],l=(P===0?H:z).pitcher,u=["1B","2B","3B"].map((c,d)=>J.bases[d]?c:"").filter(Boolean).join(", ")||"Empty";J1.innerHTML=`
    <div><strong>Inning:</strong> ${X} (${$?"Top":"Bottom"})</div>
    <div><strong>Outs:</strong> ${Y}</div>
    <div><strong>Bases:</strong> ${u}</div>
    <div><strong>Score:</strong> Away ${I[0]} &ndash; Home ${I[1]}</div>
    <div style="margin-top:1em;"><strong>At Bat:</strong> ${s.name} (vs ${l.name})</div>
  `}function S(T,H,z){if(!p)return;if(!T)return;H.push(T),z()}function R(T){if(!p)return;p.innerHTML="";let H=null,z=null;for(let q of T){if(q.inning!==H||q.top!==z){let Q=document.createElement("div");Q.style.marginTop="1em",Q.style.fontWeight="bold",Q.textContent=`Inning ${q.inning} - ${q.top?"Top":"Bottom"}`,p.appendChild(Q),H=q.inning,z=q.top}let L=["1B","2B","3B"].map((Q,J)=>q.bases[J]?Q:"").filter(Boolean).join(", ")||"Empty",M=document.createElement("div");M.innerHTML=`<strong>${q.batterName}:</strong> ${q.outcome} <span style="color:#888">(Outs: ${q.outs}, Score: Away ${q.score[0]} – Home ${q.score[1]}, Bases: ${L})</span>`,p.appendChild(M)}}function f(T,H){T(),H()}var E={loadedHome:null,loadedAway:null,homeRoster:null,awayRoster:null,homeFielders:null,awayFielders:null,homeMatchups:null,awayMatchups:null,gameState:null,lastRenderedInning:1,lastRenderedTop:!0,customHomeLineup:null,customHomePitcher:null,customAwayLineup:null,customAwayPitcher:null,editingTeam:null,atBatLog:[]};async function O0(){try{return await t1()}catch(T){return console.error("Error fetching available teams:",T),[]}}function E1(T,H){let z=T.find((L)=>L.position===H);if(z)return z;let q=T.find((L)=>L.positions&&L.positions.includes(H));if(q)return q;return T.find((L)=>L.stats)||{stats:{armStrength:50,FP:0.985}}}function L0(T,H,z,q){let L=document.querySelector(".sticky-action-bar");if(L)L.querySelectorAll("button").forEach((Q)=>{Q.disabled=!0,Q.classList.add("disabled-greyed")});if(A)A.textContent=`Game Over: ${T} wins! Final Score: Away ${H[0]} – Home ${H[1]} (${z}${q?" Top":" Bottom"})`;if(p){let M=document.createElement("div");M.style.marginTop="1em",M.style.fontWeight="bold",M.style.color="#b00",M.textContent=`Game Over: ${T} wins! Final Score: Away ${H[0]} – Home ${H[1]} (${z}${q?" Top":" Bottom"})`,p.appendChild(M)}}function M0(){if(!E.homeRoster||!E.awayRoster)return;E.homeMatchups=H1(E.homeRoster),E.awayMatchups=H1(E.awayRoster),E.gameState=q0(),E.atBatLog=[],R(E.atBatLog),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)}function Q0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups||!E.homeRoster||!E.awayRoster)return;let T=E.gameState,H=T.top?0:1,z=H===0?E.awayRoster:E.homeRoster,q=T.lineupIndices[H]%z.lineup.length,L=z.lineup[q],M=J0(E.awayMatchups,E.homeMatchups,T,E.awayFielders||[],E.homeFielders||[],E.awayRoster,E.homeRoster);if(S({batterName:L.name,outcome:M.outcome,outs:T.outs,score:[...T.score],bases:T.bases.map(($)=>$?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>R(E.atBatLog)),x1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},L0)){f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h);return}let J="",X=!1;if(T.outs>=3){if(T.top)J="End of top half. Switching to bottom of inning.";else J="End of inning. Advancing to next inning.";if(S({batterName:"::",outcome:J,outs:T.outs,score:[...T.score],bases:T.bases.map(($)=>$?1:0),inning:T.inning,top:T.top},E.atBatLog,()=>R(E.atBatLog)),T.bases=[null,null,null],T.outs=0,T.top)T.top=!1;else T.top=!0,T.inning++;X=!0}if(X){if(x1({inning:T.inning,top:T.top,score:T.score,outs:T.outs},L0)){f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h);return}}f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)}function G0(){if(!E.gameState||!E.homeMatchups||!E.awayMatchups)M0();while(E.gameState&&x&&!x.disabled)Q0()}async function l1(){if(!b||!g||!A)return;let T=b.value,H=g.value;if(!T||!H)return;A.textContent="Loading lineups...";try{let[z,q]=await Promise.all([W1(T),W1(H)]);E.loadedHome=z,E.loadedAway=q,E.homeFielders=z.fielders,E.awayFielders=q.fielders;let L=z.batters.map((Q)=>{let J=z.fielders.find((X)=>X.player_id===Q.player_id);if(J)return{...Q,...J,stats:{...Q.stats,...J.stats},position:J.position};return Q}),M=q.batters.map((Q)=>{let J=q.fielders.find((X)=>X.player_id===Q.player_id);if(J)return{...Q,...J,stats:{...Q.stats,...J.stats},position:J.position};return Q});E.homeRoster=z&&z.batters&&z.pitchers?z1(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:L.slice(0,9).map((Q)=>Q.player_id),E.customHomePitcher||z.pitchers.find((Q)=>Q.name&&Q.name!=="Player")?.player_id||z.pitchers[0].player_id,L,z.pitchers):null,E.awayRoster=q&&q.batters&&q.pitchers?z1(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:M.slice(0,9).map((Q)=>Q.player_id),E.customAwayPitcher||q.pitchers.find((Q)=>Q.name&&Q.name!=="Player")?.player_id||q.pitchers[0].player_id,M,q.pitchers):null,P1(E.homeRoster,E.awayRoster),E.atBatLog=[],R(E.atBatLog),A.textContent="Lineups loaded. Ready to simulate!",M0()}catch(z){A.textContent="Failed to load lineups."}}async function X0(){if(!A)return;A.textContent="Loading teams...";let T=await O0();if(!T.length){A.textContent="No teams found in data folder.";return}for(let H of[b,g]){if(!H)continue;H.innerHTML="";for(let z of T){let q=document.createElement("option");q.value=z,q.textContent=z.replace(".html",""),H.appendChild(q)}}if(b)b.value="CHC-2025.html";if(g)g.value="MIL-2025.html";if(A.textContent="Select home and away teams.",b&&g)l1()}function x0(){if(!E.loadedHome||!E.loadedAway)return;let T=E.homeRoster?.pitcher?.player_id,H=E.awayRoster?.pitcher?.player_id,z=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.fielders?E.loadedHome.batters.map((Q)=>{let J=E.loadedHome.fielders.find((X)=>X.player_id===Q.player_id);if(J)return{...Q,...J,stats:{...Q.stats,...J.stats},position:J.position};return Q}):[],q=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.fielders?E.loadedAway.batters.map((Q)=>{let J=E.loadedAway.fielders.find((X)=>X.player_id===Q.player_id);if(J)return{...Q,...J,stats:{...Q.stats,...J.stats},position:J.position};return Q}):[];E.homeRoster=E.loadedHome&&E.loadedHome.batters&&E.loadedHome.pitchers?z1(E.customHomeLineup&&E.customHomeLineup.length===9?E.customHomeLineup:z.slice(0,9).map((Q)=>Q.player_id),E.customHomePitcher||E.loadedHome.pitchers.find((Q)=>Q.name&&Q.name!=="Player")?.player_id||E.loadedHome.pitchers[0].player_id,z,E.loadedHome.pitchers):null,E.awayRoster=E.loadedAway&&E.loadedAway.batters&&E.loadedAway.pitchers?z1(E.customAwayLineup&&E.customAwayLineup.length===9?E.customAwayLineup:q.slice(0,9).map((Q)=>Q.player_id),E.customAwayPitcher||E.loadedAway.pitchers.find((Q)=>Q.name&&Q.name!=="Player")?.player_id||E.loadedAway.pitchers[0].player_id,q,E.loadedAway.pitchers):null;let L=E.homeRoster?.pitcher?.player_id,M=E.awayRoster?.pitcher?.player_id;if(E.gameState&&E.gameState.pitcherFatigue){if(T&&L&&T!==L)E.gameState.pitcherFatigue[1]={battersFaced:0},console.log(`\uD83D\uDD04 Home pitcher changed from ${T} to ${L} - fatigue reset`);if(H&&M&&H!==M)E.gameState.pitcherFatigue[0]={battersFaced:0},console.log(`\uD83D\uDD04 Away pitcher changed from ${H} to ${M} - fatigue reset`)}if(E.homeRoster&&E.awayRoster)E.homeMatchups=H1({lineup:E.homeRoster.lineup,pitcher:E.awayRoster.pitcher}),E.awayMatchups=H1({lineup:E.awayRoster.lineup,pitcher:E.homeRoster.pitcher});P1(E.homeRoster,E.awayRoster),F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop)}function Y0(T,H,z,q,L){if(E.editingTeam=T,!o||!y1||!t||!e)return;if(y1.textContent=`Customize ${T==="home"?"Home":"Away"} Lineup`,y)y.textContent="";o.style.display="flex";let M=q,Q=L;if(T==="home"&&E.homeRoster)M=E.homeRoster.lineup?E.homeRoster.lineup.map((J)=>J.player_id):q,Q=E.homeRoster.pitcher?E.homeRoster.pitcher.player_id:L;else if(T==="away"&&E.awayRoster)M=E.awayRoster.lineup?E.awayRoster.lineup.map((J)=>J.player_id):q,Q=E.awayRoster.pitcher?E.awayRoster.pitcher.player_id:L;t.innerHTML="";for(let J=0;J<9;J++){let X=document.createElement("li"),$=document.createElement("select");if($.name=`batter${J}`,$.required=!0,$.innerHTML='<option value="">-- Select --</option>'+H.map((Y)=>`<option value="${Y.player_id}">${Y.name} (${Y.PA} PA)</option>`).join(""),M&&M[J])$.value=M[J];X.appendChild($),t.appendChild(X)}if(e.innerHTML='<option value="">-- Select --</option>'+z.filter((J)=>J.name&&J.name!=="Player"&&J.name!=="Pitcher").map((J)=>`<option value="${J.player_id}">${J.name} (${J.stats&&J.stats.IP?J.stats.IP:""} IP)</option>`).join(""),Q)e.value=Q}function h(){if(!E.gameState)return;if(L1)L1.disabled=!E.gameState.bases[0];if(M1)M1.disabled=!E.gameState.bases[1];if(Q1)Q1.disabled=!E.gameState.bases[2];if(X1)X1.disabled=!E.gameState.bases[0];if(Y1)Y1.disabled=!E.gameState.bases[1];if($1)$1.disabled=!E.gameState.bases[2]}if(F1)F1.addEventListener("click",X0);if(b)b.addEventListener("change",l1);if(g)g.addEventListener("change",l1);if(x)x.addEventListener("click",Q0);if(I1)I1.addEventListener("click",()=>{if(!E.loadedHome)return;Y0("home",E.loadedHome.batters,E.loadedHome.pitchers,E.customHomeLineup,E.customHomePitcher)});if(w1)w1.addEventListener("click",()=>{if(!E.loadedAway)return;Y0("away",E.loadedAway.batters,E.loadedAway.pitchers,E.customAwayLineup,E.customAwayPitcher)});if(A1)A1.addEventListener("click",()=>{if(o)o.style.display="none"});if(R1)R1.addEventListener("submit",(T)=>{if(T.preventDefault(),!t||!e)return;let H=[],z=t.querySelectorAll("select");for(let L of z){if(!L.value){if(y)y.textContent="Please select a player for every lineup slot.";return}H.push(L.value)}if(new Set(H).size!==H.length){if(y)y.textContent="No duplicate players allowed in the lineup.";return}let q=e.value;if(!q){if(y)y.textContent="Please select a starting pitcher.";return}if(H.includes(q)){if(y)y.textContent="Pitcher cannot also be in the batting lineup.";return}if(E.editingTeam==="home")E.customHomeLineup=H,E.customHomePitcher=q;else E.customAwayLineup=H,E.customAwayPitcher=q;if(o)o.style.display="none";x0()});window.addEventListener("DOMContentLoaded",()=>{X0()});if(L1)L1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,H=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[0];if(!L)return;let M=q?E1(q,"C"):{stats:{armStrength:50}},Q=z.pitcher,J=j1(2,E.gameState,L,Q,M,1);S({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)});if(M1)M1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,H=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[1];if(!L)return;let M=q?E1(q,"C"):{stats:{armStrength:50}},Q=z.pitcher,J=j1(3,E.gameState,L,Q,M,2);S({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)});if(Q1)Q1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,H=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[2];if(!L)return;let M=q?E1(q,"C"):{stats:{armStrength:50}},Q=z.pitcher,J=j1(4,E.gameState,L,Q,M,3);S({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)});if(X1)X1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,H=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[0];if(!L)return;let M=q?E1(q,"1B"):{stats:{FP:0.985}},Q=z.pitcher,J=C1(1,E.gameState,L,Q,M);S({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)});if(Y1)Y1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,H=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[1];if(!L)return;let M=q?E1(q,"2B"):{stats:{FP:0.985}},Q=z.pitcher,J=C1(2,E.gameState,L,Q,M);S({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)});if($1)$1.addEventListener("click",()=>{if(!E.gameState||!E.homeRoster||!E.awayRoster)return;let T=E.gameState.top?0:1,H=T===0?E.awayRoster:E.homeRoster,z=T===0?E.homeRoster:E.awayRoster,q=T===0?E.homeFielders:E.awayFielders,L=E.gameState.bases[2];if(!L)return;let M=q?E1(q,"3B"):{stats:{FP:0.985}},Q=z.pitcher,J=C1(3,E.gameState,L,Q,M);S({batterName:L.name,outcome:J.description,outs:E.gameState.outs,score:[...E.gameState.score],bases:E.gameState.bases.map((X)=>X?1:0),inning:E.gameState.inning,top:E.gameState.top},E.atBatLog,()=>R(E.atBatLog)),f(()=>F(E.gameState,E.homeRoster,E.awayRoster,E.homeMatchups,E.awayMatchups,E.lastRenderedInning,E.lastRenderedTop),h)});if(f1)f1.addEventListener("click",G0);
